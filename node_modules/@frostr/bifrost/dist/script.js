var bifrost=function(e){"use strict";function t(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function n(e,...t){if(!((n=e)instanceof Uint8Array||ArrayBuffer.isView(n)&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function r(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const i="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function s(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function o(e,t){return e<<32-t|e>>>t}function a(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),n(e),e}let c=class{clone(){return this._cloneInto()}};function u(e){const t=t=>e().update(a(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function d(e=32){if(i&&"function"==typeof i.getRandomValues)return i.getRandomValues(new Uint8Array(e));if(i&&"function"==typeof i.randomBytes)return i.randomBytes(e);throw new Error("crypto.getRandomValues must be defined")}function l(e,t,n){return e&t^e&n^t&n}class h extends c{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=s(this.buffer)}update(e){r(this);const{view:t,buffer:n,blockLen:i}=this,o=(e=a(e)).length;for(let r=0;r<o;){const a=Math.min(i-this.pos,o-r);if(a!==i)n.set(e.subarray(r,r+a),this.pos),this.pos+=a,r+=a,this.pos===i&&(this.process(t,0),this.pos=0);else{const t=s(e);for(;i<=o-r;r+=i)this.process(t,r)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){r(this),function(e,t){n(e);const r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:o,isLE:a}=this;let{pos:c}=this;t[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>o-c&&(this.process(i,0),c=0);for(let e=c;e<o;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+u,a,r)}(i,o-8,BigInt(8*this.length),a),this.process(i,0);const u=s(e),d=this.outputLen;if(d%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=d/4,h=this.get();if(l>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<l;e++)u.setUint32(4*e,h[e],a)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=s,r%t&&e.buffer.set(n),e}}const f=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),p=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),g=new Uint32Array(64);let y=class extends h{constructor(){super(64,32,8,!1),this.A=0|p[0],this.B=0|p[1],this.C=0|p[2],this.D=0|p[3],this.E=0|p[4],this.F=0|p[5],this.G=0|p[6],this.H=0|p[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[e,t,n,r,i,s,o,a]}set(e,t,n,r,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)g[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=g[e-15],n=g[e-2],r=o(t,7)^o(t,18)^t>>>3,i=o(n,17)^o(n,19)^n>>>10;g[e]=i+g[e-7]+r+g[e-16]|0}let{A:n,B:r,C:i,D:s,E:a,F:c,G:u,H:d}=this;for(let e=0;e<64;e++){const t=d+(o(a,6)^o(a,11)^o(a,25))+((h=a)&c^~h&u)+f[e]+g[e]|0,p=(o(n,2)^o(n,13)^o(n,22))+l(n,r,i)|0;d=u,u=c,c=a,a=s+t|0,s=i,i=r,r=n,n=t+p|0}var h;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(n,r,i,s,a,c,u,d)}roundClean(){g.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const m=u((()=>new y));function w(e){if(e>Number.MAX_SAFE_INTEGER)throw new TypeError("Number exceeds safe bounds!")}function b(e,t){if(e!==t)throw new TypeError(`Bech32 prefix does not match: ${e} !== ${t}`)}const v=new TextEncoder,_=new TextDecoder;function E(e){return v.encode(e)}function x(e){return _.decode(e)}function k(e,t){!function(e){if(null!==e.match(/[^a-fA-f0-9]/))throw new TypeError("Invalid characters in hex string: "+e);if(e.length%2!=0)throw new Error(`Length of hex string is invalid: ${e.length}`)}(e);const n=e.length/2;if(void 0===t&&(t=n),n>t)throw new TypeError(`Hex string is larger than array size: ${n} > ${t}`);return t}
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function A(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function S(e,t){return!!Array.isArray(t)&&(0===t.length||(e?t.every((e=>"string"==typeof e)):t.every((e=>Number.isSafeInteger(e)))))}function I(e){if("function"!=typeof e)throw new Error("function expected");return!0}function B(e,t){if("string"!=typeof t)throw new Error(`${e}: string expected`);return!0}function T(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function O(e){if(!Array.isArray(e))throw new Error("array expected")}function N(e,t){if(!S(!0,t))throw new Error(`${e}: array of strings expected`)}function U(e,t){if(!S(!1,t))throw new Error(`${e}: array of numbers expected`)}function R(...e){const t=e=>e,n=(e,t)=>n=>e(t(n));return{encode:e.map((e=>e.encode)).reduceRight(n,t),decode:e.map((e=>e.decode)).reduce(n,t)}}function L(e){const t="string"==typeof e?e.split(""):e,n=t.length;N("alphabet",t);const r=new Map(t.map(((e,t)=>[e,t])));return{encode:r=>(O(r),r.map((r=>{if(!Number.isSafeInteger(r)||r<0||r>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${r}". Allowed: ${e}`);return t[r]}))),decode:t=>(O(t),t.map((t=>{B("alphabet.decode",t);const n=r.get(t);if(void 0===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n})))}}function C(e=""){return B("join",e),{encode:t=>(N("join.decode",t),t.join(e)),decode:t=>(B("join.decode",t),t.split(e))}}function P(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(O(e),!e.length)return[];let r=0;const i=[],s=Array.from(e,(e=>{if(T(e),e<0||e>=t)throw new Error(`invalid integer: ${e}`);return e})),o=s.length;for(;;){let e=0,a=!0;for(let i=r;i<o;i++){const o=s[i],c=t*e,u=c+o;if(!Number.isSafeInteger(u)||c/t!==e||u-o!==c)throw new Error("convertRadix: carry overflow");const d=u/n;e=u%n;const l=Math.floor(d);if(s[i]=l,!Number.isSafeInteger(l)||l*n+e!==u)throw new Error("convertRadix: carry overflow");a&&(l?a=!1:r=i)}if(i.push(e),a)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}const Z=(e,t)=>0===t?e:Z(t,e%t),$=(e,t)=>e+(t-Z(e,t)),j=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function q(e,t,n,r){if(O(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if($(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${$(t,n)}`);let i=0,s=0;const o=j[t],a=j[n]-1,c=[];for(const r of e){if(T(r),r>=o)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(i=i<<t|r,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((i>>s-n&a)>>>0);const e=j[s];if(void 0===e)throw new Error("invalid carry");i&=e-1}if(i=i<<n-s&a,!r&&s>=t)throw new Error("Excess padding");if(!r&&i>0)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&c.push(i>>>0),c}function M(e,t=!1){if(T(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if($(8,e)>32||$(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!A(n))throw new Error("radix2.encode input should be Uint8Array");return q(Array.from(n),8,e,!t)},decode:n=>(U("radix2.decode",n),Uint8Array.from(q(n,e,8,t)))}}function z(e){return I(e),function(...t){try{return e.apply(null,t)}catch(e){}}}const H=R(M(6),L("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),function(e,t="="){return T(e),B("padding",t),{encode(n){for(N("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){N("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--){if((r-1)*e%8==0)throw new Error("padding: invalid, string has too much padding")}return n.slice(0,r)}}}(6),C("")),F=R(M(6),L("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),C("")),D=(V="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",R(function(e){return T(e),{encode:t=>{if(!A(t))throw new Error("radix.encode input should be Uint8Array");return P(Array.from(t),256,e)},decode:t=>(U("radix.decode",t),Uint8Array.from(P(t,e,256)))}}(58),L(V),C("")));var V;const K=e=>{return R((n=t=>e(e(t)),T(t=4),I(n),{encode(e){if(!A(e))throw new Error("checksum.encode: input should be Uint8Array");const r=n(e).slice(0,t),i=new Uint8Array(e.length+t);return i.set(e),i.set(r,e.length),i},decode(e){if(!A(e))throw new Error("checksum.decode: input should be Uint8Array");const r=e.slice(0,-t),i=e.slice(-t),s=n(r).slice(0,t);for(let e=0;e<t;e++)if(s[e]!==i[e])throw new Error("Invalid checksum");return r}}),D);var t,n},W=R(L("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),C("")),G=[996825010,642813549,513874426,1027748829,705979059];function J(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<G.length;e++)1==(t>>e&1)&&(n^=G[e]);return n}function Y(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=J(i)^n>>5}i=J(i);for(let t=0;t<r;t++)i=J(i)^31&e.charCodeAt(t);for(let e of t)i=J(i)^e;for(let e=0;e<6;e++)i=J(i);return i^=n,W.encode(q([i%j[30]],30,5,!1))}function X(e){const t="bech32"===e?1:734539939,n=M(5),r=n.decode,i=n.encode,s=z(r);function o(e,n,r=90){B("bech32.encode prefix",e),A(n)&&(n=Array.from(n)),U("bech32.encode",n);const i=e.length;if(0===i)throw new TypeError(`Invalid prefix length ${i}`);const s=i+7+n.length;if(!1!==r&&s>r)throw new TypeError(`Length ${s} exceeds limit ${r}`);const o=e.toLowerCase(),a=Y(o,n,t);return`${o}1${W.encode(n)}${a}`}function a(e,n=90){B("bech32.decode input",e);const r=e.length;if(r<8||!1!==n&&r>n)throw new TypeError(`invalid string length: ${r} (${e}). Expected (8..${n})`);const i=e.toLowerCase();if(e!==i&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=i.lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const o=i.slice(0,s),a=i.slice(s+1);if(a.length<6)throw new Error("Data must be at least 6 characters long");const c=W.decode(a).slice(0,-6),u=Y(o,c,t);if(!a.endsWith(u))throw new Error(`Invalid checksum in ${e}: expected "${u}"`);return{prefix:o,words:c}}return{encode:o,decode:a,encodeFromBytes:function(e,t){return o(e,i(t))},decodeToBytes:function(e){const{prefix:t,words:n}=a(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:z(a),fromWords:r,fromWordsUnsafe:s,toWords:i}}const Q=X("bech32"),ee=X("bech32m"),te=e=>K(m).encode(e),ne=e=>K(m).decode(e),re=e=>H.encode(e),ie=e=>H.decode(e),se=e=>F.encode(e),oe=e=>F.decode(e),ae={to_words:Q.toWords,to_bytes:Q.fromWords,encode:(e,t,n=!1)=>Q.encode(e,t,n),decode:(e,t=!1)=>{const{prefix:n,words:r}=Q.decode(e,t);return{prefix:n,words:r}}},ce={to_words:ee.toWords,to_bytes:ee.fromWords,encode:(e,t,n=!1)=>ee.encode(e,t,n),decode:(e,t=!1)=>{const{prefix:n,words:r}=ee.decode(e,t);return{prefix:n,words:r}}},ue=BigInt(0),de=BigInt(255),le=BigInt(256);function he(e,t,n="be"){void 0===t&&(t=function(e){if(e<=0xffn)return 1;if(e<=0xffffn)return 2;if(e<=0xffffffffn)return 4;if(e<=0xffffffffffffffffn)return 8;if(e<=0xffffffffffffffffffffffffffffffffn)return 16;if(e<=0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffn)return 32;throw new TypeError("Must specify a fixed buffer size for bigints greater than 32 bytes.")}(e));const r="le"===n,i=new ArrayBuffer(t),s=new DataView(i);let o=r?0:t-1;for(;e>ue;){const t=e&de,n=Number(t);r?s.setUint8(o++,n):s.setUint8(o--,n),e=(e-t)/le}return new Uint8Array(i)}function fe(e,t,n="be"){void 0===t&&(t=function(e){if(e<=255)return 1;if(e<=65535)return 2;if(e<=4294967295)return 4;throw new TypeError("Numbers larger than 4 bytes must specify a fixed size!")}(e));const r="le"===n,i=new ArrayBuffer(t),s=new DataView(i);let o=r?0:t-1;for(;e>0;){const t=255&e;r?s.setUint8(o++,e):s.setUint8(o--,e),e=(e-t)/256}return new Uint8Array(i)}function pe(e){return null===e.match(/[^a-fA-F0-9]/)&&e.length%2==0}function ge(e){return!("string"!=typeof e||!pe(e))||("number"==typeof e||"bigint"==typeof e||e instanceof Uint8Array||!(!Array.isArray(e)||!e.every((e=>"number"==typeof e))))}function ye(e,t,n="be"){void 0===t&&(t=e.length),function(e,t){if(e.length>t)throw new TypeError(`Data is larger than array size: ${e.length} > ${t}`)}(e,t);const r=new Uint8Array(t).fill(0),i="be"===n?0:t-e.length;return r.set(e,i),r}function me(e){let t,n=0;const r=e.reduce(((e,t)=>e+t.length),0),i=new Uint8Array(r);for(t=0;t<e.length;t++){const r=e[t];i.set(r,n),n+=r.length}return i}function we(e,t){return"bigint"==typeof t?`${t}n`:t}function be(e,t){return"string"==typeof t&&/^[0-9]+n$/.test(t)?BigInt(t.slice(0,-1)):t}function ve(e,t,n){if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e instanceof Uint8Array)return ye(e,t,n);if(Array.isArray(e)){return me(e.map((e=>ve(e,t,n))))}if("string"==typeof e)return function(e,t,n="le"){t=k(e,t);const r="le"===n,i=new ArrayBuffer(t),s=new DataView(i);let o=r?0:t-1;for(let t=0;t<e.length;t+=2){const n=e.substring(t,t+2),i=parseInt(n,16);r?s.setUint8(o++,i):s.setUint8(o--,i)}return new Uint8Array(i)}(e,t,n);if("bigint"==typeof e)return he(e,t,n);if("number"==typeof e)return fe(e,t,n);if("boolean"==typeof e)return Uint8Array.of(e?1:0);throw new TypeError("Unsupported format:"+String(typeof e))}class _e extends Uint8Array{static{this.num=Ee}static{this.big=ke}static{this.bin=xe}static{this.raw=Ae}static{this.str=Se}static{this.hex=Ie}static{this.bytes=Pe}static{this.json=Be}static{this.base64=Te}static{this.b64url=Oe}static{this.bech32=Ne}static{this.bech32m=Ue}static{this.b58chk=Re}static{this.encode=E}static{this.decode=x}static{this.parse=Le}static{this.is_bytes=ge}static{this.is_hex=pe}static{this.is_equal=Ce}static random(e=32){const t=d(e);return new _e(t,e)}static now(e=4){const t=Math.floor(Date.now()/1e3);return new _e(t,e)}constructor(e,t,n){if(e instanceof _e&&void 0===t)return e;super(ve(e,t,n))}get arr(){return[...this]}get num(){return this.to_num()}get big(){return this.to_big()}get str(){return this.to_str()}get hex(){return this.to_hex()}get raw(){return new Uint8Array(this)}get bin(){return this.to_bin()}get b58chk(){return this.to_b58chk()}get base64(){return this.to_base64()}get b64url(){return this.to_b64url()}get digest(){return this.to_hash()}get id(){return this.to_hash().hex}get stream(){return new Ze(this)}to_num(e="be"){return function(e){let t=0;for(let n=e.length-1;n>=0;n--)t=256*t+e[n],w(t);return t}("be"===e?this.reverse():this)}to_big(e="be"){return function(e){let t=BigInt(0);for(let n=e.length-1;n>=0;n--)t=t*le+BigInt(e[n]);return BigInt(t)}("be"===e?this.reverse():this)}to_bin(){return function(e){const t=new Array(8*e.length);let n=0;for(const r of e){if(r>255)throw new Error(`Invalid byte value: ${r}. Byte values must be between 0 and 255.`);for(let e=7;e>=0;e--,n++)t[n]=r>>e&1}return t.join("")}(this)}to_hash(){const e=m(this);return new _e(e)}to_json(e){void 0===e&&(e=be);const t=x(this);return JSON.parse(t,e)}to_bech32(e,t){const{encode:n,to_words:r}=ae;return n(e,r(this),t)}to_bech32m(e,t){const{encode:n,to_words:r}=ce;return n(e,r(this),t)}to_str(){return x(this)}to_hex(){return function(e){let t="";for(let n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t}(this)}to_bytes(){return new Uint8Array(this)}to_b58chk(){return te(this)}to_base64(){return re(this)}to_b64url(){return se(this)}append(e){return _e.join([this,_e.bytes(e)])}equals(e){return Pe(e).hex===this.hex}prepend(e){return _e.join([_e.bytes(e),this])}reverse(){const e=new Uint8Array(this).reverse();return new _e(e)}slice(e,t){const n=new Uint8Array(this).slice(e,t);return new _e(n)}set(e,t){this.set(e,t)}subarray(e,t){const n=new Uint8Array(this).subarray(e,t);return new _e(n)}write(e,t){const n=_e.bytes(e);this.set(n,t)}add_varint(e){const t=_e.calc_varint(this.length,e);return _e.join([t,this])}toJSON(){return this.hex}toString(){return this.hex}static from(e){return new _e(Uint8Array.from(e))}static of(...e){return new _e(Uint8Array.of(...e))}static join(e){const t=me(e.map((e=>_e.bytes(e))));return new _e(t)}static sort(e,t){const n=e.map((e=>Pe(e,t).hex));return n.sort(),n.map((e=>_e.hex(e,t)))}static calc_varint(e,t){if(e<253)return _e.num(e,1);if(e<65536)return _e.of(253,..._e.num(e,2,t));if(e<4294967296)return _e.of(254,..._e.num(e,4,t));if(BigInt(e)<0x10000000000000000n)return _e.of(255,..._e.num(e,8,t));throw new Error(`Value is too large: ${e}`)}}function Ee(e,t,n){return new _e(e,t,n)}function xe(e,t,n){return new _e(function(e){const t=e.split("").map(Number);if(t.length%8!=0)throw new Error(`Binary array is invalid length: ${e.length}`);const n=new Uint8Array(t.length/8);for(let e=0,r=0;e<t.length;e+=8,r++){let i=0;for(let n=0;n<8;n++)i|=t[e+n]<<7-n;n[r]=i}return n}(e),t,n)}function ke(e,t,n){return new _e(e,t,n)}function Ae(e,t,n){return new _e(e,t,n)}function Se(e,t,n){return new _e(E(e),t,n)}function Ie(e,t,n){return new _e(e,t,n)}function Be(e,t){void 0===t&&(t=we);const n=JSON.stringify(e,t);return new _e(E(n))}function Te(e){return new _e(ie(e))}function Oe(e){return new _e(oe(e))}function Ne(e,t,n){const{decode:r,to_bytes:i}=ae,{prefix:s,words:o}=r(e,t),a=i(o);return"string"==typeof n&&b(s,n),new _e(a)}function Ue(e,t,n){const{decode:r,to_bytes:i}=ce,{prefix:s,words:o}=r(e,t),a=i(o);return"string"==typeof n&&b(s,n),new _e(a)}function Re(e){return new _e(ne(e))}function Le(e,t,n){const r=function(e,t,n){const r=e.length,i=n/t;if(n%t!=0)throw new TypeError(`Invalid parameters: ${n} % ${t} !== 0`);if(r!==n)throw new TypeError(`Invalid data stream: ${r} !== ${n}`);if(r%t!=0)throw new TypeError(`Invalid data stream: ${r} % ${t} !== 0`);const s=new Array(i);for(let n=0;n<i;n++){const r=n*t;s[n]=e.subarray(r,r+t)}return s}(ve(e),t,n);return r.map((e=>_e.bytes(e)))}function Ce(e,t){return new _e(e).hex===new _e(t).hex}function Pe(e,t,n){return new _e(e,t,n)}class Ze{constructor(e){this.data=_e.bytes(e),this.size=this.data.length}peek(e){if(e>this.size)throw new Error(`Size greater than stream: ${e} > ${this.size}`);return new _e(this.data.slice(0,e))}read(e){const t=this.peek(e);return this.data=this.data.slice(e),this.size=this.data.length,t}read_varint(e){const t=this.read(1).num;switch(!0){case t>=0&&t<253:return t;case 253===t:return this.read(2).to_num(e);case 254===t:return this.read(4).to_num(e);case 255===t:return this.read(8).to_num(e);default:throw new Error(`Varint is out of range: ${t}`)}}}let $e=class extends c{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");t(e.outputLen),t(e.blockLen)}(e);const r=a(n);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let e=0;e<s.length;e++)s[e]^=54;this.iHash.update(s),this.oHash=e.create();for(let e=0;e<s.length;e++)s[e]^=106;this.oHash.update(s),s.fill(0)}update(e){return r(this),this.iHash.update(e),this}digestInto(e){r(this),n(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=r,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const je=(e,t,n)=>new $e(e,t).update(n).digest();je.create=(e,t)=>new $e(e,t)
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */;const qe=BigInt(0),Me=BigInt(1),ze=BigInt(2);function He(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function Fe(e){if(!He(e))throw new Error("Uint8Array expected")}function De(e,t){if("boolean"!=typeof t)throw new Error(e+" boolean expected, got "+t)}const Ve=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Ke(e){Fe(e);let t="";for(let n=0;n<e.length;n++)t+=Ve[e[n]];return t}function We(e){const t=e.toString(16);return 1&t.length?"0"+t:t}function Ge(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return""===e?qe:BigInt("0x"+e)}const Je=48,Ye=57,Xe=65,Qe=70,et=97,tt=102;function nt(e){return e>=Je&&e<=Ye?e-Je:e>=Xe&&e<=Qe?e-(Xe-10):e>=et&&e<=tt?e-(et-10):void 0}function rt(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=nt(e.charCodeAt(i)),s=nt(e.charCodeAt(i+1));if(void 0===n||void 0===s){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+s}return r}function it(e){return Ge(Ke(e))}function st(e){return Fe(e),Ge(Ke(Uint8Array.from(e).reverse()))}function ot(e,t){return rt(e.toString(16).padStart(2*t,"0"))}function at(e,t){return ot(e,t).reverse()}function ct(e,t,n){let r;if("string"==typeof t)try{r=rt(t)}catch(t){throw new Error(e+" must be hex string or Uint8Array, cause: "+t)}else{if(!He(t))throw new Error(e+" must be hex string or Uint8Array");r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(e+" of length "+n+" expected, got "+i);return r}function ut(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];Fe(r),t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}function dt(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}const lt=e=>"bigint"==typeof e&&qe<=e;function ht(e,t,n){return lt(e)&&lt(t)&&lt(n)&&t<=e&&e<n}function ft(e,t,n,r){if(!ht(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function pt(e){let t;for(t=0;e>qe;e>>=Me,t+=1);return t}const gt=e=>(ze<<BigInt(e-1))-Me,yt=e=>new Uint8Array(e),mt=e=>Uint8Array.from(e);function wt(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=yt(e),i=yt(e),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...e)=>n(i,r,...e),c=(e=yt())=>{i=a(mt([0]),e),r=a(),0!==e.length&&(i=a(mt([1]),e),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return ut(...n)};return(e,t)=>{let n;for(o(),c(e);!(n=t(u()));)c();return o(),n}}const bt={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||He(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function vt(e,t,n={}){const r=(t,n,r)=>{const i=bt[n];if("function"!=typeof i)throw new Error("invalid validator function");const s=e[t];if(!(r&&void 0===s||i(s,e)))throw new Error("param "+String(t)+" is invalid. Expected "+n+", got "+s)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}function _t(e){const t=new WeakMap;return(n,...r)=>{const i=t.get(n);if(void 0!==i)return i;const s=e(n,...r);return t.set(n,s),s}}var Et=Object.freeze({__proto__:null,aInRange:ft,abool:De,abytes:Fe,bitGet:function(e,t){return e>>BigInt(t)&Me},bitLen:pt,bitMask:gt,bitSet:function(e,t,n){return e|(n?Me:qe)<<BigInt(t)},bytesToHex:Ke,bytesToNumberBE:it,bytesToNumberLE:st,concatBytes:ut,createHmacDrbg:wt,ensureBytes:ct,equalBytes:function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n},hexToBytes:rt,hexToNumber:Ge,inRange:ht,isBytes:He,memoized:_t,notImplemented:()=>{throw new Error("not implemented")},numberToBytesBE:ot,numberToBytesLE:at,numberToHexUnpadded:We,numberToVarBytesBE:function(e){return rt(We(e))},utf8ToBytes:dt,validateObject:vt});
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xt=BigInt(0),kt=BigInt(1),At=BigInt(2),St=BigInt(3),It=BigInt(4),Bt=BigInt(5),Tt=BigInt(8);function Ot(e,t){const n=e%t;return n>=xt?n:t+n}function Nt(e,t,n){if(t<xt)throw new Error("invalid exponent, negatives unsupported");if(n<=xt)throw new Error("invalid modulus");if(n===kt)return xt;let r=kt;for(;t>xt;)t&kt&&(r=r*e%n),e=e*e%n,t>>=kt;return r}function Ut(e,t,n){let r=e;for(;t-- >xt;)r*=r,r%=n;return r}function Rt(e,t){if(e===xt)throw new Error("invert: expected non-zero number");if(t<=xt)throw new Error("invert: expected positive modulus, got "+t);let n=Ot(e,t),r=t,i=xt,s=kt;for(;n!==xt;){const e=r%n,t=i-s*(r/n);r=n,n=e,i=s,s=t}if(r!==kt)throw new Error("invert: does not exist");return Ot(i,t)}function Lt(e){if(e%It===St){const t=(e+kt)/It;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%Tt===Bt){const t=(e-Bt)/Tt;return function(e,n){const r=e.mul(n,At),i=e.pow(r,t),s=e.mul(n,i),o=e.mul(e.mul(s,At),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-kt)/At;let n,r,i;for(n=e-kt,r=0;n%At===xt;n/=At,r++);for(i=At;i<e&&Nt(i,t,e)!==e-kt;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(1===r){const t=(e+kt)/It;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+kt)/At;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),u=e.pow(o,s),d=e.pow(o,n);for(;!e.eql(d,e.ONE);){if(e.eql(d,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(d);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,kt<<BigInt(a-t-1));c=e.sqr(n),u=e.mul(u,n),d=e.mul(d,c),a=t}return u}}(e)}const Ct=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pt(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Zt(e,t,n=!1,r={}){if(e<=xt)throw new Error("invalid field: expected ORDER > 0, got "+e);const{nBitLength:i,nByteLength:s}=Pt(e,t);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:e,isLE:n,BITS:i,BYTES:s,MASK:gt(i),ZERO:xt,ONE:kt,create:t=>Ot(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("invalid field element: expected bigint, got "+typeof t);return xt<=t&&t<e},is0:e=>e===xt,isOdd:e=>(e&kt)===kt,neg:t=>Ot(-t,e),eql:(e,t)=>e===t,sqr:t=>Ot(t*t,e),add:(t,n)=>Ot(t+n,e),sub:(t,n)=>Ot(t-n,e),mul:(t,n)=>Ot(t*n,e),pow:(e,t)=>function(e,t,n){if(n<xt)throw new Error("invalid exponent, negatives unsupported");if(n===xt)return e.ONE;if(n===kt)return t;let r=e.ONE,i=t;for(;n>xt;)n&kt&&(r=e.mul(r,i)),i=e.sqr(i),n>>=kt;return r}(a,e,t),div:(t,n)=>Ot(t*Rt(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Rt(t,e),sqrt:r.sqrt||(t=>(o||(o=Lt(e)),o(a,t))),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?at(e,s):ot(e,s),fromBytes:e=>{if(e.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+e.length);return n?st(e):it(e)}});return Object.freeze(a)}function $t(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function jt(e){const t=$t(e);return t+Math.ceil(t/2)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const qt=BigInt(0),Mt=BigInt(1);function zt(e,t){const n=t.negate();return e?n:t}function Ht(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Ft(e,t){Ht(e,t);return{windows:Math.ceil(t/e)+1,windowSize:2**(e-1)}}const Dt=new WeakMap,Vt=new WeakMap;function Kt(e){return Vt.get(e)||1}function Wt(e,t,n,r){if(function(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach(((e,n)=>{if(!(e instanceof t))throw new Error("invalid point at index "+n)}))}(n,e),function(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach(((e,n)=>{if(!t.isValid(e))throw new Error("invalid scalar at index "+n)}))}(r,t),n.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=e.ZERO,s=pt(BigInt(n.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i);let u=i;for(let e=Math.floor((t.BITS-1)/o)*o;e>=0;e-=o){c.fill(i);for(let t=0;t<r.length;t++){const i=r[t],s=Number(i>>BigInt(e)&BigInt(a));c[s]=c[s].add(n[t])}let t=i;for(let e=c.length-1,n=i;e>0;e--)n=n.add(c[e]),t=t.add(n);if(u=u.add(t),0!==e)for(let e=0;e<o;e++)u=u.double()}return u}function Gt(e){return vt(e.Fp,Ct.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),vt(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Pt(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Jt(e){void 0!==e.lowS&&De("lowS",e.lowS),void 0!==e.prehash&&De("prehash",e.prehash)}const{bytesToNumberBE:Yt,hexToBytes:Xt}=Et;class Qt extends Error{constructor(e=""){super(e)}}const en={Err:Qt,_tlv:{encode:(e,t)=>{const{Err:n}=en;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(1&t.length)throw new n("tlv.encode: unpadded data");const r=t.length/2,i=We(r);if(i.length/2&128)throw new n("tlv.encode: long form length too big");const s=r>127?We(i.length/2|128):"";return We(e)+s+i+t},decode(e,t){const{Err:n}=en;let r=0;if(e<0||e>256)throw new n("tlv.encode: wrong tag");if(t.length<2||t[r++]!==e)throw new n("tlv.decode: wrong tlv");const i=t[r++];let s=0;if(!!(128&i)){const e=127&i;if(!e)throw new n("tlv.decode(long): indefinite length not supported");if(e>4)throw new n("tlv.decode(long): byte length is too big");const o=t.subarray(r,r+e);if(o.length!==e)throw new n("tlv.decode: length bytes not complete");if(0===o[0])throw new n("tlv.decode(long): zero leftmost byte");for(const e of o)s=s<<8|e;if(r+=e,s<128)throw new n("tlv.decode(long): not minimal encoding")}else s=i;const o=t.subarray(r,r+s);if(o.length!==s)throw new n("tlv.decode: wrong value length");return{v:o,l:t.subarray(r+s)}}},_int:{encode(e){const{Err:t}=en;if(e<tn)throw new t("integer: negative integers are not allowed");let n=We(e);if(8&Number.parseInt(n[0],16)&&(n="00"+n),1&n.length)throw new t("unexpected DER parsing assertion: unpadded hex");return n},decode(e){const{Err:t}=en;if(128&e[0])throw new t("invalid signature integer: negative");if(0===e[0]&&!(128&e[1]))throw new t("invalid signature integer: unnecessary leading zero");return Yt(e)}},toSig(e){const{Err:t,_int:n,_tlv:r}=en,i="string"==typeof e?Xt(e):e;Fe(i);const{v:s,l:o}=r.decode(48,i);if(o.length)throw new t("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l:d}=r.decode(2,c);if(d.length)throw new t("invalid signature: left bytes after parsing");return{r:n.decode(a),s:n.decode(u)}},hexFromSig(e){const{_tlv:t,_int:n}=en,r=t.encode(2,n.encode(e.r))+t.encode(2,n.encode(e.s));return t.encode(48,r)}},tn=BigInt(0),nn=BigInt(1);BigInt(2);const rn=BigInt(3);function sn(e){const t=function(e){const t=Gt(e);vt(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=Zt(t.n,t.nBitLength),i=t.toBytes||((e,t,r)=>{const i=t.toAffine();return ut(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),s=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,s=n.sqr(e),o=n.mul(s,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function a(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=t;if(n&&"bigint"!=typeof e){if(He(e)&&(e=Ke(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("invalid private key");e=e.padStart(2*r,"0")}let o;try{o="bigint"==typeof e?e:it(ct("private key",e,r))}catch(t){throw new Error("invalid private key, expected hex or "+r+" bytes, got "+typeof e)}return i&&(o=Ot(o,s)),ft("private key",o,nn,s),o}function c(e){if(!(e instanceof l))throw new Error("ProjectivePoint expected")}const u=_t(((e,t)=>{const{px:r,py:i,pz:s}=e;if(n.eql(s,n.ONE))return{x:r,y:i};const o=e.is0();null==t&&(t=o?n.ONE:n.inv(s));const a=n.mul(r,t),c=n.mul(i,t),u=n.mul(s,t);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(u,n.ONE))throw new Error("invZ was invalid");return{x:a,y:c}})),d=_t((e=>{if(e.is0()){if(t.allowInfinityPoint&&!n.is0(e.py))return;throw new Error("bad point: ZERO")}const{x:r,y:i}=e.toAffine();if(!n.isValid(r)||!n.isValid(i))throw new Error("bad point: x or y not FE");const s=n.sqr(i),a=o(r);if(!n.eql(s,a))throw new Error("bad point: equation left != right");if(!e.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0}));class l{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required");Object.freeze(this)}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof l)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?l.ZERO:new l(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(l.fromAffine)}static fromHex(e){const t=l.fromAffine(s(ct("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return l.BASE.multiply(a(e))}static msm(e,t){return Wt(l,r,e,t)}_setWindowSize(e){f.setWindowSize(this,e)}assertValidity(){d(this)}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){c(e);const{px:t,py:r,pz:i}=this,{px:s,py:o,pz:a}=e,u=n.eql(n.mul(t,a),n.mul(s,i)),d=n.eql(n.mul(r,a),n.mul(o,i));return u&&d}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,rn),{px:s,py:o,pz:a}=this;let c=n.ZERO,u=n.ZERO,d=n.ZERO,h=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(s,o);return g=n.add(g,g),d=n.mul(s,a),d=n.add(d,d),c=n.mul(e,d),u=n.mul(i,p),u=n.add(c,u),c=n.sub(f,u),u=n.add(f,u),u=n.mul(c,u),c=n.mul(g,c),d=n.mul(i,d),p=n.mul(e,p),g=n.sub(h,p),g=n.mul(e,g),g=n.add(g,d),d=n.add(h,h),h=n.add(d,h),h=n.add(h,p),h=n.mul(h,g),u=n.add(u,h),p=n.mul(o,a),p=n.add(p,p),h=n.mul(p,g),c=n.sub(c,h),d=n.mul(p,f),d=n.add(d,d),d=n.add(d,d),new l(c,u,d)}add(e){c(e);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:u}=e;let d=n.ZERO,h=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,rn);let y=n.mul(r,o),m=n.mul(i,a),w=n.mul(s,u),b=n.add(r,i),v=n.add(o,a);b=n.mul(b,v),v=n.add(y,m),b=n.sub(b,v),v=n.add(r,s);let _=n.add(o,u);return v=n.mul(v,_),_=n.add(y,w),v=n.sub(v,_),_=n.add(i,s),d=n.add(a,u),_=n.mul(_,d),d=n.add(m,w),_=n.sub(_,d),f=n.mul(p,v),d=n.mul(g,w),f=n.add(d,f),d=n.sub(m,f),f=n.add(m,f),h=n.mul(d,f),m=n.add(y,y),m=n.add(m,y),w=n.mul(p,w),v=n.mul(g,v),m=n.add(m,w),w=n.sub(y,w),w=n.mul(p,w),v=n.add(v,w),y=n.mul(m,v),h=n.add(h,y),y=n.mul(_,v),d=n.mul(b,d),d=n.sub(d,y),y=n.mul(b,m),f=n.mul(_,f),f=n.add(f,y),new l(d,h,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(l.ZERO)}wNAF(e){return f.wNAFCached(this,e,l.normalizeZ)}multiplyUnsafe(e){const{endo:r,n:i}=t;ft("scalar",e,tn,i);const s=l.ZERO;if(e===tn)return s;if(this.is0()||e===nn)return this;if(!r||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,e,l.normalizeZ);let{k1neg:o,k1:a,k2neg:c,k2:u}=r.splitScalar(e),d=s,h=s,p=this;for(;a>tn||u>tn;)a&nn&&(d=d.add(p)),u&nn&&(h=h.add(p)),p=p.double(),a>>=nn,u>>=nn;return o&&(d=d.negate()),c&&(h=h.negate()),h=new l(n.mul(h.px,r.beta),h.py,h.pz),d.add(h)}multiply(e){const{endo:r,n:i}=t;let s,o;if(ft("scalar",e,nn,i),r){const{k1neg:t,k1:i,k2neg:a,k2:c}=r.splitScalar(e);let{p:u,f:d}=this.wNAF(i),{p:h,f:p}=this.wNAF(c);u=f.constTimeNegate(t,u),h=f.constTimeNegate(a,h),h=new l(n.mul(h.px,r.beta),h.py,h.pz),s=u.add(h),o=d.add(p)}else{const{p:t,f:n}=this.wNAF(e);s=t,o=n}return l.normalizeZ([s,o])[0]}multiplyAndAddUnsafe(e,t,n){const r=l.BASE,i=(e,t)=>t!==tn&&t!==nn&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,n));return s.is0()?void 0:s}toAffine(e){return u(this,e)}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===nn)return!0;if(n)return n(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===nn?this:n?n(l,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return De("isCompressed",e),this.assertValidity(),i(l,this,e)}toHex(e=!0){return De("isCompressed",e),Ke(this.toRawBytes(e))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const h=t.nBitLength,f=(p=l,g=t.endo?Math.ceil(h/2):h,{constTimeNegate:zt,hasPrecomputes:e=>1!==Kt(e),unsafeLadder(e,t,n=p.ZERO){let r=e;for(;t>qt;)t&Mt&&(n=n.add(r)),r=r.double(),t>>=Mt;return n},precomputeWindow(e,t){const{windows:n,windowSize:r}=Ft(t,g),i=[];let s=e,o=s;for(let e=0;e<n;e++){o=s,i.push(o);for(let e=1;e<r;e++)o=o.add(s),i.push(o);s=o.double()}return i},wNAF(e,t,n){const{windows:r,windowSize:i}=Ft(e,g);let s=p.ZERO,o=p.BASE;const a=BigInt(2**e-1),c=2**e,u=BigInt(e);for(let e=0;e<r;e++){const r=e*i;let d=Number(n&a);n>>=u,d>i&&(d-=c,n+=Mt);const l=r,h=r+Math.abs(d)-1,f=e%2!=0,p=d<0;0===d?o=o.add(zt(f,t[l])):s=s.add(zt(p,t[h]))}return{p:s,f:o}},wNAFUnsafe(e,t,n,r=p.ZERO){const{windows:i,windowSize:s}=Ft(e,g),o=BigInt(2**e-1),a=2**e,c=BigInt(e);for(let e=0;e<i;e++){const i=e*s;if(n===qt)break;let u=Number(n&o);if(n>>=c,u>s&&(u-=a,n+=Mt),0===u)continue;let d=t[i+Math.abs(u)-1];u<0&&(d=d.negate()),r=r.add(d)}return r},getPrecomputes(e,t,n){let r=Dt.get(t);return r||(r=this.precomputeWindow(t,e),1!==e&&Dt.set(t,n(r))),r},wNAFCached(e,t,n){const r=Kt(e);return this.wNAF(r,this.getPrecomputes(r,e,n),t)},wNAFCachedUnsafe(e,t,n,r){const i=Kt(e);return 1===i?this.unsafeLadder(e,t,r):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,r)},setWindowSize(e,t){Ht(t,g),Vt.set(e,t),Dt.delete(e)}});var p,g;return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder:function(e){return ht(e,nn,t.n)}}}function on(e){const t=function(e){const t=Gt(e);return vt(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,s=2*n.BYTES+1;function o(e){return Ot(e,r)}function a(e){return Rt(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:l}=sn({...t,toBytes(e,t,r){const i=t.toAffine(),s=n.toBytes(i.x),o=ut;return De("isCompressed",r),r?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],o=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===s&&4===r){return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))}}throw new Error("invalid Point, expected length of "+i+", or uncompressed "+s+", got "+t)}{const e=it(o);if(!ht(e,nn,n.ORDER))throw new Error("Point is not on curve");const t=d(e);let i;try{i=n.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("Point is not on curve"+t)}return!(1&~r)!==((i&nn)===nn)&&(i=n.neg(i)),{x:e,y:i}}}}),h=e=>Ke(ot(e,t.nByteLength));function f(e){return e>r>>nn}const p=(e,t,n)=>it(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=ct("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=en.toSig(ct("DER",e));return new g(t,n)}assertValidity(){ft("r",this.r,nn,r),ft("s",this.s,nn,r)}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:i,recovery:s}=this,u=b(ct("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const d=2===s||3===s?r+t.n:r;if(d>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const l=1&s?"03":"02",f=c.fromHex(l+h(d)),p=a(d),g=o(-u*p),y=o(i*p),m=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return rt(this.toDERHex())}toDERHex(){return en.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return rt(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const y={isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const e=jt(t.n);return function(e,t,n=!1){const r=e.length,i=$t(t),s=jt(t);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=Ot(n?st(e):it(e),t-kt)+kt;return n?at(o,i):ot(o,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function m(e){const t=He(e),n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===s:n?r===2*i||r===2*s:e instanceof c}const w=t.bits2int||function(e){if(e.length>8192)throw new Error("input is too large");const n=it(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return o(w(e))},v=gt(t.nBitLength);function _(e){return ft("num < 2^"+t.nBitLength,e,tn,v),ot(e,t.nByteLength)}function E(e,r,i=x){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:d}=t;let{lowS:h,prehash:p,extraEntropy:y}=i;null==h&&(h=!0),e=ct("msgHash",e),Jt(i),p&&(e=ct("prehashed msgHash",s(e)));const m=b(e),v=u(r),E=[_(v),_(m)];if(null!=y&&!1!==y){const e=!0===y?d(n.BYTES):y;E.push(ct("extraEntropy",e))}const k=ut(...E),A=m;return{seed:k,k2sig:function(e){const t=w(e);if(!l(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i===tn)return;const s=o(n*o(A+i*v));if(s===tn)return;let u=(r.x===i?0:2)|Number(r.y&nn),d=s;return h&&f(s)&&(d=function(e){return f(e)?o(-e):e}(s),u^=1),new g(i,d,u)}}}const x={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(u(e)).toRawBytes(n)},sign:function(e,n,r=x){const{seed:i,k2sig:s}=E(e,n,r),o=t;return wt(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)},verify:function(e,n,r,i=k){const s=e;n=ct("msgHash",n),r=ct("publicKey",r);const{lowS:u,prehash:d,format:l}=i;if(Jt(i),"strict"in i)throw new Error("options.strict was renamed to lowS");if(void 0!==l&&"compact"!==l&&"der"!==l)throw new Error("format must be compact or der");const h="string"==typeof s||He(s),f=!h&&!l&&"object"==typeof s&&null!==s&&"bigint"==typeof s.r&&"bigint"==typeof s.s;if(!h&&!f)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,y;try{if(f&&(p=new g(s.r,s.s)),h){try{"compact"!==l&&(p=g.fromDER(s))}catch(e){if(!(e instanceof en.Err))throw e}p||"der"===l||(p=g.fromCompact(s))}y=c.fromHex(r)}catch(e){return!1}if(!p)return!1;if(u&&p.hasHighS())return!1;d&&(n=t.hash(n));const{r:m,s:w}=p,v=b(n),_=a(w),E=o(v*_),x=o(m*_),A=c.BASE.multiplyAndAddUnsafe(y,E,x)?.toAffine();return!!A&&o(A.x)===m},ProjectivePoint:c,Signature:g,utils:y}}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function an(e){return{hash:e,hmac:(t,...r)=>je(e,t,function(...e){let t=0;for(let r=0;r<e.length;r++){const i=e[r];n(i),t+=i.length}const r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const i=e[t];r.set(i,n),n+=i.length}return r}(...r)),randomBytes:d}}BigInt(4);const cn=it;function un(e,t){if(ln(e),ln(t),e<0||e>=1<<8*t)throw new Error("invalid I2OSP input: "+e);const n=Array.from({length:t}).fill(0);for(let r=t-1;r>=0;r--)n[r]=255&e,e>>>=8;return new Uint8Array(n)}function dn(e,t){const n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}function ln(e){if(!Number.isSafeInteger(e))throw new Error("number expected")}function hn(e,t,n){vt(n,{DST:"stringOrUint8Array",p:"bigint",m:"isSafeInteger",k:"isSafeInteger",hash:"hash"});const{p:r,k:i,m:s,hash:o,expand:a,DST:c}=n;Fe(e),ln(t);const u="string"==typeof c?dt(c):c,d=r.toString(2).length,l=Math.ceil((d+i)/8),h=t*s*l;let f;if("xmd"===a)f=function(e,t,n,r){Fe(e),Fe(t),ln(n),t.length>255&&(t=r(ut(dt("H2C-OVERSIZE-DST-"),t)));const{outputLen:i,blockLen:s}=r,o=Math.ceil(n/i);if(n>65535||o>255)throw new Error("expand_message_xmd: invalid lenInBytes");const a=ut(t,un(t.length,1)),c=un(0,s),u=un(n,2),d=new Array(o),l=r(ut(c,e,u,un(0,1),a));d[0]=r(ut(l,un(1,1),a));for(let e=1;e<=o;e++){const t=[dn(l,d[e-1]),un(e+1,1),a];d[e]=r(ut(...t))}return ut(...d).slice(0,n)}(e,u,h,o);else if("xof"===a)f=function(e,t,n,r,i){if(Fe(e),Fe(t),ln(n),t.length>255){const e=Math.ceil(2*r/8);t=i.create({dkLen:e}).update(dt("H2C-OVERSIZE-DST-")).update(t).digest()}if(n>65535||t.length>255)throw new Error("expand_message_xof: invalid lenInBytes");return i.create({dkLen:n}).update(e).update(un(n,2)).update(t).update(un(t.length,1)).digest()}(e,u,h,i,o);else{if("_internal_pass"!==a)throw new Error('expand must be "xmd" or "xof"');f=e}const p=new Array(t);for(let e=0;e<t;e++){const t=new Array(s);for(let n=0;n<s;n++){const i=l*(n+e*s),o=f.subarray(i,i+l);t[n]=Ot(cn(o),r)}p[e]=t}return p}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fn=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),pn=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),gn=BigInt(1),yn=BigInt(2),mn=(e,t)=>(e+t/yn)/t;function wn(e){const t=fn,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,d=u*u*e%t,l=Ut(d,n,t)*d%t,h=Ut(l,n,t)*d%t,f=Ut(h,yn,t)*u%t,p=Ut(f,i,t)*f%t,g=Ut(p,s,t)*p%t,y=Ut(g,a,t)*g%t,m=Ut(y,c,t)*y%t,w=Ut(m,a,t)*g%t,b=Ut(w,n,t)*d%t,v=Ut(b,o,t)*p%t,_=Ut(v,r,t)*u%t,E=Ut(_,yn,t);if(!bn.eql(bn.sqr(E),e))throw new Error("Cannot find square root");return E}const bn=Zt(fn,void 0,void 0,{sqrt:wn}),vn=function(e,t){const n=t=>on({...e,...an(t)});return{...n(t),create:n}}({a:BigInt(0),b:BigInt(7),Fp:bn,n:pn,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=pn,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-gn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=mn(s*e,t),c=mn(-r*e,t);let u=Ot(e-a*n-c*i,t),d=Ot(-a*r-c*s,t);const l=u>o,h=d>o;if(l&&(u=t-u),h&&(d=t-d),u>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:u,k2neg:h,k2:d}}}},m),_n=BigInt(0),En={};function xn(e,...t){let n=En[e];if(void 0===n){const t=m(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=ut(t,t),En[e]=n}return m(ut(n,...t))}const kn=e=>e.toRawBytes(!0).slice(1),An=e=>ot(e,32),Sn=e=>Ot(e,fn),In=e=>Ot(e,pn),Bn=vn.ProjectivePoint;function Tn(e){let t=vn.utils.normPrivateKeyToScalar(e),n=Bn.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:In(-t),bytes:kn(n)}}function On(e){ft("x",e,gn,fn);const t=Sn(e*e);let n=wn(Sn(t*e+BigInt(7)));n%yn!==_n&&(n=Sn(-n));const r=new Bn(e,n,gn);return r.assertValidity(),r}const Nn=it;function Un(...e){return In(Nn(xn("BIP0340/challenge",...e)))}function Rn(e){return Tn(e).bytes}function Ln(e,t,n=d(32)){const r=ct("message",e),{bytes:i,scalar:s}=Tn(t),o=ct("auxRand",n,32),a=An(s^Nn(xn("BIP0340/aux",o))),c=xn("BIP0340/nonce",a,i,r),u=In(Nn(c));if(u===_n)throw new Error("sign failed: k is zero");const{bytes:l,scalar:h}=Tn(u),f=Un(l,i,r),p=new Uint8Array(64);if(p.set(l,0),p.set(An(In(h+f*s)),32),!Cn(p,r,i))throw new Error("sign: Invalid signature produced");return p}function Cn(e,t,n){const r=ct("signature",e,64),i=ct("message",t),s=ct("publicKey",n,32);try{const e=On(Nn(s)),t=Nn(r.subarray(0,32));if(!ht(t,gn,fn))return!1;const n=Nn(r.subarray(32,64));if(!ht(n,gn,pn))return!1;const u=Un(An(t),kn(e),i),d=(o=e,a=n,c=In(-u),Bn.BASE.multiplyAndAddUnsafe(o,a,c));return!(!d||!d.hasEvenY()||d.toAffine().x!==t)}catch(e){return!1}var o,a,c}const Pn=(()=>({getPublicKey:Rn,sign:Ln,verify:Cn,utils:{randomPrivateKey:vn.utils.randomPrivateKey,lift_x:On,pointToBytes:kn,numberToBytesBE:ot,bytesToNumberBE:it,taggedHash:xn,mod:Ot}}))();function Zn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name}function $n(e,...t){if(!Zn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function jn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function qn(e,t){$n(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const Mn=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),zn=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Hn(e){if("string"==typeof e)e=function(e){if("string"!=typeof e)throw new Error("string expected");return new Uint8Array((new TextEncoder).encode(e))}(e);else{if(!Zn(e))throw new Error("Uint8Array expected, got "+typeof e);e=Kn(e)}return e}const Fn=(e,t)=>{function n(n,...r){if($n(n),void 0!==e.nonceLength){const t=r[0];if(!t)throw new Error("nonce / iv required");e.varSizeNonce?$n(t):$n(t,e.nonceLength)}const i=e.tagLength;i&&void 0!==r[1]&&$n(r[1]);const s=t(n,...r),o=(e,t)=>{if(void 0!==t){if(2!==e)throw new Error("cipher output not supported");$n(t)}};let a=!1;const c={encrypt(e,t){if(a)throw new Error("cannot encrypt() twice with same key + nonce");return a=!0,$n(e),o(s.encrypt.length,t),s.encrypt(e,t)},decrypt(e,t){if($n(e),i&&e.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return o(s.decrypt.length,t),s.decrypt(e,t)}};return c}return Object.assign(n,e),n};function Dn(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s);e.setUint32(t+0,o,r),e.setUint32(t+4,a,r)}function Vn(e){return e.byteOffset%4==0}function Kn(e){return Uint8Array.from(e)}function Wn(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}const Gn=16,Jn=new Uint8Array(16),Yn=Mn(Jn),Xn=e=>(e>>>0&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255;class Qn{constructor(e,t){this.blockLen=Gn,this.outputLen=Gn,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,$n(e=Hn(e),16);const n=zn(e);let r=n.getUint32(0,!1),i=n.getUint32(4,!1),s=n.getUint32(8,!1),o=n.getUint32(12,!1);const a=[];for(let e=0;e<128;e++)a.push({s0:Xn(r),s1:Xn(i),s2:Xn(s),s3:Xn(o)}),({s0:r,s1:i,s2:s,s3:o}={s3:(d=s)<<31|(l=o)>>>1,s2:(u=i)<<31|d>>>1,s1:(c=r)<<31|u>>>1,s0:c>>>1^225<<24&-(1&l)});var c,u,d,l;const h=(e=>e>65536?8:e>1024?4:2)(t||1024);if(![1,2,4,8].includes(h))throw new Error("ghash: invalid window size, expected 2, 4 or 8");this.W=h;const f=128/h,p=this.windowSize=2**h,g=[];for(let e=0;e<f;e++)for(let t=0;t<p;t++){let n=0,r=0,i=0,s=0;for(let o=0;o<h;o++){if(!(t>>>h-o-1&1))continue;const{s0:c,s1:u,s2:d,s3:l}=a[h*e+o];n^=c,r^=u,i^=d,s^=l}g.push({s0:n,s1:r,s2:i,s3:s})}this.t=g}_updateBlock(e,t,n,r){e^=this.s0,t^=this.s1,n^=this.s2,r^=this.s3;const{W:i,t:s,windowSize:o}=this;let a=0,c=0,u=0,d=0;const l=(1<<i)-1;let h=0;for(const f of[e,t,n,r])for(let e=0;e<4;e++){const t=f>>>8*e&255;for(let e=8/i-1;e>=0;e--){const n=t>>>i*e&l,{s0:r,s1:f,s2:p,s3:g}=s[h*o+n];a^=r,c^=f,u^=p,d^=g,h+=1}}this.s0=a,this.s1=c,this.s2=u,this.s3=d}update(e){e=Hn(e),jn(this);const t=Mn(e),n=Math.floor(e.length/Gn),r=e.length%Gn;for(let e=0;e<n;e++)this._updateBlock(t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]);return r&&(Jn.set(e.subarray(n*Gn)),this._updateBlock(Yn[0],Yn[1],Yn[2],Yn[3]),Wn(Yn)),this}destroy(){const{t:e}=this;for(const t of e)t.s0=0,t.s1=0,t.s2=0,t.s3=0}digestInto(e){jn(this),qn(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,s=Mn(e);return s[0]=t,s[1]=n,s[2]=r,s[3]=i,e}digest(){const e=new Uint8Array(Gn);return this.digestInto(e),this.destroy(),e}}class er extends Qn{constructor(e,t){const n=function(e){e.reverse();const t=1&e[15];let n=0;for(let t=0;t<e.length;t++){const r=e[t];e[t]=r>>>1|n,n=(1&r)<<7}return e[0]^=225&-t,e}(Kn(e=Hn(e)));super(n,t),Wn(n)}update(e){e=Hn(e),jn(this);const t=Mn(e),n=e.length%Gn,r=Math.floor(e.length/Gn);for(let e=0;e<r;e++)this._updateBlock(Xn(t[4*e+3]),Xn(t[4*e+2]),Xn(t[4*e+1]),Xn(t[4*e+0]));return n&&(Jn.set(e.subarray(r*Gn)),this._updateBlock(Xn(Yn[3]),Xn(Yn[2]),Xn(Yn[1]),Xn(Yn[0])),Wn(Yn)),this}digestInto(e){jn(this),qn(e,this),this.finished=!0;const{s0:t,s1:n,s2:r,s3:i}=this,s=Mn(e);return s[0]=t,s[1]=n,s[2]=r,s[3]=i,e.reverse()}}function tr(e){const t=(t,n)=>e(n,t.length).update(Hn(t)).digest(),n=e(new Uint8Array(16),0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=(t,n)=>e(t,n),t}const nr=tr(((e,t)=>new Qn(e,t)));tr(((e,t)=>new er(e,t)));const rr=new Uint8Array(16);function ir(e){return e<<1^283&-(e>>7)}function sr(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(1&t),e=ir(e);return n}const or=(()=>{const e=new Uint8Array(256);for(let t=0,n=1;t<256;t++,n^=ir(n))e[t]=n;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return Wn(e),t})(),ar=e=>e<<8|e>>>24;function cr(e,t){if(256!==e.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>t(e[r]))),r=n.map(ar),i=r.map(ar),s=i.map(ar),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let t=0;t<256;t++)for(let u=0;u<256;u++){const d=256*t+u;o[d]=n[t]^r[u],a[d]=i[t]^s[u],c[d]=e[t]<<8|e[u]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const ur=cr(or,(e=>sr(e,3)<<24|e<<16|e<<8|sr(e,2))),dr=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=ir(n))e[t]=n;return e})();function lr(e,t,n,r,i,s){return e[n<<8&65280|r>>>8&255]^t[i>>>8&65280|s>>>24&255]}function hr(e,t,n,r,i){return e[255&t|65280&n]|e[r>>>16&255|i>>>16&65280]<<16}function fr(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=ur;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const u=e.length/4-2;for(let s=0;s<u;s++){const s=e[c++]^lr(o,a,t,n,r,i),u=e[c++]^lr(o,a,n,r,i,t),d=e[c++]^lr(o,a,r,i,t,n),l=e[c++]^lr(o,a,i,t,n,r);t=s,n=u,r=d,i=l}return{s0:e[c++]^hr(s,t,n,r,i),s1:e[c++]^hr(s,n,r,i,t),s2:e[c++]^hr(s,r,i,t,n),s3:e[c++]^hr(s,i,t,n,r)}}function pr(e,t,n,r,i){$n(n,16),$n(r),i=function(e,t,n=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!Vn(t))throw new Error("invalid output, must be aligned");return t}(r.length,i);const s=n,o=Mn(s),a=zn(s),c=Mn(r),u=Mn(i),d=t?0:12,l=r.length;let h=a.getUint32(d,t),{s0:f,s1:p,s2:g,s3:y}=fr(e,o[0],o[1],o[2],o[3]);for(let n=0;n+4<=c.length;n+=4)u[n+0]=c[n+0]^f,u[n+1]=c[n+1]^p,u[n+2]=c[n+2]^g,u[n+3]=c[n+3]^y,h=h+1>>>0,a.setUint32(d,h,t),({s0:f,s1:p,s2:g,s3:y}=fr(e,o[0],o[1],o[2],o[3]));const m=16*Math.floor(c.length/4);if(m<l){const e=new Uint32Array([f,p,g,y]),t=(w=e,new Uint8Array(w.buffer,w.byteOffset,w.byteLength));for(let e=m,n=0;e<l;e++,n++)i[e]=r[e]^t[n];Wn(e)}var w;return i}const gr=Fn({blockSize:16,nonceLength:12,tagLength:16,varSizeNonce:!0},(function(e,t,n){if(t.length<8)throw new Error("aes/gcm: invalid nonce length");function r(e,t,r){const i=function(e,t,n,r,i){const s=null==i?0:i.length,o=e.create(n,r.length+s);i&&o.update(i),o.update(r);const a=new Uint8Array(16),c=zn(a);i&&Dn(c,0,BigInt(8*s),t),Dn(c,8,BigInt(8*r.length),t),o.update(a);const u=o.digest();return Wn(a),u}(nr,!1,e,r,n);for(let e=0;e<t.length;e++)i[e]^=t[e];return i}function i(){const n=function(e){$n(e);const t=e.length;if(![16,24,32].includes(t))throw new Error("aes: invalid key size, should be 16, 24 or 32, got "+t);const{sbox2:n}=ur,r=[];Vn(e)||r.push(e=Kn(e));const i=Mn(e),s=i.length,o=e=>hr(n,e,e,e,e),a=new Uint32Array(t+28);a.set(i);for(let e=s;e<a.length;e++){let t=a[e-1];e%s==0?t=o((c=t)<<24|c>>>8)^dr[e/s-1]:s>6&&e%s==4&&(t=o(t)),a[e]=a[e-s]^t}var c;return Wn(...r),a}(e),r=rr.slice(),i=rr.slice();if(pr(n,!1,i,i,r),12===t.length)i.set(t);else{const e=rr.slice();Dn(zn(e),8,BigInt(8*t.length),!1);const n=nr.create(r).update(t).update(e);n.digestInto(i),n.destroy()}return{xk:n,authKey:r,counter:i,tagMask:pr(n,!1,i,rr)}}return{encrypt(e){const{xk:t,authKey:n,counter:s,tagMask:o}=i(),a=new Uint8Array(e.length+16),c=[t,n,s,o];Vn(e)||c.push(e=Kn(e)),pr(t,!1,s,e,a.subarray(0,e.length));const u=r(n,o,a.subarray(0,a.length-16));return c.push(u),a.set(u,e.length),Wn(...c),a},decrypt(e){const{xk:t,authKey:n,counter:s,tagMask:o}=i(),a=[t,n,o,s];Vn(e)||a.push(e=Kn(e));const c=e.subarray(0,-16),u=e.subarray(-16),d=r(n,o,c);if(a.push(d),!function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}(d,u))throw new Error("aes/gcm: invalid ghash tag");const l=pr(t,!1,s,c);return Wn(...a),l}}}));function yr(e){const t=Pn.getPublicKey(e);return new _e(t).hex}function mr(e,t){const n=66===t.length?t:"02"+t,r=vn.getSharedSecret(e,n,!0);return new _e(r).slice(1).hex}function wr(e,t,n){const r=_e.str(t),i=_e.hex(e),s=_e.random(24),o=gr(i,s).encrypt(r);return new _e(o).b64url+"?iv="+s.b64url}function br(e,t){const[n,r]=t.split("?iv="),i=_e.b64url(n),s=_e.hex(e),o=_e.b64url(r),a=gr(s,o).decrypt(i);return new _e(a).str}function vr(){return _e.random(16).hex}function _r(e){const t=JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]);return _e.str(t).digest.hex}var Er,xr;!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(Er||(Er={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(xr||(xr={}));const kr=Er.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ar=e=>{switch(typeof e){case"undefined":return kr.undefined;case"string":return kr.string;case"number":return isNaN(e)?kr.nan:kr.number;case"boolean":return kr.boolean;case"function":return kr.function;case"bigint":return kr.bigint;case"symbol":return kr.symbol;case"object":return Array.isArray(e)?kr.array:null===e?kr.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?kr.promise:"undefined"!=typeof Map&&e instanceof Map?kr.map:"undefined"!=typeof Set&&e instanceof Set?kr.set:"undefined"!=typeof Date&&e instanceof Date?kr.date:kr.object;default:return kr.unknown}},Sr=Er.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Ir extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const i of e.issues)if("invalid_union"===i.code)i.unionErrors.map(r);else if("invalid_return_type"===i.code)r(i.returnTypeError);else if("invalid_arguments"===i.code)r(i.argumentsError);else if(0===i.path.length)n._errors.push(t(i));else{let e=n,r=0;for(;r<i.path.length;){const n=i.path[r];r===i.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(i))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}static assert(e){if(!(e instanceof Ir))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Er.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Ir.create=e=>new Ir(e);const Br=(e,t)=>{let n;switch(e.code){case Sr.invalid_type:n=e.received===kr.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Sr.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Er.jsonStringifyReplacer)}`;break;case Sr.unrecognized_keys:n=`Unrecognized key(s) in object: ${Er.joinValues(e.keys,", ")}`;break;case Sr.invalid_union:n="Invalid input";break;case Sr.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Er.joinValues(e.options)}`;break;case Sr.invalid_enum_value:n=`Invalid enum value. Expected ${Er.joinValues(e.options)}, received '${e.received}'`;break;case Sr.invalid_arguments:n="Invalid function arguments";break;case Sr.invalid_return_type:n="Invalid function return type";break;case Sr.invalid_date:n="Invalid date";break;case Sr.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Er.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Sr.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Sr.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Sr.custom:n="Invalid input";break;case Sr.invalid_intersection_types:n="Intersection results could not be merged";break;case Sr.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Sr.not_finite:n="Number must be finite";break;default:n=t.defaultError,Er.assertNever(e)}return{message:n}};let Tr=Br;function Or(){return Tr}const Nr=e=>{const{data:t,path:n,errorMaps:r,issueData:i}=e,s=[...n,...i.path||[]],o={...i,path:s};if(void 0!==i.message)return{...i,path:s,message:i.message};let a="";const c=r.filter((e=>!!e)).slice().reverse();for(const e of c)a=e(o,{data:t,defaultError:a}).message;return{...i,path:s,message:a}};function Ur(e,t){const n=Or(),r=Nr({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,n,n===Br?void 0:Br].filter((e=>!!e))});e.common.issues.push(r)}class Rr{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Lr;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t){const t=await e.key,r=await e.value;n.push({key:t,value:r})}return Rr.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:i}=r;if("aborted"===t.status)return Lr;if("aborted"===i.status)return Lr;"dirty"===t.status&&e.dirty(),"dirty"===i.status&&e.dirty(),"__proto__"===t.value||void 0===i.value&&!r.alwaysSet||(n[t.value]=i.value)}return{status:e.value,value:n}}}const Lr=Object.freeze({status:"aborted"}),Cr=e=>({status:"dirty",value:e}),Pr=e=>({status:"valid",value:e}),Zr=e=>"aborted"===e.status,$r=e=>"dirty"===e.status,jr=e=>"valid"===e.status,qr=e=>"undefined"!=typeof Promise&&e instanceof Promise;function Mr(e,t,n,r){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t.get(e)}function zr(e,t,n,r,i){if("function"==typeof t||!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n}var Hr,Fr,Dr;"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Hr||(Hr={}));class Vr{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Kr=(e,t)=>{if(jr(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Ir(e.common.issues);return this._error=t,this._error}}};function Wr(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:i}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');if(t)return{errorMap:t,description:i};return{errorMap:(t,i)=>{var s,o;const{message:a}=e;return"invalid_enum_value"===t.code?{message:null!=a?a:i.defaultError}:void 0===i.data?{message:null!==(s=null!=a?a:r)&&void 0!==s?s:i.defaultError}:"invalid_type"!==t.code?{message:i.defaultError}:{message:null!==(o=null!=a?a:n)&&void 0!==o?o:i.defaultError}},description:i}}class Gr{get description(){return this._def.description}_getType(e){return Ar(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ar(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Rr,ctx:{common:e.parent.common,data:e.data,parsedType:Ar(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(qr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ar(e)},i=this._parseSync({data:e,path:r.path,parent:r});return Kr(r,i)}"~validate"(e){var t,n;const r={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ar(e)};if(!this["~standard"].async)try{const t=this._parseSync({data:e,path:[],parent:r});return jr(t)?{value:t.value}:{issues:r.common.issues}}catch(e){(null===(n=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===n?void 0:n.includes("encountered"))&&(this["~standard"].async=!0),r.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:r}).then((e=>jr(e)?{value:e.value}:{issues:r.common.issues}))}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ar(e)},r=this._parse({data:e,path:n.path,parent:n}),i=await(qr(r)?r:Promise.resolve(r));return Kr(n,i)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const i=e(t),s=()=>r.addIssue({code:Sr.custom,...n(t)});return"undefined"!=typeof Promise&&i instanceof Promise?i.then((e=>!!e||(s(),!1))):!!i||(s(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new Gi({schema:this,typeName:as.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ji.create(this,this._def)}nullable(){return Yi.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Oi.create(this)}promise(){return Wi.create(this,this._def)}or(e){return Ri.create([this,e],this._def)}and(e){return Zi.create(this,e,this._def)}transform(e){return new Gi({...Wr(this._def),schema:this,typeName:as.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Xi({...Wr(this._def),innerType:this,defaultValue:t,typeName:as.ZodDefault})}brand(){return new ns({typeName:as.ZodBranded,type:this,...Wr(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new Qi({...Wr(this._def),innerType:this,catchValue:t,typeName:as.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return rs.create(this,e)}readonly(){return is.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Jr=/^c[^\s-]{8,}$/i,Yr=/^[0-9a-z]+$/,Xr=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Qr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ei=/^[a-z0-9_-]{21}$/i,ti=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ni=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,ri=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let ii;const si=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,oi=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ai=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ci=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ui=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,di=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,li="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",hi=new RegExp(`^${li}$`);function fi(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function pi(e){let t=`${li}T${fi(e)}`;const n=[];return n.push(e.local?"Z?":"Z"),e.offset&&n.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${n.join("|")})`,new RegExp(`^${t}$`)}function gi(e,t){if(!ti.test(e))return!1;try{const[n]=e.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),i=JSON.parse(atob(r));return"object"==typeof i&&null!==i&&(!(!i.typ||!i.alg)&&(!t||i.alg===t))}catch(e){return!1}}function yi(e,t){return!("v4"!==t&&t||!oi.test(e))||!("v6"!==t&&t||!ci.test(e))}class mi extends Gr{_parse(e){this._def.coerce&&(e.data=String(e.data));if(this._getType(e)!==kr.string){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.string,received:t.parsedType}),Lr}const t=new Rr;let n;for(const s of this._def.checks)if("min"===s.kind)e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("max"===s.kind)e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),t.dirty());else if("length"===s.kind){const r=e.data.length>s.value,i=e.data.length<s.value;(r||i)&&(n=this._getOrReturnCtx(e,n),r?Ur(n,{code:Sr.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&Ur(n,{code:Sr.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),t.dirty())}else if("email"===s.kind)ri.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"email",code:Sr.invalid_string,message:s.message}),t.dirty());else if("emoji"===s.kind)ii||(ii=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ii.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"emoji",code:Sr.invalid_string,message:s.message}),t.dirty());else if("uuid"===s.kind)Qr.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"uuid",code:Sr.invalid_string,message:s.message}),t.dirty());else if("nanoid"===s.kind)ei.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"nanoid",code:Sr.invalid_string,message:s.message}),t.dirty());else if("cuid"===s.kind)Jr.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"cuid",code:Sr.invalid_string,message:s.message}),t.dirty());else if("cuid2"===s.kind)Yr.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"cuid2",code:Sr.invalid_string,message:s.message}),t.dirty());else if("ulid"===s.kind)Xr.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"ulid",code:Sr.invalid_string,message:s.message}),t.dirty());else if("url"===s.kind)try{new URL(e.data)}catch(r){n=this._getOrReturnCtx(e,n),Ur(n,{validation:"url",code:Sr.invalid_string,message:s.message}),t.dirty()}else if("regex"===s.kind){s.regex.lastIndex=0;s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"regex",code:Sr.invalid_string,message:s.message}),t.dirty())}else if("trim"===s.kind)e.data=e.data.trim();else if("includes"===s.kind)e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),t.dirty());else if("toLowerCase"===s.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===s.kind)e.data=e.data.toUpperCase();else if("startsWith"===s.kind)e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.invalid_string,validation:{startsWith:s.value},message:s.message}),t.dirty());else if("endsWith"===s.kind)e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.invalid_string,validation:{endsWith:s.value},message:s.message}),t.dirty());else if("datetime"===s.kind){pi(s).test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.invalid_string,validation:"datetime",message:s.message}),t.dirty())}else if("date"===s.kind){hi.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.invalid_string,validation:"date",message:s.message}),t.dirty())}else if("time"===s.kind){new RegExp(`^${fi(s)}$`).test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.invalid_string,validation:"time",message:s.message}),t.dirty())}else"duration"===s.kind?ni.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"duration",code:Sr.invalid_string,message:s.message}),t.dirty()):"ip"===s.kind?(r=e.data,("v4"!==(i=s.version)&&i||!si.test(r))&&("v6"!==i&&i||!ai.test(r))&&(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"ip",code:Sr.invalid_string,message:s.message}),t.dirty())):"jwt"===s.kind?gi(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"jwt",code:Sr.invalid_string,message:s.message}),t.dirty()):"cidr"===s.kind?yi(e.data,s.version)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"cidr",code:Sr.invalid_string,message:s.message}),t.dirty()):"base64"===s.kind?ui.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"base64",code:Sr.invalid_string,message:s.message}),t.dirty()):"base64url"===s.kind?di.test(e.data)||(n=this._getOrReturnCtx(e,n),Ur(n,{validation:"base64url",code:Sr.invalid_string,message:s.message}),t.dirty()):Er.assertNever(s);var r,i;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:Sr.invalid_string,...Hr.errToObj(n)})}_addCheck(e){return new mi({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Hr.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Hr.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Hr.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Hr.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Hr.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Hr.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Hr.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Hr.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Hr.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Hr.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Hr.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Hr.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Hr.errToObj(e)})}datetime(e){var t,n;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(n=null==e?void 0:e.local)&&void 0!==n&&n,...Hr.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...Hr.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Hr.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Hr.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Hr.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Hr.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Hr.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Hr.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Hr.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Hr.errToObj(t)})}nonempty(e){return this.min(1,Hr.errToObj(e))}trim(){return new mi({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new mi({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new mi({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isDate(){return!!this._def.checks.find((e=>"date"===e.kind))}get isTime(){return!!this._def.checks.find((e=>"time"===e.kind))}get isDuration(){return!!this._def.checks.find((e=>"duration"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isNANOID(){return!!this._def.checks.find((e=>"nanoid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get isCIDR(){return!!this._def.checks.find((e=>"cidr"===e.kind))}get isBase64(){return!!this._def.checks.find((e=>"base64"===e.kind))}get isBase64url(){return!!this._def.checks.find((e=>"base64url"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function wi(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,i=n>r?n:r;return parseInt(e.toFixed(i).replace(".",""))%parseInt(t.toFixed(i).replace(".",""))/Math.pow(10,i)}mi.create=e=>{var t;return new mi({checks:[],typeName:as.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Wr(e)})};class bi extends Gr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){this._def.coerce&&(e.data=Number(e.data));if(this._getType(e)!==kr.number){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.number,received:t.parsedType}),Lr}let t;const n=new Rr;for(const r of this._def.checks)if("int"===r.kind)Er.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty());else if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty())}else"multipleOf"===r.kind?0!==wi(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.not_finite,message:r.message}),n.dirty()):Er.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Hr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Hr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Hr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Hr.toString(t))}setLimit(e,t,n,r){return new bi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Hr.toString(r)}]})}_addCheck(e){return new bi({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Hr.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Hr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Hr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Hr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Hr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Hr.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Hr.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Hr.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Hr.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&Er.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}bi.create=e=>new bi({checks:[],typeName:as.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...Wr(e)});class vi extends Gr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==kr.bigint)return this._getInvalidInput(e);let t;const n=new Rr;for(const r of this._def.checks)if("min"===r.kind){(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else if("max"===r.kind){(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Ur(t,{code:Sr.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):Er.assertNever(r);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.bigint,received:t.parsedType}),Lr}gte(e,t){return this.setLimit("min",e,!0,Hr.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Hr.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Hr.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Hr.toString(t))}setLimit(e,t,n,r){return new vi({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Hr.toString(r)}]})}_addCheck(e){return new vi({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Hr.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Hr.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Hr.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Hr.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Hr.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}vi.create=e=>{var t;return new vi({checks:[],typeName:as.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...Wr(e)})};class _i extends Gr{_parse(e){this._def.coerce&&(e.data=Boolean(e.data));if(this._getType(e)!==kr.boolean){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.boolean,received:t.parsedType}),Lr}return Pr(e.data)}}_i.create=e=>new _i({typeName:as.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...Wr(e)});class Ei extends Gr{_parse(e){this._def.coerce&&(e.data=new Date(e.data));if(this._getType(e)!==kr.date){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.date,received:t.parsedType}),Lr}if(isNaN(e.data.getTime())){return Ur(this._getOrReturnCtx(e),{code:Sr.invalid_date}),Lr}const t=new Rr;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),Ur(n,{code:Sr.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):Er.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ei({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Hr.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Hr.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}Ei.create=e=>new Ei({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:as.ZodDate,...Wr(e)});class xi extends Gr{_parse(e){if(this._getType(e)!==kr.symbol){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.symbol,received:t.parsedType}),Lr}return Pr(e.data)}}xi.create=e=>new xi({typeName:as.ZodSymbol,...Wr(e)});class ki extends Gr{_parse(e){if(this._getType(e)!==kr.undefined){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.undefined,received:t.parsedType}),Lr}return Pr(e.data)}}ki.create=e=>new ki({typeName:as.ZodUndefined,...Wr(e)});class Ai extends Gr{_parse(e){if(this._getType(e)!==kr.null){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.null,received:t.parsedType}),Lr}return Pr(e.data)}}Ai.create=e=>new Ai({typeName:as.ZodNull,...Wr(e)});class Si extends Gr{constructor(){super(...arguments),this._any=!0}_parse(e){return Pr(e.data)}}Si.create=e=>new Si({typeName:as.ZodAny,...Wr(e)});class Ii extends Gr{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Pr(e.data)}}Ii.create=e=>new Ii({typeName:as.ZodUnknown,...Wr(e)});class Bi extends Gr{_parse(e){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.never,received:t.parsedType}),Lr}}Bi.create=e=>new Bi({typeName:as.ZodNever,...Wr(e)});class Ti extends Gr{_parse(e){if(this._getType(e)!==kr.undefined){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.void,received:t.parsedType}),Lr}return Pr(e.data)}}Ti.create=e=>new Ti({typeName:as.ZodVoid,...Wr(e)});class Oi extends Gr{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==kr.array)return Ur(t,{code:Sr.invalid_type,expected:kr.array,received:t.parsedType}),Lr;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,i=t.data.length<r.exactLength.value;(e||i)&&(Ur(t,{code:e?Sr.too_big:Sr.too_small,minimum:i?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(Ur(t,{code:Sr.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(Ur(t,{code:Sr.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new Vr(t,e,t.path,n))))).then((e=>Rr.mergeArray(n,e)));const i=[...t.data].map(((e,n)=>r.type._parseSync(new Vr(t,e,t.path,n))));return Rr.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new Oi({...this._def,minLength:{value:e,message:Hr.toString(t)}})}max(e,t){return new Oi({...this._def,maxLength:{value:e,message:Hr.toString(t)}})}length(e,t){return new Oi({...this._def,exactLength:{value:e,message:Hr.toString(t)}})}nonempty(e){return this.min(1,e)}}function Ni(e){if(e instanceof Ui){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=Ji.create(Ni(r))}return new Ui({...e._def,shape:()=>t})}return e instanceof Oi?new Oi({...e._def,type:Ni(e.element)}):e instanceof Ji?Ji.create(Ni(e.unwrap())):e instanceof Yi?Yi.create(Ni(e.unwrap())):e instanceof $i?$i.create(e.items.map((e=>Ni(e)))):e}Oi.create=(e,t)=>new Oi({type:e,minLength:null,maxLength:null,exactLength:null,typeName:as.ZodArray,...Wr(t)});class Ui extends Gr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Er.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==kr.object){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.object,received:t.parsedType}),Lr}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof Bi&&"strip"===this._def.unknownKeys))for(const e in n.data)i.includes(e)||s.push(e);const o=[];for(const e of i){const t=r[e],i=n.data[e];o.push({key:{status:"valid",value:e},value:t._parse(new Vr(n,i,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof Bi){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of s)o.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)s.length>0&&(Ur(n,{code:Sr.unrecognized_keys,keys:s}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of s){const r=n.data[t];o.push({key:{status:"valid",value:t},value:e._parse(new Vr(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of o){const n=await t.key,r=await t.value;e.push({key:n,value:r,alwaysSet:t.alwaysSet})}return e})).then((e=>Rr.mergeObjectSync(t,e))):Rr.mergeObjectSync(t,o)}get shape(){return this._def.shape()}strict(e){return new Ui({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,i,s,o;const a=null!==(s=null===(i=(r=this._def).errorMap)||void 0===i?void 0:i.call(r,t,n).message)&&void 0!==s?s:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(o=Hr.errToObj(e).message)&&void 0!==o?o:a}:{message:a}}}:{}})}strip(){return new Ui({...this._def,unknownKeys:"strip"})}passthrough(){return new Ui({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ui({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ui({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:as.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Ui({...this._def,catchall:e})}pick(e){const t={};return Er.objectKeys(e).forEach((n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])})),new Ui({...this._def,shape:()=>t})}omit(e){const t={};return Er.objectKeys(this.shape).forEach((n=>{e[n]||(t[n]=this.shape[n])})),new Ui({...this._def,shape:()=>t})}deepPartial(){return Ni(this)}partial(e){const t={};return Er.objectKeys(this.shape).forEach((n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()})),new Ui({...this._def,shape:()=>t})}required(e){const t={};return Er.objectKeys(this.shape).forEach((n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof Ji;)e=e._def.innerType;t[n]=e}})),new Ui({...this._def,shape:()=>t})}keyof(){return Di(Er.objectKeys(this.shape))}}Ui.create=(e,t)=>new Ui({shape:()=>e,unknownKeys:"strip",catchall:Bi.create(),typeName:as.ZodObject,...Wr(t)}),Ui.strictCreate=(e,t)=>new Ui({shape:()=>e,unknownKeys:"strict",catchall:Bi.create(),typeName:as.ZodObject,...Wr(t)}),Ui.lazycreate=(e,t)=>new Ui({shape:e,unknownKeys:"strip",catchall:Bi.create(),typeName:as.ZodObject,...Wr(t)});class Ri extends Gr{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new Ir(e.ctx.common.issues)));return Ur(t,{code:Sr.invalid_union,unionErrors:n}),Lr}));{let e;const r=[];for(const i of n){const n={...t,common:{...t.common,issues:[]},parent:null},s=i._parseSync({data:t.data,path:t.path,parent:n});if("valid"===s.status)return s;"dirty"!==s.status||e||(e={result:s,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const i=r.map((e=>new Ir(e)));return Ur(t,{code:Sr.invalid_union,unionErrors:i}),Lr}}get options(){return this._def.options}}Ri.create=(e,t)=>new Ri({options:e,typeName:as.ZodUnion,...Wr(t)});const Li=e=>e instanceof Hi?Li(e.schema):e instanceof Gi?Li(e.innerType()):e instanceof Fi?[e.value]:e instanceof Vi?e.options:e instanceof Ki?Er.objectValues(e.enum):e instanceof Xi?Li(e._def.innerType):e instanceof ki?[void 0]:e instanceof Ai?[null]:e instanceof Ji?[void 0,...Li(e.unwrap())]:e instanceof Yi?[null,...Li(e.unwrap())]:e instanceof ns||e instanceof is?Li(e.unwrap()):e instanceof Qi?Li(e._def.innerType):[];class Ci extends Gr{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kr.object)return Ur(t,{code:Sr.invalid_type,expected:kr.object,received:t.parsedType}),Lr;const n=this.discriminator,r=t.data[n],i=this.optionsMap.get(r);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(Ur(t,{code:Sr.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Lr)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=Li(n.shape[e]);if(!t.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const i of t){if(r.has(i))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);r.set(i,n)}}return new Ci({typeName:as.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...Wr(n)})}}function Pi(e,t){const n=Ar(e),r=Ar(t);if(e===t)return{valid:!0,data:e};if(n===kr.object&&r===kr.object){const n=Er.objectKeys(t),r=Er.objectKeys(e).filter((e=>-1!==n.indexOf(e))),i={...e,...t};for(const n of r){const r=Pi(e[n],t[n]);if(!r.valid)return{valid:!1};i[n]=r.data}return{valid:!0,data:i}}if(n===kr.array&&r===kr.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const i=Pi(e[r],t[r]);if(!i.valid)return{valid:!1};n.push(i.data)}return{valid:!0,data:n}}return n===kr.date&&r===kr.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Zi extends Gr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Zr(e)||Zr(r))return Lr;const i=Pi(e.value,r.value);return i.valid?(($r(e)||$r(r))&&t.dirty(),{status:t.value,value:i.data}):(Ur(n,{code:Sr.invalid_intersection_types}),Lr)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Zi.create=(e,t,n)=>new Zi({left:e,right:t,typeName:as.ZodIntersection,...Wr(n)});class $i extends Gr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kr.array)return Ur(n,{code:Sr.invalid_type,expected:kr.array,received:n.parsedType}),Lr;if(n.data.length<this._def.items.length)return Ur(n,{code:Sr.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Lr;!this._def.rest&&n.data.length>this._def.items.length&&(Ur(n,{code:Sr.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Vr(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>Rr.mergeArray(t,e))):Rr.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new $i({...this._def,rest:e})}}$i.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new $i({items:e,typeName:as.ZodTuple,rest:null,...Wr(t)})};class ji extends Gr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kr.object)return Ur(n,{code:Sr.invalid_type,expected:kr.object,received:n.parsedType}),Lr;const r=[],i=this._def.keyType,s=this._def.valueType;for(const e in n.data)r.push({key:i._parse(new Vr(n,e,n.path,e)),value:s._parse(new Vr(n,n.data[e],n.path,e)),alwaysSet:e in n.data});return n.common.async?Rr.mergeObjectAsync(t,r):Rr.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new ji(t instanceof Gr?{keyType:e,valueType:t,typeName:as.ZodRecord,...Wr(n)}:{keyType:mi.create(),valueType:e,typeName:as.ZodRecord,...Wr(t)})}}class qi extends Gr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kr.map)return Ur(n,{code:Sr.invalid_type,expected:kr.map,received:n.parsedType}),Lr;const r=this._def.keyType,i=this._def.valueType,s=[...n.data.entries()].map((([e,t],s)=>({key:r._parse(new Vr(n,e,n.path,[s,"key"])),value:i._parse(new Vr(n,t,n.path,[s,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of s){const r=await n.key,i=await n.value;if("aborted"===r.status||"aborted"===i.status)return Lr;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of s){const r=n.key,i=n.value;if("aborted"===r.status||"aborted"===i.status)return Lr;"dirty"!==r.status&&"dirty"!==i.status||t.dirty(),e.set(r.value,i.value)}return{status:t.value,value:e}}}}qi.create=(e,t,n)=>new qi({valueType:t,keyType:e,typeName:as.ZodMap,...Wr(n)});class Mi extends Gr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==kr.set)return Ur(n,{code:Sr.invalid_type,expected:kr.set,received:n.parsedType}),Lr;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(Ur(n,{code:Sr.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(Ur(n,{code:Sr.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const i=this._def.valueType;function s(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Lr;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const o=[...n.data.values()].map(((e,t)=>i._parse(new Vr(n,e,n.path,t))));return n.common.async?Promise.all(o).then((e=>s(e))):s(o)}min(e,t){return new Mi({...this._def,minSize:{value:e,message:Hr.toString(t)}})}max(e,t){return new Mi({...this._def,maxSize:{value:e,message:Hr.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Mi.create=(e,t)=>new Mi({valueType:e,minSize:null,maxSize:null,typeName:as.ZodSet,...Wr(t)});class zi extends Gr{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kr.function)return Ur(t,{code:Sr.invalid_type,expected:kr.function,received:t.parsedType}),Lr;function n(e,n){return Nr({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Or(),Br].filter((e=>!!e)),issueData:{code:Sr.invalid_arguments,argumentsError:n}})}function r(e,n){return Nr({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Or(),Br].filter((e=>!!e)),issueData:{code:Sr.invalid_return_type,returnTypeError:n}})}const i={errorMap:t.common.contextualErrorMap},s=t.data;if(this._def.returns instanceof Wi){const e=this;return Pr((async function(...t){const o=new Ir([]),a=await e._def.args.parseAsync(t,i).catch((e=>{throw o.addIssue(n(t,e)),o})),c=await Reflect.apply(s,this,a);return await e._def.returns._def.type.parseAsync(c,i).catch((e=>{throw o.addIssue(r(c,e)),o}))}))}{const e=this;return Pr((function(...t){const o=e._def.args.safeParse(t,i);if(!o.success)throw new Ir([n(t,o.error)]);const a=Reflect.apply(s,this,o.data),c=e._def.returns.safeParse(a,i);if(!c.success)throw new Ir([r(a,c.error)]);return c.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new zi({...this._def,args:$i.create(e).rest(Ii.create())})}returns(e){return new zi({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new zi({args:e||$i.create([]).rest(Ii.create()),returns:t||Ii.create(),typeName:as.ZodFunction,...Wr(n)})}}class Hi extends Gr{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Hi.create=(e,t)=>new Hi({getter:e,typeName:as.ZodLazy,...Wr(t)});class Fi extends Gr{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Ur(t,{received:t.data,code:Sr.invalid_literal,expected:this._def.value}),Lr}return{status:"valid",value:e.data}}get value(){return this._def.value}}function Di(e,t){return new Vi({values:e,typeName:as.ZodEnum,...Wr(t)})}Fi.create=(e,t)=>new Fi({value:e,typeName:as.ZodLiteral,...Wr(t)});class Vi extends Gr{constructor(){super(...arguments),Fr.set(this,void 0)}_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return Ur(t,{expected:Er.joinValues(n),received:t.parsedType,code:Sr.invalid_type}),Lr}if(Mr(this,Fr)||zr(this,Fr,new Set(this._def.values)),!Mr(this,Fr).has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Ur(t,{received:t.data,code:Sr.invalid_enum_value,options:n}),Lr}return Pr(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Vi.create(e,{...this._def,...t})}exclude(e,t=this._def){return Vi.create(this.options.filter((t=>!e.includes(t))),{...this._def,...t})}}Fr=new WeakMap,Vi.create=Di;class Ki extends Gr{constructor(){super(...arguments),Dr.set(this,void 0)}_parse(e){const t=Er.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==kr.string&&n.parsedType!==kr.number){const e=Er.objectValues(t);return Ur(n,{expected:Er.joinValues(e),received:n.parsedType,code:Sr.invalid_type}),Lr}if(Mr(this,Dr)||zr(this,Dr,new Set(Er.getValidEnumValues(this._def.values))),!Mr(this,Dr).has(e.data)){const e=Er.objectValues(t);return Ur(n,{received:n.data,code:Sr.invalid_enum_value,options:e}),Lr}return Pr(e.data)}get enum(){return this._def.values}}Dr=new WeakMap,Ki.create=(e,t)=>new Ki({values:e,typeName:as.ZodNativeEnum,...Wr(t)});class Wi extends Gr{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==kr.promise&&!1===t.common.async)return Ur(t,{code:Sr.invalid_type,expected:kr.promise,received:t.parsedType}),Lr;const n=t.parsedType===kr.promise?t.data:Promise.resolve(t.data);return Pr(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Wi.create=(e,t)=>new Wi({type:e,typeName:as.ZodPromise,...Wr(t)});class Gi extends Gr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===as.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,i={addIssue:e=>{Ur(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),"preprocess"===r.type){const e=r.transform(n.data,i);if(n.common.async)return Promise.resolve(e).then((async e=>{if("aborted"===t.value)return Lr;const r=await this._def.schema._parseAsync({data:e,path:n.path,parent:n});return"aborted"===r.status?Lr:"dirty"===r.status||"dirty"===t.value?Cr(r.value):r}));{if("aborted"===t.value)return Lr;const r=this._def.schema._parseSync({data:e,path:n.path,parent:n});return"aborted"===r.status?Lr:"dirty"===r.status||"dirty"===t.value?Cr(r.value):r}}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,i);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Lr:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Lr:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!jr(e))return e;const s=r.transform(e.value,i);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:s}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>jr(e)?Promise.resolve(r.transform(e.value,i)).then((e=>({status:t.value,value:e}))):e))}Er.assertNever(r)}}Gi.create=(e,t,n)=>new Gi({schema:e,typeName:as.ZodEffects,effect:t,...Wr(n)}),Gi.createWithPreprocess=(e,t,n)=>new Gi({schema:t,effect:{type:"preprocess",transform:e},typeName:as.ZodEffects,...Wr(n)});class Ji extends Gr{_parse(e){return this._getType(e)===kr.undefined?Pr(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ji.create=(e,t)=>new Ji({innerType:e,typeName:as.ZodOptional,...Wr(t)});class Yi extends Gr{_parse(e){return this._getType(e)===kr.null?Pr(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Yi.create=(e,t)=>new Yi({innerType:e,typeName:as.ZodNullable,...Wr(t)});class Xi extends Gr{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===kr.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Xi.create=(e,t)=>new Xi({innerType:e,typeName:as.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...Wr(t)});class Qi extends Gr{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return qr(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Ir(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new Ir(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}Qi.create=(e,t)=>new Qi({innerType:e,typeName:as.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...Wr(t)});class es extends Gr{_parse(e){if(this._getType(e)!==kr.nan){const t=this._getOrReturnCtx(e);return Ur(t,{code:Sr.invalid_type,expected:kr.nan,received:t.parsedType}),Lr}return{status:"valid",value:e.data}}}es.create=e=>new es({typeName:as.ZodNaN,...Wr(e)});const ts=Symbol("zod_brand");class ns extends Gr{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class rs extends Gr{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async){return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Lr:"dirty"===e.status?(t.dirty(),Cr(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})()}{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Lr:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new rs({in:e,out:t,typeName:as.ZodPipeline})}}class is extends Gr{_parse(e){const t=this._def.innerType._parse(e),n=e=>(jr(e)&&(e.value=Object.freeze(e.value)),e);return qr(t)?t.then((e=>n(e))):n(t)}unwrap(){return this._def.innerType}}function ss(e,t={},n){return e?Si.create().superRefine(((r,i)=>{var s,o;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,a=null===(o=null!==(s=e.fatal)&&void 0!==s?s:n)||void 0===o||o,c="string"==typeof e?{message:e}:e;i.addIssue({code:"custom",...c,fatal:a})}})):Si.create()}is.create=(e,t)=>new is({innerType:e,typeName:as.ZodReadonly,...Wr(t)});const os={object:Ui.lazycreate};var as;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(as||(as={}));const cs=mi.create,us=bi.create,ds=es.create,ls=vi.create,hs=_i.create,fs=Ei.create,ps=xi.create,gs=ki.create,ys=Ai.create,ms=Si.create,ws=Ii.create,bs=Bi.create,vs=Ti.create,_s=Oi.create,Es=Ui.create,xs=Ui.strictCreate,ks=Ri.create,As=Ci.create,Ss=Zi.create,Is=$i.create,Bs=ji.create,Ts=qi.create,Os=Mi.create,Ns=zi.create,Us=Hi.create,Rs=Fi.create,Ls=Vi.create,Cs=Ki.create,Ps=Wi.create,Zs=Gi.create,$s=Ji.create,js=Yi.create,qs=Gi.createWithPreprocess,Ms=rs.create,zs={string:e=>mi.create({...e,coerce:!0}),number:e=>bi.create({...e,coerce:!0}),boolean:e=>_i.create({...e,coerce:!0}),bigint:e=>vi.create({...e,coerce:!0}),date:e=>Ei.create({...e,coerce:!0})},Hs=Lr;var Fs=Object.freeze({__proto__:null,defaultErrorMap:Br,setErrorMap:function(e){Tr=e},getErrorMap:Or,makeIssue:Nr,EMPTY_PATH:[],addIssueToContext:Ur,ParseStatus:Rr,INVALID:Lr,DIRTY:Cr,OK:Pr,isAborted:Zr,isDirty:$r,isValid:jr,isAsync:qr,get util(){return Er},get objectUtil(){return xr},ZodParsedType:kr,getParsedType:Ar,ZodType:Gr,datetimeRegex:pi,ZodString:mi,ZodNumber:bi,ZodBigInt:vi,ZodBoolean:_i,ZodDate:Ei,ZodSymbol:xi,ZodUndefined:ki,ZodNull:Ai,ZodAny:Si,ZodUnknown:Ii,ZodNever:Bi,ZodVoid:Ti,ZodArray:Oi,ZodObject:Ui,ZodUnion:Ri,ZodDiscriminatedUnion:Ci,ZodIntersection:Zi,ZodTuple:$i,ZodRecord:ji,ZodMap:qi,ZodSet:Mi,ZodFunction:zi,ZodLazy:Hi,ZodLiteral:Fi,ZodEnum:Vi,ZodNativeEnum:Ki,ZodPromise:Wi,ZodEffects:Gi,ZodTransformer:Gi,ZodOptional:Ji,ZodNullable:Yi,ZodDefault:Xi,ZodCatch:Qi,ZodNaN:es,BRAND:ts,ZodBranded:ns,ZodPipeline:rs,ZodReadonly:is,custom:ss,Schema:Gr,ZodSchema:Gr,late:os,get ZodFirstPartyTypeKind(){return as},coerce:zs,any:ms,array:_s,bigint:ls,boolean:hs,date:fs,discriminatedUnion:As,effect:Zs,enum:Ls,function:Ns,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>ss((t=>t instanceof e),t),intersection:Ss,lazy:Us,literal:Rs,map:Ts,nan:ds,nativeEnum:Cs,never:bs,null:ys,nullable:js,number:us,object:Es,oboolean:()=>hs().optional(),onumber:()=>us().optional(),optional:$s,ostring:()=>cs().optional(),pipeline:Ms,preprocess:qs,promise:Ps,record:Bs,set:Os,strictObject:xs,string:cs,symbol:ps,transformer:Zs,tuple:Is,undefined:gs,union:ks,unknown:ws,void:vs,NEVER:Hs,ZodIssueCode:Sr,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Ir});Fs.bigint(),Fs.boolean(),Fs.date();const Ds=Fs.number();Fs.number().max(Number.MAX_SAFE_INTEGER);const Vs=Fs.string(),Ks=Fs.number().min(5e8).max(Number.MAX_SAFE_INTEGER),Ws=Fs.string().url();Fs.any();const Gs=Fs.string().regex(/^[0-9a-fA-F]*$/).refine((e=>e.length%2==0));Fs.union([Fs.string(),Fs.number(),Fs.boolean(),Fs.null()]);const Js=Gs.refine((e=>32===e.length));Gs.refine((e=>40===e.length));const Ys=Gs.refine((e=>64===e.length)),Xs=Gs.refine((e=>128===e.length));Gs.refine((e=>66===e.length)),Fs.string().regex(/^[1-9A-HJ-NP-Za-km-z]+$/),Fs.string().regex(/^[a-zA-Z0-9+/]+={0,2}$/),Fs.string().regex(/^[a-zA-Z0-9\-_]+={0,2}$/),Fs.string().regex(/^[a-z]+1[023456789acdefghjklmnpqrstuvwxyz]+$/);var Qs={hex32:Ys,hex16:Js,hex64:Xs,num:Ds,str:Vs,stamp:Ks,url:Ws};const eo=Qs.str.array();var to={signed:Fs.object({content:Qs.str,created_at:Qs.stamp,kind:Qs.num,pubkey:Qs.hex32,tags:eo.array()}).extend({id:Qs.hex32}).extend({sig:Qs.hex64})};const no=Qs.hex16,ro=Qs.str,io=Qs.str.min(3).max(256);var so={base:Qs,event:to,msg:{envelope:Fs.tuple([io,no,ro])}};const oo=()=>Math.floor(Date.now()/1e3);function ao(e){return e instanceof Error?e.message:"string"==typeof e?e:String(e)}function co(e,t,n,r){const i=e.created_at??oo(),s=yr(r),o=wr(mr(r,n),t),a={...e,pubkey:s,content:o,created_at:i};return a.tags.push(["p",n]),function(e,t){const n=_r(t),r=function(e,t){const n=Pn.sign(t,e);return new _e(n).hex}(e,n);return{...t,id:n,sig:r}}(r,a)}function uo(e){const{id:t,sig:n,...r}=e,i=so.event.signed.safeParse(e),s=_r(r);return i.success?t!==s?"event id mismatch":(o=t,a=e.pubkey,c=n,Pn.verify(c,o,a)?null:"invalid event signature"):"event failed schema validation";var o,a,c}function lo(e){const t=e.id??vr();return{...e,id:t}}const ho=BigInt(0),fo=BigInt(1);BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f");const po=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),go=vn.CURVE,yo=Zt(po,32,!0),mo=vn.ProjectivePoint,wo="FROST-secp256k1-SHA256-v1";var bo={_N:po,POINT:mo};const{POINT:vo,_N:_o}=bo;function Eo(e){return Ot(e,_o)}function xo(e){return(new TextEncoder).encode(e)}function ko(e){let t=_e.bytes(e);if(t.length<32||t.length>33)throw new Error("invalid pubkeky: "+t.hex+" "+t.length);return 32===t.length&&(t=t.prepend(2)),vo.fromHex(t.hex)}const Ao={m:1,p:po,k:128,expand:"xmd",hash:m};function So(e){return{...Ao,DST:e}}function Io(e){const t=hn(e,1,So(wo+"rho"));return _e.big(t[0][0],32)}function Bo(e){if(void 0===e)throw new TypeError("Input is undefined!");if(null===e)throw new TypeError("Input is null!")}function To(e,t){const n=_e.bytes(e);if(n.length!==t)throw new Error(`Invalid byte size: ${n.hex} !== ${t}`);return!0}function Oo(e){for(const t of e){if(1!==e.filter((e=>e===t)).length)throw new Error("item in set is not unique: "+String(t))}}function No(e,...t){const n=function(e){const t=_e.str(e).digest;return _e.join([t,t])}(e),r=t.map((e=>_e.bytes(e)));return _e.join([n,...r]).digest}const{POINT:Uo}=bo;function Ro(e,t){if(null===e&&null===t)throw new Error("both points are null!");if(null===e)return Bo(t),t;if(null===t)return e;{const n=e.add(t);return n.assertValidity(),n}}function Lo(e,t){const n=e.multiply(t);return n.assertValidity(),n}function Co(e){const t=vn.ProjectivePoint.BASE.multiply(e);return t.assertValidity(),t}function Po(e){return _e.bytes(e.toRawBytes(!0))}function Zo(e){const t=_e.bytes(e).hex;return Uo.fromHex(t)}function $o(e){return new _e(e,32)}function jo(e,t){const n=void 0!==t?_e.bytes(t,32):_e.random(32);return function(e){const t=hn(e,1,So(wo+"nonce"));return _e.big(t[0][0],32)}(_e.join([n,e]))}function qo(e,t){const n=_e.bytes(e);return 33===n.length?n.slice(1).hex:n.hex}function Mo(e){let t=[];const n=e.sort(((e,t)=>e.idx-t.idx));for(const{idx:e,hidden_pn:r,binder_pn:i}of n){const n=[$o(e),r,i];t=[...t,...n]}return _e.join(t)}function zo(e,t,n){const r=function(e){const t=xo(wo+"msg"),n=m(new Uint8Array([...t,...e]));return new _e(n)}(_e.hex(n)),i=function(e){const t=xo(wo+"com"),n=m(new Uint8Array([...t,...e]));return new _e(n)}(Mo(e));return _e.join([t,r,i])}function Ho(e,t){for(const n of e)if(t===n.idx)return _e.bytes(n.factor).big;throw new Error("invalid participant")}function Fo(e,t){return e.map((({idx:e})=>{const n=$o(e);return{idx:e,factor:Io(_e.join([t,n])).hex}}))}function Do(e,t){let n=null;for(const{idx:r,binder_pn:i,hidden_pn:s}of e){const e=Zo(s),o=Lo(Zo(i),Ho(t,r));n=Ro(n,e),n=Ro(n,o)}return Bo(n),Po(n).hex}function Vo(e,t){const n=_e.bytes(e).hex,r=ko(n),i=function(e,t=[]){const n=t.map((e=>_e.bytes(e).big)),r=fo,i=po-r;let s=e,o=r,a=r,c=ho;for(const e of n){const t=Co(e);o=s.hasEvenY()?r:i,s=o===i?s.negate():s,s=Ro(s,t),s.assertValidity(),a=Eo(o*a),c=Eo(e+o*c)}return o=s.hasEvenY()?r:i,{parity:o,point:s,state:a,tweak:c}}(r,t);return{int_pk:n,int_pt:r,group_pk:i.point.toHex(!0),group_pt:i}}function Ko(e,t,n){const r=e.group_pk,i=zo(t,r,n).hex,s=Fo(t,i),o=Do(t,s),a=function(e){return e.map((e=>BigInt(e.idx)))}(t),c=function(e,t,n){const r=qo(t),i=qo(e);return To(r,32),To(i,32),No("BIP0340/challenge",i,r,n).big}(o,r,n);return{bind_prefix:i,bind_factors:s,challenge:c,pnonces:t,group_pn:o,indexes:a,message:n=_e.bytes(n).hex}}function Wo(e,t,n,r){const i=Vo(e,r),s=Ko(i,t,n);return{...i,...s}}function Go(e,t){if(t===ho)throw new Error("x is zero");let n=ho;for(const r of[...e].reverse())n*=t,n+=r,n=Eo(n);return n}function Jo(e,t){!function(e,t){if(!e.includes(t))throw new Error("item is not included in array")}(e,t),Oo(e);let n=fo,r=fo;for(const i of e)i!==t&&(n=Eo(yo.mul(n,i)),r=Eo(yo.mul(r,i-t)));return Eo(yo.div(n,r))}function Yo(e,t,n){const r=e.filter((e=>e!==t.idx)).map((e=>BigInt(e))),i=BigInt(t.idx),s=_e.hex(t.seckey).big,o=ko(n),a=function(e,t,n){Oo(e);let r=fo,i=fo;for(const s of e)s!==t&&(r=Eo(yo.mul(r,n-s)),i=Eo(yo.mul(i,t-s)));return Eo(yo.div(r,i))}(r,i,ho),c=Eo(a*s),u=Po(o.multiply(c)).hex;return{idx:t.idx,pubkey:u}}function Xo(e){const t=e.map((e=>[BigInt(e.idx),_e.bytes(e.seckey).big])),n=function(e){const t=e.map((e=>e[0]));let n=ho;for(const[r,i]of e)n+=Jo(t,r)*i,n=Eo(n);return n}(t);return _e.big(n).hex}function Qo(e,t,n=[]){const r=function(e,t){const n=[];for(let r=0;r<t;r++){const t=e.at(r),i=void 0!==t?_e.bytes(t).big:_e.random(32).big;n.push(Eo(i))}return n}(n,e),i=function(e,t){const n=[];for(let r=1;r<t+1;r++){const t=Go(e,BigInt(r)),i=_e.big(t,32).hex;n.push({idx:r,seckey:i})}return n}(r,t);return{shares:i,vss_commits:r.map((e=>Co(_e.bytes(e).big).toHex(!0)))}}function ea(e,t){const{challenge:n,pnonces:r,group_pt:i,group_pk:s,message:o}=e,a=Do(r,Fo(r,zo(r,s,o))),c=t.map((e=>_e.hex(e.psig).big)).reduce(((e,t)=>Eo(e+t)),ho),u=Eo(n*i.parity*i.tweak),d=Eo(c+u);return _e.join([a.slice(2),_e.big(d,32)]).hex}function ta(e,t,n,r){const{bind_factors:i,challenge:s,indexes:o,group_pn:a,group_pt:c}=e,u=Ho(i,t.idx);let d=ko(t.hidden_pn),l=ko(t.binder_pn),h=ko(n);ko(a).hasEvenY()||(d=Lo(d,go.n-fo),l=Lo(l,go.n-fo));const f=Ro(d,Lo(l,u)),p=Jo(o,BigInt(t.idx)),g=Eo(c.parity*c.state),y=Eo(s*p*g),m=Co(_e.hex(r).big),w=Ro(f,Lo(h,y));return m.x===w.x}function na(e,t,n){const r=Yo(e,n,t);return{idx:r.idx,keyshare:r.pubkey,members:e,ecdh_pk:t}}function ra(e){return function(e){let t=null;for(const n of e)if(null===t)t=ko(n.pubkey);else{const e=ko(n.pubkey);t=t.add(e)}return Bo(t),Po(t).hex}(e.map((e=>({idx:e.idx,pubkey:e.keyshare}))))}const ia=Fs.bigint(),sa=Fs.boolean(),oa=Fs.date(),aa=Fs.number(),ca=Fs.number().max(Number.MAX_SAFE_INTEGER),ua=Fs.string(),da=Fs.number().min(5e8).max(Number.MAX_SAFE_INTEGER),la=Fs.any(),ha=Fs.bigint().max(2100000000000000n),fa=Fs.union([Fs.string(),Fs.number(),Fs.boolean(),Fs.null()]),pa=Fs.lazy((()=>Fs.union([fa,Fs.array(pa),Fs.record(pa)]))),ga=Fs.string().regex(/^[0-9a-fA-F]*$/).refine((e=>e.length%2==0)),ya=ga.refine((e=>40===e.length)),ma=ga.refine((e=>64===e.length)),wa=ga.refine((e=>66===e.length)),ba=ga.refine((e=>128===e.length));var va={any:la,base58:Fs.string().regex(/^[1-9A-HJ-NP-Za-km-z]+$/),base64:Fs.string().regex(/^[a-zA-Z0-9+/]+={0,2}$/),base64url:Fs.string().regex(/^[a-zA-Z0-9\-_]+={0,2}$/),bech32:Fs.string().regex(/^[a-z]+1[023456789acdefghjklmnpqrstuvwxyz]+$/),big:ia,bool:sa,date:oa,hex20:ya,hex32:ma,hex33:wa,hex64:ba,hex:ga,json:pa,literal:fa,num:aa,sats:ha,str:ua,stamp:da,uint:ca};const _a=Fs.object({send:Fs.boolean(),recv:Fs.boolean()}),Ea=Fs.object({pubkey:va.hex32,policy:_a}),xa=Ea.extend({status:Fs.enum(["online","offline"]),updated:va.stamp});var ka={config:Ea,data:xa,policy:_a};const Aa=Fs.object({ecdh:Fs.map(va.hex33,va.hex33).optional()}),Sa=Fs.object({ecdh:Fs.function().optional(),sign:Fs.function().optional()});var Ia={cache:Aa,config:Fs.object({debug:Fs.boolean(),middleware:Sa,policies:ka.config.array(),sign_ival:va.num}),middleware:Sa};const Ba=Fs.object({idx:va.num,pubkey:va.hex33,hidden_pn:va.hex33,binder_pn:va.hex33}),Ta=Fs.object({commits:Fs.array(Ba),group_pk:va.hex33,threshold:va.num}),Oa=Fs.object({idx:va.num,binder_sn:va.hex32,hidden_sn:va.hex32,seckey:va.hex32});var Na={commit:Ba,ecdh:Fs.object({idx:va.num,keyshare:va.hex,members:va.num.array(),ecdh_pk:va.hex}),group:Ta,share:Oa};const Ua=Na.commit.extend({bind_hash:va.hex32,sid:va.hex32,sighash:va.hex32}),Ra=Na.share.extend({bind_hash:va.hex32,sid:va.hex32,sighash:va.hex32}),La=Fs.tuple([va.hex32,va.hex32]),Ca=Fs.tuple([va.hex32]).rest(va.hex32),Pa=Fs.object({content:va.str.nullable(),hashes:Ca.array(),members:va.num.array(),stamp:va.num,type:va.str}),Za=Pa.extend({gid:va.hex32,sid:va.hex32}),$a=Fs.object({idx:va.num,psigs:La.array(),pubkey:va.hex33,sid:va.hex32});var ja={base:va,node:Ia,peer:ka,pkg:Na,sign:{commit:Ua,member:Ra,psig_entry:La,psig_pkg:$a,session:Za,sighash_vec:Ca,template:Pa}};function qa(e){try{const t=ja.pkg.ecdh,n=JSON.parse(e.data),r=t.parse(n);return{...e,data:r}}catch{throw new Error("ecdh message failed validation")}}const Ma=()=>Math.floor(Date.now()/1e3);function za(e){return JSON.parse(JSON.stringify(e))}function Ha(e){return e instanceof Map||Array.isArray(e)||"object"!=typeof e?e:Object.keys(e).sort().filter((([e,t])=>void 0!==t)).reduce(((t,n)=>(t[n]=e[n],t)),{})}function Fa(e){return e instanceof Error?e.message:"string"==typeof e?e:String(e)}var Da;!function(e){function t(e,t){if(void 0===e)throw new TypeError(t??"Input is undefined!");if(null===e)throw new TypeError(t??"Input is null!")}e.ok=function(e,t){if(!1===e)throw new Error(t??"Assertion failed!")},e.equal=function(e,t,n){if(e!==t)throw new Error(n??`${e} !== ${t}`)},e.exists=t,e.size=function(e,t,n){const r=_e.bytes(e);if(r.length!==t)throw new Error(n??`Invalid byte size: ${r.hex} !== ${t}`);return!0},e.schema=function(e,n,r){t(n),function(e,t,n){if(t.safeParse(e).success)return!0;if(void 0===n)return!1;throw new Error(n??"object failed schema validation")}(n,e,r??null)},e.is_hex=function(e){if("string"!=typeof e||null!==e.match(/[^a-fA-F0-9]/)||e.length%2!=0)throw new Error("invalid hex:"+e)}}(Da||(Da={}));const Va=vn.CURVE.n,Ka=Zt(Va,32,!0),Wa=vn.ProjectivePoint.BASE;function Ga(e,t){const n=Qa(e).big;return Xa(Wa.multiply(n).toHex(!0),t)}function Ja(e,t,n=!1){const r=Qa(e).big,i=Qa(t).big,s=Ka.add(r,i);return function(e,t=!1){let n=Qa(e).big%Va;if(t)return Wa.multiply(n).hasEvenY()?_e.big(n).hex:_e.big(Va-n).hex;return _e.big(n).hex}(_e.big(s),n)}function Ya(e,t,n=!1){const r=function(e){const t=Qa(e);if(33===t.length)return"ecdsa";if(32===t.length)return"bip340";throw new Error("invalid pubkey: "+String(e))}(e),i=Qa(t).big,s=function(e){try{const t=Xa(e,"ecdsa");return vn.ProjectivePoint.fromHex(t)}catch(t){throw new Error("invalid pubkey: "+e)}}(e),o=Wa.multiply(i);let a=s.add(o);n&&!a.hasEvenY()&&(a=a.negate());return Xa(a.toHex(!0),r)}function Xa(e,t){const n=function(e,t){try{const n=Qa(e);return 33===n.length&&"bip340"===t?n.slice(1):32===n.length&&"ecdsa"===t?n.prepend(2):n}catch(t){throw new Error("invalid pubkey: "+String(e))}}(e,t);return n.hex}function Qa(e){try{return _e.bytes(e)}catch(t){throw new Error("invalid bytes: "+String(e))}}function ec(e,t){const n=Math.min(e.length,t-1);return e.sort((()=>Math.random()>.5?1:-1)).slice(0,n)}function tc(e,t){const n=e.commits.filter((e=>t.includes(Xa(e.pubkey,"bip340")))).map((e=>e.idx));return Da.ok(n.length===t.length,"index count does not match pubkey count"),n}const nc=33,rc=103;var ic=Object.freeze({__proto__:null,COMMIT_DATA_SIZE:rc,COMMIT_INDEX_SIZE:4,COMMIT_PNONCE_SIZE:33,COMMIT_PUBKEY_SIZE:33,GROUP_DATA_SIZE:37,GROUP_PUBKEY_SIZE:33,GROUP_THOLD_SIZE:4,KIND_MAP:{MSG_EVENT:20004},PEER_STATE_EXPIRY:30,SHARE_DATA_SIZE:100,SHARE_INDEX_SIZE:4,SHARE_SECKEY_SIZE:32,SHARE_SNONCE_SIZE:32});function sc(e){return e.filter((e=>e.policy.send)).map((e=>e.pubkey))}async function oc(e,t){const n=e.config.middleware.ecdh;try{e.emit("/ecdh/handler/req",za(t)),"function"==typeof n&&(t=n(e,t));const{members:r,ecdh_pk:i}=t.data,s=e.signer.gen_ecdh_share(r,i),o=lo({data:JSON.stringify(s),id:t.id,tag:"/ecdh/res"}),a=await e.client.publish(o,t.env.pubkey);if(!a.ok)throw new Error("failed to publish response");e.emit("/ecdh/handler/res",za(a.data))}catch(n){e.debug&&console.log(n),e.emit("/ecdh/handler/rej",[Fa(n),za(t)])}}function ac(e){return async(t,n)=>{const r=e.group.threshold,i=sc(e.peers),s=ec(n??=i,r),o=e.cache.ecdh.get(t);if(void 0!==o)return{ok:!0,data:e.signer.unwrap(o,t)};const a=tc(e.group,[e.pubkey,...s]),c=e.signer.gen_ecdh_share(a,t);let u=null;try{u=await async function(e,t,n){const r={data:JSON.stringify(n),tag:"/ecdh/req"},i=await e.client.multicast(r,t);if(!i.sub.ok)throw new Error(i.sub.reason);return i.sub.inbox.map((e=>{const t=qa(e);return Da.ok(null!==t,"invalid ecdh response from pubkey: "+e.env.pubkey),t}))}(e,s,c),e.emit("/ecdh/sender/res",za(u))}catch(t){e.debug&&console.log(t);const n=Fa(t);return e.emit("/ecdh/sender/rej",[n,za(c)]),{ok:!1,err:n}}try{Da.ok(null!==u,"no responses from peers");const n=function(e){return ra(e)}([c,...u.map((e=>e.data))]),r=e.signer.wrap(n,t);return e.cache.ecdh.set(t,r),e.emit("/ecdh/sender/ret",[t,n]),{ok:!0,data:n}}catch(t){e.debug&&console.log(t);const n=Fa(t);return e.emit("/ecdh/sender/err",[n,za(u??[])]),{ok:!1,err:n}}}}function cc(e){return async t=>{let n=null;try{n=await async function(e,t){const n=await e.client.request({data:t,tag:"/echo/req"},e.pubkey,{});if(!n.ok)throw new Error(n.reason);return n.inbox[0]}(e,t),e.emit("/echo/sender/res",n)}catch(t){e.debug&&console.log(t);const r=Fa(t);return e.emit("/echo/sender/rej",[r,n]),{ok:!1,err:r}}try{return Da.ok(null!==n,"no response from self"),e.emit("/echo/sender/ret",[n.data]),{ok:!0,data:n.data}}catch(t){e.debug&&console.log(t);const r=Fa(t);return e.emit("/echo/sender/err",[r,n]),{ok:!1,err:r}}}}async function uc(e,t){try{e.emit("/ping/handler/req",t);const n=e.peers.find((e=>e.pubkey===t.env.pubkey));if(void 0===n)throw new Error("peer data not found");const r=lo({data:JSON.stringify(n.policy),id:t.id,tag:"/ping/res"}),i=await e.client.publish(r,t.env.pubkey);if(!i.ok)throw new Error("failed to publish response");e.update_peer({...n,status:"online",updated:Ma()}),e.emit("/ping/handler/res",i.data)}catch(n){e.debug&&console.log(n),e.emit("/ping/handler/rej",[Fa(n),t])}}function dc(e){return async t=>{const n=e.peers.find((e=>e.pubkey===t));Da.exists(n,"peer data not found");let r=null;try{r=await async function(e,t){const n=await e.client.request({data:"ping",tag:"/ping/req"},t,{});if(!n.ok)throw new Error(n.reason);return n.inbox[0]}(e,t),e.emit("/ping/sender/res",r)}catch(t){e.debug&&console.log(t);const n=Fa(t);return e.emit("/ping/sender/rej",[n,r]),{ok:!1,err:n}}try{Da.ok(null!==r,"no response from peer");const t=function(e){try{const t=JSON.parse(e.data),n=ja.peer.policy.safeParse(t);return n.success?n.data:null}catch{return null}}(r);if(null===t)throw new Error("invalid ping response");const i={...n,status:"online",updated:Ma()};return e.update_peer(i),e.emit("/ping/sender/ret",i),{ok:!0,data:t}}catch(t){e.debug&&console.log(t);const i=Fa(t);return e.emit("/ping/sender/err",[i,r]),e.update_peer({...n,status:"offline",updated:Ma()}),{ok:!1,err:i}}}}function lc(e,t,n){const r=_e.bytes(e),i=_e.num(t,4),s=_e.join(n);return _e.join([r,i,s]).digest.hex}function hc(e){const t=Mo(e.commits);return _e.join([t,e.group_pk]).digest.hex}function fc(e,t){const n=e.find((e=>e.idx===t));return Da.exists(n,"commit package not found for idx: "+t),n}const pc=()=>({content:null,stamp:Ma(),type:"message"});function gc(e,t,n={}){const r="string"==typeof t?[[t]]:t,i=ja.sign.template.safeParse({...pc(),...n,hashes:r,members:e.sort()});return i.success?i.data:null}function yc(e,t){const n=hc(e),r=mc(n,t);return{...t,gid:n,sid:r}}function mc(e,t){const n=t.members.map((e=>_e.bytes(e))),r=t.hashes.map((e=>_e.join(e))),i=_e.bytes(t.content??"00"),s=_e.str(t.type),o=_e.num(t.stamp,4);return _e.join([e,...n,...r,i,s,o]).digest.hex}function wc(e,t,n){const r=fc(e.commits,n);return t.hashes.map((e=>function(e,t,n){const r=lc(e,t.idx,n),i=Ya(t.hidden_pn,r),s=Ya(t.binder_pn,r),[o]=n;return{...t,binder_pn:s,hidden_pn:i,bind_hash:r,sighash:o,sid:e}}(t.sid,r,e)))}function bc(e,t){return e.hashes.map((n=>function(e,t,n){const r=lc(e,t.idx,n),i=Ja(t.hidden_sn,r),s=Ja(t.binder_sn,r),[o]=n;return{...t,binder_sn:s,hidden_sn:i,bind_hash:r,sighash:o,sid:e}}(e.sid,t,n)))}function vc(e,t){return t.members.map((n=>wc(e,t,n))).flat()}function _c(e,t){const n=e.commits.map((e=>e.pubkey)),r=vc(e,t),i=new Map;for(const n of t.hashes){const[t,...s]=n,o=r.filter((e=>e.sighash===t)),a=Wo(e.group_pk,o,t,s);i.set(t,a)}return{pubkeys:n,session:t,sigmap:i}}function Ec(e,t){const n=e.session.sid,r=Ga(t.seckey,"ecdsa"),i=e.session.hashes.map((e=>e[0])),s=bc(e.session,t),o=i.map((t=>{const n=s.find((e=>e.sighash===t)),r=e.sigmap.get(t);Da.exists(n,"share not found for sighash: "+t),Da.exists(r,"context not found for sighash: "+t);const i=Sc(r,n);return[t,i]}));return{idx:t.idx,psigs:o,pubkey:r,sid:n}}function xc(e,t){const{idx:n,psigs:r,pubkey:i,sid:s}=t;if(s!==e.session.sid)return"session id mismatch";if(!e.pubkeys.includes(i))return"pubkey not found in group";for(const[t,s]of e.sigmap.entries()){const e=r.find((e=>e[0]===t));if(void 0===e)return"partial signature entry not found for sighash: "+t;const o=s.pnonces.find((e=>e.idx===n));if(void 0===o)return"commit package not found for psig idx: "+n;if(!ta(s,o,i,e[1]))return"partial signature invalid"}return null}function kc(e){return e.map((({idx:e,psigs:t,pubkey:n,sid:r})=>t.map((([t,i])=>({sighash:t,idx:e,pubkey:n,psig:i,sid:r}))))).flat()}function Ac(e,t){const n=e.session.members.length,r=kc(t),i=[];for(const[t,s]of e.sigmap.entries()){const e=r.filter((e=>e.sighash===t));Da.ok(e.length===n,"missing partial signatures for sighash: "+t);const o=s.group_pk,a=ea(s,e);i.push([t,o,a])}return i}function Sc(e,t){const{idx:n,binder_sn:r,hidden_sn:i,seckey:s}=t,o=function(e,t,n){const{bind_factors:r,challenge:i,indexes:s,group_pt:o}=e,a=Ho(r,t.idx),c=Jo(s,BigInt(t.idx));if(n.idx!==t.idx)throw new Error(`commit index does not match share index: ${n.idx} !== ${t.idx}`);let u=_e.bytes(n.hidden_sn).big,d=_e.bytes(n.binder_sn).big,l=_e.bytes(t.seckey).big;ko(e.group_pn).hasEvenY()||(u=go.n-u,d=go.n-d);const h=Eo(o.parity*o.state*l),f=Eo(u+d*a),p=Eo(i*c*h+f);return{idx:t.idx,psig:_e.big(p,32).hex,pubkey:(g=t.seckey,Po(Co(_e.bytes(g).big)).hex)};var g}(e,{idx:n,seckey:s},{idx:n,binder_sn:r,hidden_sn:i});return o.psig}async function Ic(e,t){const n=e.config.middleware.sign;try{e.emit("/sign/handler/req",za(t)),"function"==typeof n&&(t=n(e,t));const r=e.signer.sign_session(t.data),i=lo({data:JSON.stringify(r),id:t.id,tag:"/sign/res"}),s=await e.client.publish(i,t.env.pubkey);if(!s.ok)throw new Error("failed to publish response");e.emit("/sign/handler/res",za(s.data))}catch(n){e.debug&&console.log(n),e.emit("/sign/handler/rej",[Fa(n),za(t)])}}function Bc(e){return async t=>{const n=function(e){if(Array.isArray(e))return e;if("string"==typeof e)return[e];throw new Error("invalid message payload")}(t);return e.queue.push(n)}}function Tc(e){return async(t,n={})=>{const r="string"==typeof t?[[t]]:t,i=sc(e.peers),s=ec(n.peers??=i,e.group.threshold),o=gc(tc(e.group,[e.pubkey,...s]),r,n);Da.ok(null!==o,"invalid session template");const a=yc(e.group,o);let c=null;try{c=await async function(e,t,n){const r=await e.client.multicast({data:JSON.stringify(n),tag:"/sign/req"},t);if(!r.sub.ok)throw new Error(r.sub.reason);return r.sub.inbox}(e,s,a),e.emit("/sign/sender/res",za(c))}catch(t){e.debug&&console.log(t);const n=Fa(t);return e.emit("/sign/sender/rej",[n,a]),{ok:!1,err:n}}try{Da.ok(null!==c,"no responses from peers");const t=function(e,t,n){const r=_c(e.group,n),i=[e.signer.sign_session(n)];return t.forEach((e=>{const t=function(e){try{const t=ja.sign.psig_pkg,n=JSON.parse(e.data),r=t.parse(n);return{...e,data:r}}catch(e){throw new Error("signature message failed validation")}}(e),n=xc(r,t.data);Da.ok(null===n,n+" : "+e.env.pubkey),i.push(t.data)})),Ac(r,i)}(e,c,a);return e.emit("/sign/sender/ret",[a.sid,t]),{ok:!0,data:t}}catch(t){e.debug&&console.log(t);const n=Fa(t);return e.emit("/sign/sender/err",[n,c??[]]),{ok:!1,err:n}}}}var Oc=Object.freeze({__proto__:null,ecdh_handler_api:oc,ecdh_request_api:ac,echo_handler_api:async function(e,t){try{e.emit("/echo/handler/req",t);const n=e.peers.find((e=>e.pubkey===t.env.pubkey));if(void 0===n)throw new Error("peer data not found");const r=lo({data:JSON.stringify(n.policy),id:t.id,tag:"/echo/res"}),i=await e.client.publish(r,t.env.pubkey);if(!i.ok)throw new Error("failed to publish response");e.emit("/echo/handler/res",i.data)}catch(n){e.debug&&console.log(n),e.emit("/echo/handler/rej",[Fa(n),t])}},echo_request_api:cc,ping_handler_api:uc,ping_request_api:dc,sign_handler_api:Ic,sign_queue_api:Bc,sign_request_api:Tc});function Nc(e,t=[]){const n=e.shares.map(((e,n)=>Uc(e,t.at(n))));return{group:{commits:n.map((e=>{const t=Ga(e.binder_sn,"ecdsa"),n=Ga(e.hidden_sn,"ecdsa"),r=Ga(e.seckey,"ecdsa");return{idx:e.idx,binder_pn:t,hidden_pn:n,pubkey:r}})),group_pk:e.group_pk,threshold:e.vss_commits.length},shares:n}}function Uc(e,t){const{idx:n,seckey:r}=e,i=t??_e.random(64).hex;Da.size(i,64,"auxiliary seed must be 64 bytes");const s=jo(r,i.slice(0,32)).hex;return{idx:n,binder_sn:jo(r,i.slice(32,64)).hex,hidden_sn:s,seckey:r}}var Rc=Object.freeze({__proto__:null,GET_DEFAULT_SESSION_CONFIG:pc,combine_ecdh_pkgs:ra,combine_signature_pkgs:Ac,create_dealer_pkg:Nc,create_ecdh_pkg:na,create_member_commits:wc,create_member_shares:bc,create_partial_sig:Sc,create_psig_pkg:Ec,create_psig_records:kc,create_session_commits:vc,create_session_pkg:yc,create_session_template:gc,create_share_pkg:Uc,generate_dealer_pkg:function(e,t,n=[],r=[]){return Nc(function(e,t,n=[]){const r=Qo(e,t,n),i=r.vss_commits[0];return{...r,group_pk:i}}(e,t,n),r)},get_commit_by_idx:fc,get_commit_by_pubkey:function(e,t){const n=e.find((e=>e.pubkey===t));return Da.exists(n,"commit package not found for pubkey: "+t),n},get_group_id:hc,get_group_indexes:function(e){return e.commits.map((e=>e.idx))},get_member_indexes:tc,get_session_ctx:_c,get_session_id:mc,is_group_member:function(e,t){const n=t.idx,r=Ga(t.seckey,"ecdsa");return e.commits.some((e=>e.idx===n&&e.pubkey===r))},recover_secret_key:function(e,t){Da.ok(t.length>=e.threshold,"not enough shares provided");const n=e.commits.map((e=>e.pubkey));for(const e of t){const t=Ga(e.seckey,"ecdsa");Da.ok(n.includes(t),"share not found in group: "+e.idx)}return Xo(t)},select_random_peers:ec,verify_psig_pkg:xc,verify_session_pkg:function(e,t){const n=hc(e),r=mc(n,t);return t.gid===n&&t.sid===r}});let Lc=class{constructor(){this.eventMap=new Map}_get_event_handlers(e){const t=this.eventMap.get(e);if(!t){const t=new Set;return this.eventMap.set(e,t),t}return t}has(e){const t=this.eventMap.get(e);return void 0!==t&&t.size>0}on(e,t){this._get_event_handlers(e).add(t)}once(e,t){const n=r=>{this.off(e,n),Cc(t,r)};this.on(e,n)}within(e,t,n){const r=e=>{Cc(t,e)};setTimeout((()=>{this.off(e,r)}),n),this.on(e,r)}emit(e,t){const n=[];this._get_event_handlers(e).forEach((e=>{const r=Cc(e,t);r instanceof Promise&&n.push(r)})),this._get_event_handlers("*").forEach((r=>{const i=Cc(r,[e,t]);i instanceof Promise&&n.push(i)})),Promise.allSettled(n)}off(e,t){this._get_event_handlers(e).delete(t)}clear(e){this.eventMap.delete(e)}};function Cc(e,t){return Array.isArray(t)&&t.length>0?e.apply(null,t):e(t)}class Pc{constructor(e,t,n){this._config={...n},this._group=function(e){try{return ja.pkg.group.parse(e)}catch(e){throw console.log("error:",e),new Error("group package failed validation")}}(e),this._share=function(e){try{return ja.pkg.share.parse(e)}catch(e){throw console.log("error:",e),new Error("share package failed validation")}}(t),this._pubkey=Ga(this._share.seckey,"bip340")}get config(){return this._config}get group(){return this._group}get pubkey(){return this._pubkey}gen_ecdh_share(e,t){return na(e,t,this._share)}sign_message(e,t){const n=Pn.sign(e,this._share.seckey,t);return new _e(n).hex}sign_session(e){return Ec(_c(this._group,e),this._share)}unwrap(e,t){return br(mr(this._share.seckey,t),e)}wrap(e,t){return wr(mr(this._share.seckey,t),e)}}class Zc{constructor(e){this._node=e,this._ival=e.config.sign_ival,this._queue=[],this._timer=null}get node(){return this._node}get timer(){return this._timer}async push(e){return new Promise(((t,n)=>{this._queue.push({sigvec:e,resolve:t,reject:n}),this.schedule()}))}async process(){const e=[...this._queue];if(this._queue=[],this._timer=null,0!==e.length){this.node.emit("info","batch signing event ids: "+String(e.map((e=>e.sigvec[0]))));try{const t=e.map((e=>e.sigvec)),n=await this.node.req.sign(t);if(!n.ok)return void e.forEach((e=>e.reject(n.err)));e.forEach((e=>{const t=n.data.find((t=>t[0]===e.sigvec[0]));void 0!==t?e.resolve(t):e.reject("signature missing from response")}))}catch(t){e.forEach((e=>e.reject(t.message)))}}}schedule(){null===this.timer&&(this._timer=setTimeout((()=>this.process()),this._ival))}}class $c{constructor(){this.eventMap=new Map}getEventHandlers(e){const t=this.eventMap.get(e);if(!t){const t=new Set;return this.eventMap.set(e,t),t}return t}has(e){const t=this.eventMap.get(e);return void 0!==t&&t.size>0}on(e,t){this.getEventHandlers(e).add(t)}once(e,t){const n=r=>{this.off(e,n),t(r)};this.on(e,n)}within(e,t,n){const r=e=>{t(e)};setTimeout((()=>{this.off(e,r)}),n),this.on(e,r)}emit(e,t){const n=[];this.getEventHandlers(e).forEach((e=>{const r=e(t);r instanceof Promise&&n.push(r)})),this.getEventHandlers("*").forEach((r=>{const i=r(e,t);i instanceof Promise&&n.push(i)})),Promise.allSettled(n)}off(e,t){this.getEventHandlers(e).delete(t)}clear(e){this.eventMap.delete(e)}}function jc(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function qc(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Mc(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}const zc="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Hc=e=>e instanceof Uint8Array,Fc=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Dc=(e,t)=>e<<32-t|e>>>t;
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Vc(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Hc(e))throw new Error("expected Uint8Array, got "+typeof e);return e}let Kc=class{clone(){return this._cloneInto()}};function Wc(e){const t=t=>e().update(Vc(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Gc(e=32){if(zc&&"function"==typeof zc.getRandomValues)return zc.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}let Jc=class extends Kc{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Fc(this.buffer)}update(e){Mc(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Vc(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Fc(e);for(;r<=i-s;s+=r)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Mc(this),function(e,t){qc(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let e=s;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+u,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=Fc(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=s,r%t&&e.buffer.set(n),e}};const Yc=(e,t,n)=>e&t^e&n^t&n,Xc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Qc=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),eu=new Uint32Array(64);let tu=class extends Jc{constructor(){super(64,32,8,!1),this.A=0|Qc[0],this.B=0|Qc[1],this.C=0|Qc[2],this.D=0|Qc[3],this.E=0|Qc[4],this.F=0|Qc[5],this.G=0|Qc[6],this.H=0|Qc[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[e,t,n,r,i,s,o,a]}set(e,t,n,r,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)eu[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=eu[e-15],n=eu[e-2],r=Dc(t,7)^Dc(t,18)^t>>>3,i=Dc(n,17)^Dc(n,19)^n>>>10;eu[e]=i+eu[e-7]+r+eu[e-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(Dc(o,6)^Dc(o,11)^Dc(o,25))+((d=o)&a^~d&c)+Xc[e]+eu[e]|0,l=(Dc(n,2)^Dc(n,13)^Dc(n,22))+Yc(n,r,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=r,r=n,n=t+l|0}var d;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,r,i,s,o,a,c,u)}roundClean(){eu.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const nu=Wc((()=>new tu)),ru=BigInt(0),iu=BigInt(1),su=BigInt(2),ou=e=>e instanceof Uint8Array,au=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function cu(e){if(!ou(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=au[e[n]];return t}function uu(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function du(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function lu(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[t]=s}return n}function hu(e){return du(cu(e))}function fu(e){if(!ou(e))throw new Error("Uint8Array expected");return du(cu(Uint8Array.from(e).reverse()))}function pu(e,t){return lu(e.toString(16).padStart(2*t,"0"))}function gu(e,t){return pu(e,t).reverse()}function yu(e,t,n){let r;if("string"==typeof t)try{r=lu(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!ou(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function mu(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!ou(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const wu=e=>(su<<BigInt(e-1))-iu,bu=e=>new Uint8Array(e),vu=e=>Uint8Array.from(e);function _u(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=bu(e),i=bu(e),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...e)=>n(i,r,...e),c=(e=bu())=>{i=a(vu([0]),e),r=a(),0!==e.length&&(i=a(vu([1]),e),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return mu(...n)};return(e,t)=>{let n;for(o(),c(e);!(n=t(u()));)c();return o(),n}}const Eu={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function xu(e,t,n={}){const r=(t,n,r)=>{const i=Eu[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const s=e[t];if(!(r&&void 0===s||i(s,e)))throw new Error(`Invalid param ${String(t)}=${s} (${typeof s}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}var ku=Object.freeze({__proto__:null,bitGet:function(e,t){return e>>BigInt(t)&iu},bitLen:function(e){let t;for(t=0;e>ru;e>>=iu,t+=1);return t},bitMask:wu,bitSet:(e,t,n)=>e|(n?iu:ru)<<BigInt(t),bytesToHex:cu,bytesToNumberBE:hu,bytesToNumberLE:fu,concatBytes:mu,createHmacDrbg:_u,ensureBytes:yu,equalBytes:function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},hexToBytes:lu,hexToNumber:du,numberToBytesBE:pu,numberToBytesLE:gu,numberToHexUnpadded:uu,numberToVarBytesBE:function(e){return lu(uu(e))},utf8ToBytes:function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))},validateObject:xu});
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Au=BigInt(0),Su=BigInt(1),Iu=BigInt(2),Bu=BigInt(3),Tu=BigInt(4),Ou=BigInt(5),Nu=BigInt(8);function Uu(e,t){const n=e%t;return n>=Au?n:t+n}function Ru(e,t,n){if(n<=Au||t<Au)throw new Error("Expected power/modulo > 0");if(n===Su)return Au;let r=Su;for(;t>Au;)t&Su&&(r=r*e%n),e=e*e%n,t>>=Su;return r}function Lu(e,t,n){let r=e;for(;t-- >Au;)r*=r,r%=n;return r}function Cu(e,t){if(e===Au||t<=Au)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Uu(e,t),r=t,i=Au,s=Su;for(;n!==Au;){const e=r%n,t=i-s*(r/n);r=n,n=e,i=s,s=t}if(r!==Su)throw new Error("invert: does not exist");return Uu(i,t)}function Pu(e){if(e%Tu===Bu){const t=(e+Su)/Tu;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%Nu===Ou){const t=(e-Ou)/Nu;return function(e,n){const r=e.mul(n,Iu),i=e.pow(r,t),s=e.mul(n,i),o=e.mul(e.mul(s,Iu),i),a=e.mul(s,e.sub(o,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Su)/Iu;let n,r,i;for(n=e-Su,r=0;n%Iu===Au;n/=Iu,r++);for(i=Iu;i<e&&Ru(i,t,e)!==e-Su;i++);if(1===r){const t=(e+Su)/Tu;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const s=(n+Su)/Iu;return function(e,o){if(e.pow(o,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),u=e.pow(o,s),d=e.pow(o,n);for(;!e.eql(d,e.ONE);){if(e.eql(d,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(d);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,Su<<BigInt(a-t-1));c=e.sqr(n),u=e.mul(u,n),d=e.mul(d,c),a=t}return u}}(e)}BigInt(9),BigInt(16);const Zu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $u(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function ju(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function qu(e){const t=ju(e);return t+Math.ceil(t/2)}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const Mu=BigInt(0),zu=BigInt(1);function Hu(e){return xu(e.Fp,Zu.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),xu(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...$u(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const{bytesToNumberBE:Fu,hexToBytes:Du}=ku,Vu={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=Vu;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Fu(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Vu,n="string"==typeof e?Du(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:s}=Vu._parseInt(n.subarray(2)),{d:o,l:a}=Vu._parseInt(s);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:o}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),i=t(n(e.r)),s=r.length/2,o=i.length/2,a=n(s),c=n(o);return`30${n(o+s+4)}02${c}${i}02${a}${r}`}},Ku=BigInt(0),Wu=BigInt(1);BigInt(2);const Gu=BigInt(3);function Ju(e){const t=function(e){const t=Hu(e);xu(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return mu(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function s(e){const{a:r,b:i}=t,s=n.sqr(e),o=n.mul(s,e);return n.add(n.add(o,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function o(e){return"bigint"==typeof e&&Ku<e&&e<t.n}function a(e){if(!o(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:s}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=cu(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let o;try{o="bigint"==typeof e?e:hu(yu("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return i&&(o=Uu(o,s)),a(o),o}const u=new Map;function d(e){if(!(e instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof l)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?l.ZERO:new l(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(l.fromAffine)}static fromHex(e){const t=l.fromAffine(i(yu("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return l.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),o=s(e);if(!n.eql(i,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){d(e);const{px:t,py:r,pz:i}=this,{px:s,py:o,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(s,i)),u=n.eql(n.mul(r,a),n.mul(o,i));return c&&u}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,Gu),{px:s,py:o,pz:a}=this;let c=n.ZERO,u=n.ZERO,d=n.ZERO,h=n.mul(s,s),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(s,o);return g=n.add(g,g),d=n.mul(s,a),d=n.add(d,d),c=n.mul(e,d),u=n.mul(i,p),u=n.add(c,u),c=n.sub(f,u),u=n.add(f,u),u=n.mul(c,u),c=n.mul(g,c),d=n.mul(i,d),p=n.mul(e,p),g=n.sub(h,p),g=n.mul(e,g),g=n.add(g,d),d=n.add(h,h),h=n.add(d,h),h=n.add(h,p),h=n.mul(h,g),u=n.add(u,h),p=n.mul(o,a),p=n.add(p,p),h=n.mul(p,g),c=n.sub(c,h),d=n.mul(p,f),d=n.add(d,d),d=n.add(d,d),new l(c,u,d)}add(e){d(e);const{px:r,py:i,pz:s}=this,{px:o,py:a,pz:c}=e;let u=n.ZERO,h=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,Gu);let y=n.mul(r,o),m=n.mul(i,a),w=n.mul(s,c),b=n.add(r,i),v=n.add(o,a);b=n.mul(b,v),v=n.add(y,m),b=n.sub(b,v),v=n.add(r,s);let _=n.add(o,c);return v=n.mul(v,_),_=n.add(y,w),v=n.sub(v,_),_=n.add(i,s),u=n.add(a,c),_=n.mul(_,u),u=n.add(m,w),_=n.sub(_,u),f=n.mul(p,v),u=n.mul(g,w),f=n.add(u,f),u=n.sub(m,f),f=n.add(m,f),h=n.mul(u,f),m=n.add(y,y),m=n.add(m,y),w=n.mul(p,w),v=n.mul(g,v),m=n.add(m,w),w=n.sub(y,w),w=n.mul(p,w),v=n.add(v,w),y=n.mul(m,v),h=n.add(h,y),y=n.mul(_,v),u=n.mul(b,u),u=n.sub(u,y),y=n.mul(b,m),f=n.mul(_,f),f=n.add(f,y),new l(u,h,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(l.ZERO)}wNAF(e){return f.wNAFCached(this,u,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(l.fromAffine)}))}multiplyUnsafe(e){const r=l.ZERO;if(e===Ku)return r;if(a(e),e===Wu)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:s,k1:o,k2neg:c,k2:u}=i.splitScalar(e),d=r,h=r,p=this;for(;o>Ku||u>Ku;)o&Wu&&(d=d.add(p)),u&Wu&&(h=h.add(p)),p=p.double(),o>>=Wu,u>>=Wu;return s&&(d=d.negate()),c&&(h=h.negate()),h=new l(n.mul(h.px,i.beta),h.py,h.pz),d.add(h)}multiply(e){a(e);let r,i,s=e;const{endo:o}=t;if(o){const{k1neg:e,k1:t,k2neg:a,k2:c}=o.splitScalar(s);let{p:u,f:d}=this.wNAF(t),{p:h,f:p}=this.wNAF(c);u=f.constTimeNegate(e,u),h=f.constTimeNegate(a,h),h=new l(n.mul(h.px,o.beta),h.py,h.pz),r=u.add(h),i=d.add(p)}else{const{p:e,f:t}=this.wNAF(s);r=e,i=t}return l.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=l.BASE,i=(e,t)=>t!==Ku&&t!==Wu&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),s=i(this,t).add(i(e,n));return s.is0()?void 0:s}toAffine(e){const{px:t,py:r,pz:i}=this,s=this.is0();null==e&&(e=s?n.ONE:n.inv(i));const o=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(s)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===Wu)return!0;if(n)return n(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===Wu?this:n?n(l,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(l,this,e)}toHex(e=!0){return cu(this.toRawBytes(e))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const h=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>Mu;)n&zu&&(r=r.add(i)),i=i.double(),n>>=zu;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),s=[];let o=e,a=o;for(let e=0;e<n;e++){a=o,s.push(a);for(let e=1;e<i;e++)a=a.add(o),s.push(a);o=a.double()}return s},wNAF(t,i,s){const{windows:o,windowSize:a}=r(t);let c=e.ZERO,u=e.BASE;const d=BigInt(2**t-1),l=2**t,h=BigInt(t);for(let e=0;e<o;e++){const t=e*a;let r=Number(s&d);s>>=h,r>a&&(r-=l,s+=zu);const o=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?u=u.add(n(p,i[o])):c=c.add(n(g,i[f]))}return{p:c,f:u}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let s=t.get(e);return s||(s=this.precomputeWindow(e,i),1!==i&&t.set(e,r(s))),this.wNAF(i,s,n)}}}(l,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:o}}function Yu(e){const t=function(e){const t=Hu(e);return xu(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,s=2*n.BYTES+1;function o(e){return Uu(e,r)}function a(e){return Cu(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:l}=Ju({...t,toBytes(e,t,r){const i=t.toAffine(),s=n.toBytes(i.x),o=mu;return r?o(Uint8Array.from([t.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],o=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===s&&4===r){return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${s} uncompressed bytes`)}{const e=hu(o);if(!function(e){return Ku<e&&e<n.ORDER}(e))throw new Error("Point is not on curve");const t=d(e);let i=n.sqrt(t);return!(1&~r)!==((i&Wu)===Wu)&&(i=n.neg(i)),{x:e,y:i}}}}),h=e=>cu(pu(e,t.nByteLength));function f(e){return e>r>>Wu}const p=(e,t,n)=>hu(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=yu("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=Vu.toSig(yu("DER",e));return new g(t,n)}assertValidity(){if(!l(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!l(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:i,recovery:s}=this,u=b(yu("msgHash",e));if(null==s||![0,1,2,3].includes(s))throw new Error("recovery id invalid");const d=2===s||3===s?r+t.n:r;if(d>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const l=1&s?"03":"02",f=c.fromHex(l+h(d)),p=a(d),g=o(-u*p),y=o(i*p),m=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!m)throw new Error("point at infinify");return m.assertValidity(),m}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return lu(this.toDERHex())}toDERHex(){return Vu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return lu(this.toCompactHex())}toCompactHex(){return h(this.r)+h(this.s)}}const y={isValidPrivateKey(e){try{return u(e),!0}catch(e){return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const e=qu(t.n);return function(e,t,n=!1){const r=e.length,i=ju(t),s=qu(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const o=Uu(n?hu(e):fu(e),t-Su)+Su;return n?gu(o,i):pu(o,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function m(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===s:n?r===2*i||r===2*s:e instanceof c}const w=t.bits2int||function(e){const n=hu(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},b=t.bits2int_modN||function(e){return o(w(e))},v=wu(t.nBitLength);function _(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(Ku<=e&&e<v))throw new Error(`bigint expected < 2^${t.nBitLength}`);return pu(e,t.nByteLength)}function E(e,r,i=x){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:s,randomBytes:d}=t;let{lowS:h,prehash:p,extraEntropy:y}=i;null==h&&(h=!0),e=yu("msgHash",e),p&&(e=yu("prehashed msgHash",s(e)));const m=b(e),v=u(r),E=[_(v),_(m)];if(null!=y){const e=!0===y?d(n.BYTES):y;E.push(yu("extraEntropy",e))}const k=mu(...E),A=m;return{seed:k,k2sig:function(e){const t=w(e);if(!l(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=o(r.x);if(i===Ku)return;const s=o(n*o(A+i*v));if(s===Ku)return;let u=(r.x===i?0:2)|Number(r.y&Wu),d=s;return h&&f(s)&&(d=function(e){return f(e)?o(-e):e}(s),u^=1),new g(i,d,u)}}}const x={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(m(e))throw new Error("first arg must be private key");if(!m(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(u(e)).toRawBytes(n)},sign:function(e,n,r=x){const{seed:i,k2sig:s}=E(e,n,r),o=t;return _u(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)},verify:function(e,n,r,i=k){const s=e;if(n=yu("msgHash",n),r=yu("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:d}=i;let l,h;try{if("string"==typeof s||s instanceof Uint8Array)try{l=g.fromDER(s)}catch(e){if(!(e instanceof Vu.Err))throw e;l=g.fromCompact(s)}else{if("object"!=typeof s||"bigint"!=typeof s.r||"bigint"!=typeof s.s)throw new Error("PARSE");{const{r:e,s:t}=s;l=new g(e,t)}}h=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&l.hasHighS())return!1;d&&(n=t.hash(n));const{r:f,s:p}=l,y=b(n),m=a(p),w=o(y*m),v=o(f*m),_=c.BASE.multiplyAndAddUnsafe(h,w,v)?.toAffine();return!!_&&o(_.x)===f},ProjectivePoint:c,Signature:g,utils:y}}BigInt(4);let Xu=class extends Kc{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");jc(e.outputLen),jc(e.blockLen)}(e);const n=Vc(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return Mc(this),this.iHash.update(e),this}digestInto(e){Mc(this),qc(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=r,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Qu=(e,t,n)=>new Xu(e,t).update(n).digest();
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function ed(e){return{hash:e,hmac:(t,...n)=>Qu(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Hc(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:Gc}}Qu.create=(e,t)=>new Xu(e,t);
/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */
const td=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),nd=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),rd=BigInt(1),id=BigInt(2),sd=(e,t)=>(e+t/id)/t;function od(e){const t=td,n=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=e*e*e%t,d=u*u*e%t,l=Lu(d,n,t)*d%t,h=Lu(l,n,t)*d%t,f=Lu(h,id,t)*u%t,p=Lu(f,i,t)*f%t,g=Lu(p,s,t)*p%t,y=Lu(g,a,t)*g%t,m=Lu(y,c,t)*y%t,w=Lu(m,a,t)*g%t,b=Lu(w,n,t)*d%t,v=Lu(b,o,t)*p%t,_=Lu(v,r,t)*u%t,E=Lu(_,id,t);if(!ad.eql(ad.sqr(E),e))throw new Error("Cannot find square root");return E}const ad=function(e,t,n=!1,r={}){if(e<=Au)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:s}=$u(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=Pu(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:s,MASK:wu(i),ZERO:Au,ONE:Su,create:t=>Uu(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return Au<=t&&t<e},is0:e=>e===Au,isOdd:e=>(e&Su)===Su,neg:t=>Uu(-t,e),eql:(e,t)=>e===t,sqr:t=>Uu(t*t,e),add:(t,n)=>Uu(t+n,e),sub:(t,n)=>Uu(t-n,e),mul:(t,n)=>Uu(t*n,e),pow:(e,t)=>function(e,t,n){if(n<Au)throw new Error("Expected power > 0");if(n===Au)return e.ONE;if(n===Su)return t;let r=e.ONE,i=t;for(;n>Au;)n&Su&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Su;return r}(a,e,t),div:(t,n)=>Uu(t*Cu(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Cu(t,e),sqrt:r.sqrt||(e=>o(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?gu(e,s):pu(e,s),fromBytes:e=>{if(e.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${e.length}`);return n?fu(e):hu(e)}});return Object.freeze(a)}(td,void 0,void 0,{sqrt:od}),cd=function(e,t){const n=t=>Yu({...e,...ed(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:ad,n:nd,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=nd,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-rd*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,o=BigInt("0x100000000000000000000000000000000"),a=sd(s*e,t),c=sd(-r*e,t);let u=Uu(e-a*n-c*i,t),d=Uu(-a*r-c*s,t);const l=u>o,h=d>o;if(l&&(u=t-u),h&&(d=t-d),u>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:u,k2neg:h,k2:d}}}},nu),ud=BigInt(0),dd=e=>"bigint"==typeof e&&ud<e&&e<td,ld={};function hd(e,...t){let n=ld[e];if(void 0===n){const t=nu(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=mu(t,t),ld[e]=n}return nu(mu(n,...t))}const fd=e=>e.toRawBytes(!0).slice(1),pd=e=>pu(e,32),gd=e=>Uu(e,td),yd=e=>Uu(e,nd),md=cd.ProjectivePoint;function wd(e){let t=cd.utils.normPrivateKeyToScalar(e),n=md.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:yd(-t),bytes:fd(n)}}function bd(e){if(!dd(e))throw new Error("bad x: need 0 < x < p");const t=gd(e*e);let n=od(gd(t*e+BigInt(7)));n%id!==ud&&(n=gd(-n));const r=new md(e,n,rd);return r.assertValidity(),r}function vd(...e){return yd(hu(hd("BIP0340/challenge",...e)))}function _d(e){return wd(e).bytes}function Ed(e,t,n=Gc(32)){const r=yu("message",e),{bytes:i,scalar:s}=wd(t),o=yu("auxRand",n,32),a=pd(s^hu(hd("BIP0340/aux",o))),c=hd("BIP0340/nonce",a,i,r),u=yd(hu(c));if(u===ud)throw new Error("sign failed: k is zero");const{bytes:d,scalar:l}=wd(u),h=vd(d,i,r),f=new Uint8Array(64);if(f.set(d,0),f.set(pd(yd(l+h*s)),32),!xd(f,r,i))throw new Error("sign: Invalid signature produced");return f}function xd(e,t,n){const r=yu("signature",e,64),i=yu("message",t),s=yu("publicKey",n,32);try{const e=bd(hu(s)),t=hu(r.subarray(0,32));if(!dd(t))return!1;const n=hu(r.subarray(32,64));if(!("bigint"==typeof(u=n)&&ud<u&&u<nd))return!1;const d=vd(pd(t),fd(e),i),l=(o=e,a=n,c=yd(-d),md.BASE.multiplyAndAddUnsafe(o,a,c));return!(!l||!l.hasEvenY()||l.toAffine().x!==t)}catch(e){return!1}var o,a,c,u}const kd=(()=>({getPublicKey:_d,sign:Ed,verify:xd,utils:{randomPrivateKey:cd.utils.randomPrivateKey,lift_x:bd,pointToBytes:fd,numberToBytesBE:pu,bytesToNumberBE:hu,taggedHash:hd,mod:Uu}}))(),Ad="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Sd=e=>e instanceof Uint8Array,Id=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Bd=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const Td=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Od(e){if(!Sd(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Td[e[n]];return t}function Nd(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[t]=s}return n}function Ud(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Sd(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function Rd(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Sd(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}class Ld{clone(){return this._cloneInto()}}function Cd(e){const t=t=>e().update(Ud(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Pd(e=32){if(Ad&&"function"==typeof Ad.getRandomValues)return Ad.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Zd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function $d(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const jd={number:Zd,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:$d,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Zd(e.outputLen),Zd(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){$d(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}};class qd extends Ld{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Id(this.buffer)}update(e){jd.exists(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Ud(e)).length;for(let s=0;s<i;){const o=Math.min(r-this.pos,i-s);if(o!==r)n.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Id(e);for(;r<=i-s;s+=r)this.process(t,s)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){jd.exists(this),jd.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let e=s;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(n>>i&s),a=Number(n&s),c=r?4:0,u=r?0:4;e.setUint32(t+c,o,r),e.setUint32(t+u,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const o=Id(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)o.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:s,pos:o}=this;return e.length=r,e.pos=o,e.finished=i,e.destroyed=s,r%t&&e.buffer.set(n),e}}const Md=(e,t,n)=>e&t^e&n^t&n,zd=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Hd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Fd=new Uint32Array(64);class Dd extends qd{constructor(){super(64,32,8,!1),this.A=0|Hd[0],this.B=0|Hd[1],this.C=0|Hd[2],this.D=0|Hd[3],this.E=0|Hd[4],this.F=0|Hd[5],this.G=0|Hd[6],this.H=0|Hd[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:s,G:o,H:a}=this;return[e,t,n,r,i,s,o,a]}set(e,t,n,r,i,s,o,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)Fd[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Fd[e-15],n=Fd[e-2],r=Bd(t,7)^Bd(t,18)^t>>>3,i=Bd(n,17)^Bd(n,19)^n>>>10;Fd[e]=i+Fd[e-7]+r+Fd[e-16]|0}let{A:n,B:r,C:i,D:s,E:o,F:a,G:c,H:u}=this;for(let e=0;e<64;e++){const t=u+(Bd(o,6)^Bd(o,11)^Bd(o,25))+((d=o)&a^~d&c)+zd[e]+Fd[e]|0,l=(Bd(n,2)^Bd(n,13)^Bd(n,22))+Md(n,r,i)|0;u=c,c=a,a=o,o=s+t|0,s=i,i=r,r=n,n=t+l|0}var d;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,s=s+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(n,r,i,s,o,a,c,u)}roundClean(){Fd.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Vd extends Dd{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Kd=Cd((()=>new Dd));
/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */
function Wd(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Gd(...e){const t=(e,t)=>n=>e(t(n)),n=Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),r=e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0);return{encode:n,decode:r}}function Jd(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(Wd(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function Yd(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function Xd(e,t="="){if(Wd(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Qd(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function el(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],s=Array.from(e);for(s.forEach((e=>{if(Wd(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,o=!0;for(let i=r;i<s.length;i++){const a=s[i],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%n,s[i]=Math.floor(c/n),!Number.isSafeInteger(s[i])||s[i]*n+e!==c)throw new Error("convertRadix: carry overflow");o&&(s[i]?o=!1:r=i)}if(i.push(e),o)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}Cd((()=>new Vd));const tl=(e,t)=>t?tl(t,e%t):e,nl=(e,t)=>e+(t-tl(e,t));function rl(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(nl(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${nl(t,n)}`);let i=0,s=0;const o=2**n-1,a=[];for(const r of e){if(Wd(r),r>=2**t)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(i=i<<t|r,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)a.push((i>>s-n&o)>>>0);i&=2**s-1}if(i=i<<n-s&o,!r&&s>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&s>0&&a.push(i>>>0),a}function il(e,t=!1){if(Wd(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(nl(8,e)>32||nl(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return rl(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(rl(n,e,8,t))}}}function sl(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}const ol=Gd(il(4),Jd("0123456789ABCDEF"),Yd("")),al=Gd(il(5),Jd("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Xd(5),Yd(""));Gd(il(5),Jd("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Xd(5),Yd("")),Gd(il(5),Jd("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Yd(""),Qd((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))));const cl=Gd(il(6),Jd("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Xd(6),Yd("")),ul=Gd(il(6),Jd("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Xd(6),Yd("")),dl=e=>Gd(function(e){return Wd(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return el(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(el(t,e,256))}}}(58),Jd(e),Yd("")),ll=dl("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");dl("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),dl("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const hl=[0,2,3,5,6,7,9,10,11],fl={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=ll.encode(r).padStart(hl[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=hl.indexOf(r.length),s=ll.decode(r);for(let e=0;e<s.length-i;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-i)))}return Uint8Array.from(t)}},pl=Gd(Jd("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Yd("")),gl=[996825010,642813549,513874426,1027748829,705979059];function yl(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<gl.length;e++)1==(t>>e&1)&&(n^=gl[e]);return n}function ml(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=yl(i)^n>>5}i=yl(i);for(let t=0;t<r;t++)i=yl(i)^31&e.charCodeAt(t);for(let e of t)i=yl(i)^e;for(let e=0;e<6;e++)i=yl(i);return i^=n,pl.encode(rl([i%2**30],30,5,!1))}function wl(e){const t="bech32"===e?1:734539939,n=il(5),r=n.decode,i=n.encode,s=sl(r);function o(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(e=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const s=e.slice(0,i),o=e.slice(i+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=pl.decode(o).slice(0,-6),c=ml(s,a,t);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:s,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=e.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${pl.encode(n)}${ml(e,n,t)}`},decode:o,decodeToBytes:function(e){const{prefix:t,words:n}=o(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:sl(o),fromWords:r,fromWordsUnsafe:s,toWords:i}}const bl=wl("bech32");wl("bech32m");const vl={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},_l={utf8:vl,hex:Gd(il(4),Jd("0123456789abcdef"),Yd(""),Qd((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}))),base16:ol,base32:al,base64:cl,base64url:ul,base58:ll,base58xmr:fl};function El(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function xl(e){if("boolean"!=typeof e)throw new Error(`boolean expected, not ${e}`)}function kl(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}
/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */Object.keys(_l).join(", ");const Al=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const Sl=16;function Il(e){return e<<1^283&-(e>>7)}function Bl(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(1&t),e=Il(e);return n}const Tl=(()=>{let e=new Uint8Array(256);for(let t=0,n=1;t<256;t++,n^=Il(n))e[t]=n;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return t})(),Ol=Tl.map(((e,t)=>Tl.indexOf(t))),Nl=e=>e<<8|e>>>24;function Ul(e,t){if(256!==e.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>t(e[r]))),r=n.map(Nl),i=r.map(Nl),s=i.map(Nl),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let t=0;t<256;t++)for(let u=0;u<256;u++){const d=256*t+u;o[d]=n[t]^r[u],a[d]=i[t]^s[u],c[d]=e[t]<<8|e[u]}return{sbox:e,sbox2:c,T0:n,T1:r,T2:i,T3:s,T01:o,T23:a}}const Rl=Ul(Tl,(e=>Bl(e,3)<<24|e<<16|e<<8|Bl(e,2))),Ll=Ul(Ol,(e=>Bl(e,11)<<24|Bl(e,13)<<16|Bl(e,9)<<8|Bl(e,14))),Cl=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=Il(n))e[t]=n;return e})();function Pl(e){kl(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=Rl,r=Al(e),i=r.length,s=e=>$l(n,e,e,e,e),o=new Uint32Array(t+28);o.set(r);for(let e=i;e<o.length;e++){let t=o[e-1];e%i==0?t=s((a=t)<<24|a>>>8)^Cl[e/i-1]:i>6&&e%i==4&&(t=s(t)),o[e]=o[e-i]^t}var a;return o}function Zl(e,t,n,r,i,s){return e[n<<8&65280|r>>>8&255]^t[i>>>8&65280|s>>>24&255]}function $l(e,t,n,r,i){return e[255&t|65280&n]|e[r>>>16&255|i>>>16&65280]<<16}function jl(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=Rl;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const u=e.length/4-2;for(let s=0;s<u;s++){const s=e[c++]^Zl(o,a,t,n,r,i),u=e[c++]^Zl(o,a,n,r,i,t),d=e[c++]^Zl(o,a,r,i,t,n),l=e[c++]^Zl(o,a,i,t,n,r);t=s,n=u,r=d,i=l}return{s0:e[c++]^$l(s,t,n,r,i),s1:e[c++]^$l(s,n,r,i,t),s2:e[c++]^$l(s,r,i,t,n),s3:e[c++]^$l(s,i,t,n,r)}}function ql(e,t,n,r,i){const{sbox2:s,T01:o,T23:a}=Ll;let c=0;t^=e[c++],n^=e[c++],r^=e[c++],i^=e[c++];const u=e.length/4-2;for(let s=0;s<u;s++){const s=e[c++]^Zl(o,a,t,i,r,n),u=e[c++]^Zl(o,a,n,t,i,r),d=e[c++]^Zl(o,a,r,n,t,i),l=e[c++]^Zl(o,a,i,r,n,t);t=s,n=u,r=d,i=l}return{s0:e[c++]^$l(s,t,i,r,n),s1:e[c++]^$l(s,n,t,i,r),s2:e[c++]^$l(s,r,n,t,i),s3:e[c++]^$l(s,i,r,n,t)}}function Ml(e,t){if(!t)return new Uint8Array(e);if(kl(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}const zl=(Hl={blockSize:16,nonceLength:16},Fl=function(e,t,n={}){kl(e),kl(t,16);const r=!n.disablePadding;return{encrypt:(n,i)=>{const s=Pl(e),{b:o,o:a,out:c}=function(e,t,n){let r=e.length;const i=r%Sl;if(!t&&0!==i)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=Al(e);if(t){let e=Sl-i;e||(e=Sl),r+=e}const o=Ml(r,n);return{b:s,o:Al(o),out:o}}(n,r,i),u=Al(t);let d=u[0],l=u[1],h=u[2],f=u[3],p=0;for(;p+4<=o.length;)d^=o[p+0],l^=o[p+1],h^=o[p+2],f^=o[p+3],({s0:d,s1:l,s2:h,s3:f}=jl(s,d,l,h,f)),a[p++]=d,a[p++]=l,a[p++]=h,a[p++]=f;if(r){const e=function(e){const t=new Uint8Array(16),n=Al(t);t.set(e);const r=Sl-e.length;for(let e=Sl-r;e<Sl;e++)t[e]=r;return n}(n.subarray(4*p));d^=e[0],l^=e[1],h^=e[2],f^=e[3],({s0:d,s1:l,s2:h,s3:f}=jl(s,d,l,h,f)),a[p++]=d,a[p++]=l,a[p++]=h,a[p++]=f}return s.fill(0),c},decrypt:(n,i)=>{!function(e){if(kl(e),e.length%Sl!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}(n);const s=function(e){const t=Pl(e),n=t.slice(),r=t.length,{sbox2:i}=Rl,{T0:s,T1:o,T2:a,T3:c}=Ll;for(let e=0;e<r;e+=4)for(let i=0;i<4;i++)n[e+i]=t[r-e-4+i];t.fill(0);for(let e=4;e<r-4;e++){const t=n[e],r=$l(i,t,t,t,t);n[e]=s[255&r]^o[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}(e),o=Al(t),a=Ml(n.length,i),c=Al(n),u=Al(a);let d=o[0],l=o[1],h=o[2],f=o[3];for(let e=0;e+4<=c.length;){const t=d,n=l,r=h,i=f;d=c[e+0],l=c[e+1],h=c[e+2],f=c[e+3];const{s0:o,s1:a,s2:p,s3:g}=ql(s,d,l,h,f);u[e++]=o^t,u[e++]=a^n,u[e++]=p^r,u[e++]=g^i}return s.fill(0),function(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const i=e.subarray(0,-r);for(let t=0;t<r;t++)if(e[n-t-1]!==r)throw new Error("aes/pcks5: wrong padding");return i}(a,r)}}},Object.assign(Fl,Hl),Fl);var Hl,Fl;const Dl=e=>Uint8Array.from(e.split("").map((e=>e.charCodeAt(0)))),Vl=Dl("expand 16-byte k"),Kl=Dl("expand 32-byte k"),Wl=Al(Vl),Gl=Al(Kl);function Jl(e,t){return e<<t|e>>>32-t}function Yl(e){return e.byteOffset%4==0}Gl.slice();const Xl=2**32-1,Ql=new Uint32Array;function eh(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:o}=function(e,t){if(null==t||"object"!=typeof t)throw new Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw new Error("core must be a function");return El(i),El(o),xl(s),xl(n),(t,a,c,u,d=0)=>{kl(t),kl(a),kl(c);const l=c.length;if(u||(u=new Uint8Array(l)),kl(u),El(d),d<0||d>=Xl)throw new Error("arx: counter overflow");if(u.length<l)throw new Error(`arx: output (${u.length}) is shorter than data (${l})`);const h=[];let f,p,g=t.length;if(32===g)f=t.slice(),h.push(f),p=Gl;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(t),f.set(t,16),p=Wl,h.push(f)}Yl(a)||(a=a.slice(),h.push(a));const y=Al(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,Al(a.subarray(0,16)),y),a=a.subarray(16)}const m=16-i;if(m!==a.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(12!==m){const e=new Uint8Array(12);e.set(a,s?0:12-a.length),a=e,h.push(a)}const w=Al(a);for(!function(e,t,n,r,i,s,o,a){const c=i.length,u=new Uint8Array(64),d=Al(u),l=Yl(i)&&Yl(s),h=l?Al(i):Ql,f=l?Al(s):Ql;for(let p=0;p<c;o++){if(e(t,n,r,d,o,a),o>=Xl)throw new Error("arx: counter overflow");const g=Math.min(64,c-p);if(l&&64===g){const e=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let t,n=0;n<16;n++)t=e+n,f[t]=h[t]^d[n];p+=64}else{for(let e,t=0;t<g;t++)e=p+t,s[e]=i[e]^u[t];p+=g}}}(e,p,y,w,c,u,d,o);h.length>0;)h.pop().fill(0);return u}}function th(e,t,n,r,i,s=20){let o=e[0],a=e[1],c=e[2],u=e[3],d=t[0],l=t[1],h=t[2],f=t[3],p=t[4],g=t[5],y=t[6],m=t[7],w=i,b=n[0],v=n[1],_=n[2],E=o,x=a,k=c,A=u,S=d,I=l,B=h,T=f,O=p,N=g,U=y,R=m,L=w,C=b,P=v,Z=_;for(let e=0;e<s;e+=2)E=E+S|0,L=Jl(L^E,16),O=O+L|0,S=Jl(S^O,12),E=E+S|0,L=Jl(L^E,8),O=O+L|0,S=Jl(S^O,7),x=x+I|0,C=Jl(C^x,16),N=N+C|0,I=Jl(I^N,12),x=x+I|0,C=Jl(C^x,8),N=N+C|0,I=Jl(I^N,7),k=k+B|0,P=Jl(P^k,16),U=U+P|0,B=Jl(B^U,12),k=k+B|0,P=Jl(P^k,8),U=U+P|0,B=Jl(B^U,7),A=A+T|0,Z=Jl(Z^A,16),R=R+Z|0,T=Jl(T^R,12),A=A+T|0,Z=Jl(Z^A,8),R=R+Z|0,T=Jl(T^R,7),E=E+I|0,Z=Jl(Z^E,16),U=U+Z|0,I=Jl(I^U,12),E=E+I|0,Z=Jl(Z^E,8),U=U+Z|0,I=Jl(I^U,7),x=x+B|0,L=Jl(L^x,16),R=R+L|0,B=Jl(B^R,12),x=x+B|0,L=Jl(L^x,8),R=R+L|0,B=Jl(B^R,7),k=k+T|0,C=Jl(C^k,16),O=O+C|0,T=Jl(T^O,12),k=k+T|0,C=Jl(C^k,8),O=O+C|0,T=Jl(T^O,7),A=A+S|0,P=Jl(P^A,16),N=N+P|0,S=Jl(S^N,12),A=A+S|0,P=Jl(P^A,8),N=N+P|0,S=Jl(S^N,7);let $=0;r[$++]=o+E|0,r[$++]=a+x|0,r[$++]=c+k|0,r[$++]=u+A|0,r[$++]=d+S|0,r[$++]=l+I|0,r[$++]=h+B|0,r[$++]=f+T|0,r[$++]=p+O|0,r[$++]=g+N|0,r[$++]=y+U|0,r[$++]=m+R|0,r[$++]=w+L|0,r[$++]=b+C|0,r[$++]=v+P|0,r[$++]=_+Z|0}const nh=eh(th,{counterRight:!1,counterLength:4,allowShortKeys:!1});class rh extends Ld{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,jd.hash(e);const n=Ud(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return jd.exists(this),this.iHash.update(e),this}digestInto(e){jd.exists(this),jd.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:s,outputLen:o}=this;return e.finished=r,e.destroyed=i,e.blockLen=s,e.outputLen=o,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ih=(e,t,n)=>new rh(e,t).update(n).digest();ih.create=(e,t)=>new rh(e,t);const sh=new Uint8Array([0]),oh=new Uint8Array;var ah=Object.defineProperty,ch=(e,t)=>{for(var n in t)ah(e,n,{get:t[n],enumerable:!0})},uh=Symbol("verified");function dh(e){if(!(e instanceof Object))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}ch({},{Queue:()=>wh,QueueNode:()=>mh,binarySearch:()=>yh,insertEventIntoAscendingList:()=>gh,insertEventIntoDescendingList:()=>ph,normalizeURL:()=>fh,utf8Decoder:()=>lh,utf8Encoder:()=>hh});var lh=new TextDecoder("utf-8"),hh=new TextEncoder;function fh(e){-1===e.indexOf("://")&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function ph(e,t){const[n,r]=yh(e,(e=>t.id===e.id?0:t.created_at===e.created_at?-1:e.created_at-t.created_at));return r||e.splice(n,0,t),e}function gh(e,t){const[n,r]=yh(e,(e=>t.id===e.id?0:t.created_at===e.created_at?-1:t.created_at-e.created_at));return r||e.splice(n,0,t),e}function yh(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(0===s)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}var mh=class{value;next=null;prev=null;constructor(e){this.value=e}},wh=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new mh(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const e=this.first;return this.first=e.next,e.value}};function bh(e){return Od(Kd(hh.encode(function(e){if(!dh(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e))))}var vh=new class{generateSecretKey(){return kd.utils.randomPrivateKey()}getPublicKey(e){return Od(kd.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Od(kd.getPublicKey(t)),n.id=bh(n),n.sig=Od(kd.sign(bh(n),t)),n[uh]=!0,n}verifyEvent(e){if("boolean"==typeof e[uh])return e[uh];const t=bh(e);if(t!==e.id)return e[uh]=!1,!1;try{const n=kd.verify(e.sig,t,e.pubkey);return e[uh]=n,n}catch(t){return e[uh]=!1,!1}}},_h=vh.generateSecretKey,Eh=vh.getPublicKey,xh=vh.finalizeEvent,kh=vh.verifyEvent;function Ah(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Sh(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function Ih(e){return 2e4<=e&&e<3e4}function Bh(e){return 3e4<=e&&e<4e4}function Th(e){return Ah(e)?"regular":Sh(e)?"replaceable":Ih(e)?"ephemeral":Bh(e)?"parameterized":"unknown"}function Oh(e,t){const n=t instanceof Array?t:[t];return dh(e)&&n.includes(e.kind)||!1}ch({},{Application:()=>Hf,BadgeAward:()=>jh,BadgeDefinition:()=>Pf,BlockedRelaysList:()=>mf,BookmarkList:()=>pf,Bookmarksets:()=>Rf,Calendar:()=>Jf,CalendarEventRSVP:()=>Yf,ChannelCreation:()=>Hh,ChannelHideMessage:()=>Vh,ChannelMessage:()=>Dh,ChannelMetadata:()=>Fh,ChannelMuteUser:()=>Kh,ClassifiedListing:()=>Vf,ClientAuth:()=>Af,CommunitiesList:()=>gf,CommunityDefinition:()=>ep,CommunityPostApproval:()=>nf,Contacts:()=>Lh,CreateOrUpdateProduct:()=>jf,CreateOrUpdateStall:()=>$f,Curationsets:()=>Lf,Date:()=>Wf,DirectMessageRelaysList:()=>_f,DraftClassifiedListing:()=>Kf,DraftLong:()=>Mf,Emojisets:()=>zf,EncryptedDirectMessage:()=>Ch,EventDeletion:()=>Ph,FileMetadata:()=>Jh,FileServerPreference:()=>Ef,Followsets:()=>Of,GenericRepost:()=>zh,Genericlists:()=>Nf,GiftWrap:()=>Gh,HTTPAuth:()=>Tf,Handlerinformation:()=>Qf,Handlerrecommendation:()=>Xf,Highlights:()=>df,InterestsList:()=>bf,Interestsets:()=>Zf,JobFeedback:()=>of,JobRequest:()=>rf,JobResult:()=>sf,Label:()=>tf,LightningPubRPC:()=>kf,LiveChatMessage:()=>Yh,LiveEvent:()=>Ff,LongFormArticle:()=>qf,Metadata:()=>Nh,Mutelist:()=>lf,NWCWalletInfo:()=>xf,NWCWalletRequest:()=>Sf,NWCWalletResponse:()=>If,NostrConnect:()=>Bf,OpenTimestamps:()=>Wh,Pinlist:()=>hf,PrivateDirectMessage:()=>Mh,ProblemTracker:()=>Xh,ProfileBadges:()=>Cf,PublicChatsList:()=>yf,Reaction:()=>$h,RecommendRelay:()=>Rh,RelayList:()=>ff,Relaysets:()=>Uf,Report:()=>Qh,Reporting:()=>ef,Repost:()=>Zh,Seal:()=>qh,SearchRelaysList:()=>wf,ShortTextNote:()=>Uh,Time:()=>Gf,UserEmojiList:()=>vf,UserStatuses:()=>Df,Zap:()=>uf,ZapGoal:()=>af,ZapRequest:()=>cf,classifyKind:()=>Th,isEphemeralKind:()=>Ih,isKind:()=>Oh,isParameterizedReplaceableKind:()=>Bh,isRegularKind:()=>Ah,isReplaceableKind:()=>Sh});var Nh=0,Uh=1,Rh=2,Lh=3,Ch=4,Ph=5,Zh=6,$h=7,jh=8,qh=13,Mh=14,zh=16,Hh=40,Fh=41,Dh=42,Vh=43,Kh=44,Wh=1040,Gh=1059,Jh=1063,Yh=1311,Xh=1971,Qh=1984,ef=1984,tf=1985,nf=4550,rf=5999,sf=6999,of=7e3,af=9041,cf=9734,uf=9735,df=9802,lf=1e4,hf=10001,ff=10002,pf=10003,gf=10004,yf=10005,mf=10006,wf=10007,bf=10015,vf=10030,_f=10050,Ef=10096,xf=13194,kf=21e3,Af=22242,Sf=23194,If=23195,Bf=24133,Tf=27235,Of=3e4,Nf=30001,Uf=30002,Rf=30003,Lf=30004,Cf=30008,Pf=30009,Zf=30015,$f=30017,jf=30018,qf=30023,Mf=30024,zf=30030,Hf=30078,Ff=30311,Df=30315,Vf=30402,Kf=30403,Wf=31922,Gf=31923,Jf=31924,Yf=31925,Xf=31989,Qf=31990,ep=34550;function tp(e,t){if(e.ids&&-1===e.ids.indexOf(t.id))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}function np(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function rp(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function ip(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(-1===i)return null;let s=r+1+i;return e.slice(r+1,s)}function sp(e,t){return t===np(e,"id")}function op(e,t){return t===np(e,"pubkey")}function ap(e,t){return t===rp(e,"kind")}ch({},{getHex64:()=>np,getInt:()=>rp,getSubscriptionId:()=>ip,matchEventId:()=>sp,matchEventKind:()=>ap,matchEventPubkey:()=>op});function cp(e,t){return{kind:Af,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function up(){return new Promise((e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()}))}ch({},{makeAuthEvent:()=>cp});var dp,lp=e=>(e[uh]=!0,!0),hp=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);_onauth=null;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;openSubs=new Map;connectionTimeoutHandle;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new wh;queueRunning=!1;challenge;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=fh(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new hp(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise||(this.challenge=void 0,this.connectionPromise=new Promise(((e,t)=>{this.connectionTimeoutHandle=setTimeout((()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")}),this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(e){return void t(e)}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=e=>{t(e.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{this._connected&&(this._connected=!1,this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}))),this.connectionPromise}async runQueue(){for(this.queueRunning=!0;!1!==this.handleNext();)await up();this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=ip(e);if(t){const n=this.openSubs.get(t);if(!n)return;const r=np(e,"id"),i=n.alreadyHaveEvent?.(r);if(n.receivedEvent?.(this,r),i)return}try{let t=JSON.parse(e);switch(t[0]){case"EVENT":{const e=this.openSubs.get(t[1]),n=t[2];return void(this.verifyEvent(n)&&function(e,t){for(let n=0;n<e.length;n++)if(tp(e[n],t))return!0;return!1}(e.filters,n)&&e.onevent(n))}case"COUNT":{const e=t[1],n=t[2],r=this.openCountRequests.get(e);return void(r&&(r.resolve(n.count),this.openCountRequests.delete(e)))}case"EOSE":{const e=this.openSubs.get(t[1]);if(!e)return;return void e.receivedEose()}case"OK":{const e=t[1],n=t[2],r=t[3],i=this.openEventPublishes.get(e);return void(i&&(n?i.resolve(r):i.reject(new Error(r)),this.openEventPublishes.delete(e)))}case"CLOSED":{const e=t[1],n=this.openSubs.get(e);if(!n)return;return n.closed=!0,void n.close(t[2])}case"NOTICE":return void this.onnotice(t[1]);case"AUTH":return this.challenge=t[1],void this._onauth?.(t[1])}}catch(e){return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then((()=>{this.ws?.send(e)}))}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(cp(this.url,this.challenge)),n=new Promise(((e,n)=>{this.openEventPublishes.set(t.id,{resolve:e,reject:n})}));return this.send('["AUTH",'+JSON.stringify(t)+"]"),n}async publish(e){const t=new Promise(((t,n)=>{this.openEventPublishes.set(e.id,{resolve:t,reject:n})}));return this.send('["EVENT",'+JSON.stringify(e)+"]"),setTimeout((()=>{const t=this.openEventPublishes.get(e.id);t&&(t.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))}),this.publishTimeout),t}async count(e,t){this.serial++;const n=t?.id||"count:"+this.serial,r=new Promise(((e,t)=>{this.openCountRequests.set(n,{resolve:e,reject:t})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||"sub:"+this.serial,r=new fp(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},fp=class{relay;id;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(e=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,e)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),this.onclose?.(e)}},pp=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;trustedRelayURLs=new Set;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=fh(e);let n=this.relays.get(e);return n||(n=new hp(e,{verifyEvent:this.trustedRelayURLs.has(e)?lp:this.verifyEvent,websocketImplementation:this._WebSocket}),t?.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(fh).forEach((e=>{this.relays.get(e)?.close()}))}subscribeMany(e,t,n){return this.subscribeManyMap(Object.fromEntries(e.map((e=>[e,t]))),n)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(e,t)=>{let n=this.seenOn.get(t);n||(n=new Set,this.seenOn.set(t,n)),n.add(e)});const n=new Set,r=[],i=Object.keys(e).length,s=[];let o=e=>{s[e]=!0,s.filter((e=>e)).length===i&&(t.oneose?.(),o=()=>{})};const a=[];let c=(e,n)=>{o(e),a[e]=n,a.filter((e=>e)).length===i&&(t.onclose?.(a),c=()=>{})};const u=e=>{if(t.alreadyHaveEvent?.(e))return!0;const r=n.has(e);return n.add(e),r},d=Promise.all(Object.entries(e).map((async(e,n,i)=>{if(i.indexOf(e)!==n)return void c(n,"duplicate url");let s,[a,d]=e;a=fh(a);try{s=await this.ensureRelay(a,{connectionTimeout:t.maxWait?Math.max(.8*t.maxWait,t.maxWait-1e3):void 0})}catch(e){return void c(n,e?.message||String(e))}let l=s.subscribe(d,{...t,oneose:()=>o(n),onclose:e=>c(n,e),alreadyHaveEvent:u,eoseTimeout:t.maxWait});r.push(l)})));return{async close(){await d,r.forEach((e=>{e.close()}))}}}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise((async r=>{const i=[];this.subscribeManyEose(e,[t],{...n,onevent(e){i.push(e)},onclose(e){r(i)}})}))}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort(((e,t)=>t.created_at-e.created_at)),r[0]||null}publish(e,t){return e.map(fh).map((async(e,n,r)=>{if(r.indexOf(e)!==n)return Promise.reject("duplicate url");let i=await this.ensureRelay(e);return i.publish(t).then((e=>{if(this.trackRelays){let e=this.seenOn.get(t.id);e||(e=new Set,this.seenOn.set(t.id,e)),e.add(i)}return e}))}))}listConnectionStatus(){const e=new Map;return this.relays.forEach(((t,n)=>e.set(n,t.connected))),e}destroy(){this.relays.forEach((e=>e.close())),this.relays=new Map}};try{dp=WebSocket}catch{}var gp=class extends pp{constructor(){super({verifyEvent:kh,websocketImplementation:dp})}};ch({},{BECH32_REGEX:()=>wp,Bech32MaxSize:()=>mp,NostrTypeGuard:()=>yp,decode:()=>bp,encodeBytes:()=>Ap,naddrEncode:()=>Bp,neventEncode:()=>Ip,noteEncode:()=>xp,nprofileEncode:()=>Sp,npubEncode:()=>Ep,nsecEncode:()=>_p});var yp={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},mp=5e3,wp=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function bp(e){let{prefix:t,words:n}=bl.decode(e,mp),r=new Uint8Array(bl.fromWords(n));switch(t){case"nprofile":{let e=vp(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Od(e[0][0]),relays:e[1]?e[1].map((e=>lh.decode(e))):[]}}}case"nevent":{let e=vp(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Od(e[0][0]),relays:e[1]?e[1].map((e=>lh.decode(e))):[],author:e[2]?.[0]?Od(e[2][0]):void 0,kind:e[3]?.[0]?parseInt(Od(e[3][0]),16):void 0}}}case"naddr":{let e=vp(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!e[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!e[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:lh.decode(e[0][0]),pubkey:Od(e[2][0]),kind:parseInt(Od(e[3][0]),16),relays:e[1]?e[1].map((e=>lh.decode(e))):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Od(r)};default:throw new Error(`unknown prefix ${t}`)}}function vp(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],i=n.slice(2,2+r);if(n=n.slice(2+r),i.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(i)}return t}function _p(e){return Ap("nsec",e)}function Ep(e){return Ap("npub",Nd(e))}function xp(e){return Ap("note",Nd(e))}function kp(e,t){let n=bl.toWords(t);return bl.encode(e,n,mp)}function Ap(e,t){return kp(e,t)}function Sp(e){let t=Tp({0:[Nd(e.pubkey)],1:(e.relays||[]).map((e=>hh.encode(e)))});return kp("nprofile",t)}function Ip(e){let t;void 0!==e.kind&&(t=function(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t}(e.kind));let n=Tp({0:[Nd(e.id)],1:(e.relays||[]).map((e=>hh.encode(e))),2:e.author?[Nd(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return kp("nevent",n)}function Bp(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=Tp({0:[hh.encode(e.identifier)],1:(e.relays||[]).map((e=>hh.encode(e))),2:[Nd(e.pubkey)],3:[new Uint8Array(t)]});return kp("naddr",n)}function Tp(e){let t=[];return Object.entries(e).reverse().forEach((([e,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(e)],0),r.set([n.length],1),r.set(n,2),t.push(r)}))})),Rd(...t)}async function Op(e,t,n){const r=e instanceof Uint8Array?Od(e):e,i=Up(cd.getSharedSecret(r,"02"+t));let s=Uint8Array.from(Pd(16)),o=hh.encode(n),a=zl(i,s).encrypt(o);return`${cl.encode(new Uint8Array(a))}?iv=${cl.encode(new Uint8Array(s.buffer))}`}async function Np(e,t,n){const r=e instanceof Uint8Array?Od(e):e;let[i,s]=n.split("?iv="),o=Up(cd.getSharedSecret(r,"02"+t)),a=cl.decode(s),c=cl.decode(i),u=zl(o,a).decrypt(c);return lh.decode(u)}function Up(e){return e.slice(1,33)}ch({},{decrypt:()=>Np,encrypt:()=>Op});ch({},{NIP05_REGEX:()=>Lp,isNip05:()=>Cp,isValid:()=>jp,queryProfile:()=>$p,searchDomain:()=>Zp,useFetchImplementation:()=>Pp});var Rp,Lp=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Cp=e=>Lp.test(e||"");try{Rp=fetch}catch(e){}function Pp(e){Rp=e}async function Zp(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await Rp(n,{redirect:"manual"});if(200!==r.status)throw Error("Wrong response code");return(await r.json()).names}catch(e){return{}}}async function $p(e){const t=e.match(Lp);if(!t)return null;const[,n="_",r]=t;try{const e=`https://${r}/.well-known/nostr.json?name=${n}`,t=await Rp(e,{redirect:"manual"});if(200!==t.status)throw Error("Wrong response code");const i=await t.json(),s=i.names[n];return s?{pubkey:s,relays:i.relays?.[s]}:null}catch(e){return null}}async function jp(e,t){const n=await $p(t);return!!n&&n.pubkey===e}function qp(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if("e"===s[0]&&s[1]){const[e,i,o,a,c]=s,u={id:i,relays:o?[o]:[],author:c};if("root"===a){t.root=u;continue}if("reply"===a){t.reply=u;continue}if("mention"===a){t.mentions.push(u);continue}n?r=u:n=u,t.mentions.push(u)}else{if("q"===s[0]&&s[1]){const[e,n,r]=s;t.quotes.push({id:n,relays:r?[r]:[]})}"p"===s[0]&&s[1]&&t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]})}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach((e=>{if(!e)return;let n=t.mentions.indexOf(e);if(-1!==n&&t.mentions.splice(n,1),e.author){let n=t.profiles.find((t=>t.pubkey===e.author));n&&n.relays&&(e.relays||(e.relays=[]),n.relays.forEach((t=>{-1===e.relays?.indexOf(t)&&e.relays.push(t)})),n.relays=e.relays)}})),t.mentions.forEach((e=>{if(e.author){let n=t.profiles.find((t=>t.pubkey===e.author));n&&n.relays&&(e.relays||(e.relays=[]),n.relays.forEach((t=>{-1===e.relays.indexOf(t)&&e.relays.push(t)})),n.relays=e.relays)}})),t}ch({},{parse:()=>qp});function Mp(e){}async function zp(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}ch({},{fetchRelayInformation:()=>zp,useFetchImplementation:()=>Mp});function Hp(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(0!==r){t+=Math.clz32(r);break}t+=32}return t}function Fp(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const e=Math.floor((new Date).getTime()/1e3);if(e!==r.created_at&&(n=0,r.created_at=e),i[1]=(++n).toString(),r.id=Dp(r),Hp(r.id)>=t)break}return r}function Dp(e){return Od(Kd(hh.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}ch({},{fastEventHash:()=>Dp,getPow:()=>Hp,minePow:()=>Fp});function Vp(e,t,n,r){return xh({kind:Zh,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:""===e.content?"":JSON.stringify(t),created_at:e.created_at},r)}function Kp(e){if(e.kind!==Zh)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const i=e.tags[r];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==t?{id:t[1],relays:[t[2],n?.[2]].filter((e=>"string"==typeof e)),author:n?.[1]}:void 0}function Wp(e,{skipVerification:t}={}){const n=Kp(e);if(void 0===n||""===e.content)return;let r;try{r=JSON.parse(e.content)}catch(e){return}return r.id===n.id&&(t||kh(r))?r:void 0}ch({},{finishRepostEvent:()=>Vp,getRepostedEvent:()=>Wp,getRepostedEventPointer:()=>Kp});ch({},{NOSTR_URI_REGEX:()=>Gp,parse:()=>Yp,test:()=>Jp});var Gp=new RegExp(`nostr:(${wp.source})`);function Jp(e){return"string"==typeof e&&new RegExp(`^${Gp.source}$`).test(e)}function Yp(e){const t=e.match(new RegExp(`^${Gp.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:bp(t[1])}}function Xp(e,t,n){const r=t.tags.filter((e=>e.length>=2&&("e"===e[0]||"p"===e[0])));return xh({...e,kind:$h,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Qp(e){if(e.kind!==$h)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const i=e.tags[r];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==t&&void 0!==n?{id:t[1],relays:[t[2],n[2]].filter((e=>void 0!==e)),author:n[1]}:void 0}ch({},{finishReactionEvent:()=>Xp,getReactedEventPointer:()=>Qp});ch({},{matchAll:()=>tg,regex:()=>eg,replaceAll:()=>ng});var eg=()=>new RegExp(`\\b${Gp.source}\\b`,"g");function*tg(e){const t=e.matchAll(eg());for(const e of t)try{const[t,n]=e;yield{uri:t,value:n,decoded:bp(n),start:e.index,end:e.index+t.length}}catch(e){}}function ng(e,t){return e.replaceAll(eg(),((e,n)=>t({uri:e,value:n,decoded:bp(n)})))}ch({},{channelCreateEvent:()=>rg,channelHideMessageEvent:()=>og,channelMessageEvent:()=>sg,channelMetadataEvent:()=>ig,channelMuteUserEvent:()=>ag});var rg=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return xh({kind:Hh,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},ig=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return xh({kind:Fh,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},sg=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),xh({kind:Dh,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},og=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return xh({kind:Vh,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},ag=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return xh({kind:Kh,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)};ch({},{EMOJI_SHORTCODE_REGEX:()=>cg,matchAll:()=>dg,regex:()=>ug,replaceAll:()=>lg});var cg=/:(\w+):/,ug=()=>new RegExp(`\\B${cg.source}\\B`,"g");function*dg(e){const t=e.matchAll(ug());for(const e of t)try{const[t,n]=e;yield{shortcode:t,name:n,start:e.index,end:e.index+t.length}}catch(e){}}function lg(e,t){return e.replaceAll(ug(),((e,n)=>t({shortcode:e,name:n})))}var hg;ch({},{useFetchImplementation:()=>fg,validateGithub:()=>pg});try{hg=fetch}catch{}function fg(e){hg=e}async function pg(e,t,n){try{return await(await hg(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch(e){return!1}}ch({},{decrypt:()=>xg,encrypt:()=>Eg,getConversationKey:()=>mg,v2:()=>kg});var gg=1,yg=65535;function mg(e,t){const n=cd.getSharedSecret(e,"02"+t).subarray(1,33);return function(e,t,n){return jd.hash(e),ih(e,Ud(n),Ud(t))}(Kd,n,"nip44-v2")}function wg(e,t){const n=function(e,t,n,r=32){if(jd.hash(e),jd.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=oh);const s=new Uint8Array(i*e.outputLen),o=ih.create(e,t),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let t=0;t<i;t++)sh[0]=t+1,a.update(0===t?oh:c).update(n).update(sh).digestInto(c),s.set(c,e.outputLen*t),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),sh.fill(0),s.slice(0,r)}(Kd,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function bg(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function vg(e){const t=hh.encode(e),n=t.length,r=function(e){if(!Number.isSafeInteger(e)||e<gg||e>yg)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}(n);return Rd(r,t,new Uint8Array(bg(n)-n))}function _g(e,t,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=Rd(n,t);return ih(Kd,e,r)}function Eg(e,t,n=Pd(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=wg(t,n),o=vg(e),a=nh(r,i,o),c=_g(s,a,n);return cl.encode(Rd(new Uint8Array([2]),n,a,c))}function xg(e,t){const{nonce:n,ciphertext:r,mac:i}=function(e){if("string"!=typeof e)throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if("#"===e[0])throw new Error("unknown encryption version");let n;try{n=cl.decode(e)}catch(e){throw new Error("invalid base64: "+e.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(2!==i)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(e),{chacha_key:s,chacha_nonce:o,hmac_key:a}=wg(t,n);if(!function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}(_g(a,r,n),i))throw new Error("invalid MAC");return function(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<gg||t>yg||n.length!==t||e.length!==2+bg(t))throw new Error("invalid padding");return lh.decode(n)}(nh(s,o,r))}var kg={utils:{getConversationKey:mg,calcPaddedLen:bg},encrypt:Eg,decrypt:xg};function Ag(e){const{pathname:t,searchParams:n}=new URL(e),r=t,i=n.get("relay"),s=n.get("secret");if(!r||!i||!s)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:s}}async function Sg(e,t,n){const r={method:"pay_invoice",params:{invoice:n}},i=await Op(t,e,JSON.stringify(r)),s={kind:Sf,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return xh(s,t)}ch({},{makeNwcRequestEvent:()=>Sg,parseConnectionString:()=>Ag});var Ig;ch({},{getZapEndpoint:()=>Tg,makeZapReceipt:()=>Ug,makeZapRequest:()=>Og,useFetchImplementation:()=>Bg,validateZapRequest:()=>Ng});try{Ig=fetch}catch{}function Bg(e){Ig=e}async function Tg(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:e}=bl.decode(n,1e3),r=bl.fromWords(e);t=lh.decode(r)}else{if(!r)return null;{let[e,n]=r.split("@");t=new URL(`/.well-known/lnurlp/${e}`,`https://${n}`).toString()}}let i=await Ig(t),s=await i.json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch(e){}return null}function Og({profile:e,event:t,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&s.tags.push(["e",t]),s}function Ng(e){let t;try{t=JSON.parse(e)}catch(e){return"Invalid zap request JSON."}if(!dh(t))return"Zap request is not a valid Nostr event.";if(!kh(t))return"Invalid signature on zap request.";let n=t.tags.find((([e,t])=>"p"===e&&t));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find((([e,t])=>"e"===e&&t));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find((([e,t])=>"relays"===e&&t))?null:"Zap request doesn't have a 'relays' tag."}function Ug({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter((([e])=>"e"===e||"p"===e||"a"===e)),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}ch({},{createRumor:()=>$g,createSeal:()=>jg,createWrap:()=>qg,unwrapEvent:()=>Hg,unwrapManyEvents:()=>Fg,wrapEvent:()=>Mg,wrapManyEvents:()=>zg});var Rg=()=>Math.round(Date.now()/1e3),Lg=()=>Math.round(Rg()-172800*Math.random()),Cg=(e,t)=>mg(e,t),Pg=(e,t,n)=>Eg(JSON.stringify(e),Cg(t,n)),Zg=(e,t)=>JSON.parse(xg(e.content,Cg(t,e.pubkey)));function $g(e,t){const n={created_at:Rg(),content:"",tags:[],...e,pubkey:Eh(t)};return n.id=bh(n),n}function jg(e,t,n){return xh({kind:qh,content:Pg(e,t,n),created_at:Lg(),tags:[]},t)}function qg(e,t){const n=_h();return xh({kind:Gh,content:Pg(e,n,t),created_at:Lg(),tags:[["p",t]]},n)}function Mg(e,t,n){return qg(jg($g(e,t),t,n),n)}function zg(e,t,n){if(!n||0===n.length)throw new Error("At least one recipient is required.");const r=Eh(t),i=[Mg(e,t,r)];return n.forEach((n=>{i.push(Mg(e,t,n))})),i}function Hg(e,t){const n=Zg(e,t);return Zg(n,t)}function Fg(e,t){let n=[];return e.forEach((e=>{n.push(Hg(e,t))})),n.sort(((e,t)=>e.created_at-t.created_at)),n}ch({},{getToken:()=>Vg,hashPayload:()=>Qg,unpackEventFromToken:()=>Wg,validateEvent:()=>ty,validateEventKind:()=>Jg,validateEventMethodTag:()=>Xg,validateEventPayloadTag:()=>ey,validateEventTimestamp:()=>Gg,validateEventUrlTag:()=>Yg,validateToken:()=>Kg});var Dg="Nostr ";async function Vg(e,t,n,r=!1,i){const s={kind:Tf,tags:[["u",e],["method",t]],created_at:Math.round((new Date).getTime()/1e3),content:""};i&&s.tags.push(["payload",Qg(i)]);const o=await n(s);return(r?Dg:"")+cl.encode(hh.encode(JSON.stringify(o)))}async function Kg(e,t,n){const r=await Wg(e).catch((e=>{throw e}));return await ty(r,t,n).catch((e=>{throw e}))}async function Wg(e){if(!e)throw new Error("Missing token");e=e.replace(Dg,"");const t=lh.decode(cl.decode(e));if(!t||0===t.length||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Gg(e){return!!e.created_at&&Math.round((new Date).getTime()/1e3)-e.created_at<60}function Jg(e){return e.kind===Tf}function Yg(e,t){const n=e.tags.find((e=>"u"===e[0]));return!!n&&(n.length>0&&n[1]===t)}function Xg(e,t){const n=e.tags.find((e=>"method"===e[0]));return!!n&&(n.length>0&&n[1].toLowerCase()===t.toLowerCase())}function Qg(e){return Od(Kd(hh.encode(JSON.stringify(e))))}function ey(e,t){const n=e.tags.find((e=>"payload"===e[0]));if(!n)return!1;const r=Qg(t);return n.length>0&&n[1]===r}async function ty(e,t,n,r){if(!kh(e))throw new Error("Invalid nostr event, signature invalid");if(!Jg(e))throw new Error("Invalid nostr event, kind invalid");if(!Gg(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Yg(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Xg(e,n))throw new Error("Invalid nostr event, method tag invalid");return!0}class ny extends $c{constructor(e,t,n={}){super(),this._inbox={event:new $c,id:new $c,peer:new $c,tag:new $c},this._sub=null,this._handler=e=>{try{const t=function(e,t){const n=uo(e);if(null!==n)throw new Error(n);if(!function(e,t){const n=function(e,t){return e.tags.filter((e=>e.at(0)===t))}(e,"p");return n.some((e=>e[1]===t))}(e,yr(t)))throw new Error("pubkey not in peers list");const r=br(mr(t,e.pubkey),e.content);return JSON.parse(r)}(e,this._seckey.hex),n=function(e,t){const n=so.msg.envelope.safeParse(e);if(!n.success)throw new Error("envelope failed schema validation");const[r,i,s]=n.data;return{env:t,data:s,id:i,tag:r}}(t,e);this.emit("message",n),this.inbox.id.emit(n.id,n),this.inbox.peer.emit(n.env.pubkey,n),this.inbox.tag.emit(n.tag,n)}catch(t){this.emit("bounced",[e.id,ao(t)])}},this._publish=async(e,t,n)=>{const r=n?.cache??new Map,i=function(e,t={}){let{created_at:n=oo(),tags:r=[],...i}=t;const s=e.config.envelope;return r=[...s.tags??[],...t.tags??[]],{...s,...i,created_at:n,tags:r}}(this,n),s=function(e,t,n){try{return JSON.stringify([e,n,t])}catch(e){throw new Error("failed to create message payload")}}(e.tag,e.data,e.id),o=co(i,s,t,this._seckey.hex),a={...e,env:o},c=this._pool.publish(this.relays,o);return this._inbox.event.emit("published",a),Promise.all(c).then((n=>{const i=this.relays.filter((e=>!n.includes(e))),s=e.id,o=n.length>0,c={acks:n,fails:i,ok:o,peer_pk:t,data:a};return r.set(t,c),this._inbox.event.emit("settled",{...c,msg_id:s}),{...c,ok:o,msg_id:s}}))},function(e){if(!so.base.url.array().safeParse(e).success)throw new Error("invalid relay set: "+e)}(e),function(e){if(!so.base.hex32.safeParse(e).success)throw new Error("invalid secret key: "+e)}(t),this._seckey=new _e(t),this._pubkey=yr(this._seckey.hex),this._config=function(e={}){const t={envelope:{kind:20004,tags:[]},filter:{kinds:[20004],since:oo()},req_timeout:5e3,since_offset:5,start_delay:2e3},n={...t.envelope,...e.envelope},r={...t.filter,...e.filter};return{...t,envelope:n,filter:r}}(n),this._filter=ry(this,n.filter),this._pool=new gp,this._relays=e,this.emit("info",["filter:",JSON.stringify(this.filter,null,2)])}_subscribe(e,t=this.config.req_timeout,n=vr()){return this._filter=ry(this,e),this.filter["#p"]=[...this.filter["#p"]??[],this.pubkey],this._sub=this._pool.subscribeMany(this.relays,[this._filter],{id:n,oneose:()=>this.emit("subscribed",[n,this.filter]),onevent:this._handler}),new Promise((e=>{const r=setTimeout((()=>e("timeout")),t);this.within("subscribed",(([t])=>{var i;t===n&&(i=null,clearTimeout(r),e(i))}),t)}))}get config(){return this._config}get filter(){return this._filter}get inbox(){return this._inbox}get pubkey(){return this._pubkey}get relays(){return this._relays}async broadcast(e,t,n){const r=new Map,i=lo(e),s=t.map((e=>this._publish(i,e,n)));return Promise.all(s).then((e=>{const n={ok:e.every((e=>e.ok)),cache:r,msg_id:i.id,peers:t};return e.forEach((e=>r.set(e.peer_pk,e))),this.emit("broadcast",n),{...n}}))}async connect(e=this.config.req_timeout){const t=await this._subscribe(this._filter,e);if(null!==t)throw new Error(t);return this.emit("ready",this),this}async close(){null!==this._sub&&this._sub.close(),void 0!==this._pool.close&&this._pool.close(this.relays),this.emit("close",this)}async request(e,t,n){const r=lo(e),i=this.subscribe({id:r.id,peers:[t]},n);return this.publish(r,t,n),i}async multicast(e,t,n={}){const r=lo(e),i=this.subscribe({id:r.id,peers:t},n),s=this.broadcast(r,t,n);return Promise.all([i,s]).then((([e,t])=>({sub:e,pub:t})))}async publish(e,t,n){const r=lo(e);return this._publish(r,t,n)}async subscribe(e,t){const n=function(e,t={}){const n=t.timeout??e.config.req_timeout;return{...t,timeout:n}}(this,t);return new Promise((t=>{const{timeout:r,threshold:i}=n,{id:s,peers:o=[],tag:a}=e,c=new Set,u=new Set,d=setTimeout((()=>l(!1,"timeout")),r),l=(e,n)=>{clearTimeout(d);const r={ok:e,authors:Array.from(c),inbox:Array.from(u),peers:o,reason:n};this.emit("resolved",r),t({...r})};this.within("message",(e=>{(e=>"string"==typeof s&&s!==e.id||"string"==typeof a&&a!==e.tag||o.length>0&&!o.includes(e.env.pubkey))(e)||(c.add(e.env.pubkey),u.add(e)),"number"==typeof i&&c.size>=i&&l(!0,"threshold"),Array.isArray(o)&&o.every((e=>c.has(e)))&&l(!0,"complete")}),r)}))}async update(e){return null!==this._sub&&this._sub.close(),this._subscribe(e)}}function ry(e,t={}){return{...e.config.filter,...t}}const iy=()=>({ecdh:new Map});function sy(e){return ay(e).to_bech32m("bfgroup")}function oy(e){return cy(_e.bech32m(e))}function ay(e){const t=_e.num(e.threshold,4),n=_e.hex(e.group_pk,33),r=e.commits.map((e=>function(e){const t=_e.num(e.idx,4),n=_e.hex(e.pubkey,33),r=_e.hex(e.binder_pn,nc),i=_e.hex(e.hidden_pn,nc);return _e.join([t,n,r,i])}(e)));return _e.join([n,t,...r])}function cy(e){const t=new _e(e).stream,n=t.read(33).hex,r=t.read(4).num;Da.ok(t.size%rc==0,"commit data is malformed");const i=t.size/rc,s=[];for(let e=0;e<i;e++){const e=t.read(rc);s.push(uy(e))}return Da.size(t.data,0),Ha({commits:s,group_pk:n,threshold:r})}function uy(e){const t=new _e(e).stream;Da.size(t.data,rc);const n=t.read(4).num,r=t.read(33).hex,i=t.read(nc).hex,s=t.read(nc).hex;return Da.size(t.data,0),{idx:n,binder_pn:i,hidden_pn:s,pubkey:r}}function dy(e){const t=hy(e);return Da.size(t,100),t.to_bech32m("bfshare")}function ly(e){return fy(_e.bech32m(e))}function hy(e){const t=_e.num(e.idx,4),n=_e.hex(e.seckey,32),r=_e.hex(e.binder_sn,32),i=_e.hex(e.hidden_sn,32);return _e.join([t,n,r,i])}function fy(e){const t=new _e(e).stream;Da.size(t.data,100);const n=t.read(4).num,r=t.read(32).hex,i=t.read(32).hex,s=t.read(32).hex;return Da.size(t.data,0),Ha({idx:n,binder_sn:i,hidden_sn:s,seckey:r})}var py;return e.PackageEncoder=void 0,(py=e.PackageEncoder||(e.PackageEncoder={})).group={encode:sy,decode:oy,serialize:ay,deserialize:cy},py.share={encode:dy,decode:ly,serialize:hy,deserialize:fy},e.API=Oc,e.BifrostNode=class extends Lc{constructor(e,t,n,r){super(),this._is_ready=!1,this._cache=function(e={}){return{...iy(),...e}}(r?.cache),this._config=function(e={}){const t={debug:!1,middleware:{},policies:[],sign_ival:100,...e},n=ja.node.config.safeParse(t);if(!n.success)throw new Error("invalid node config");return n.data}(r),this._queue=new Zc(this),this._signer=new Pc(e,t,r),this._peers=function(e){const t=Ma(),n=e.pubkey,r=e.group.commits.map((e=>Xa(e.pubkey,"bip340"))).filter((e=>e!==n));let i=[];for(const n of r){const r=e.config.policies.find((e=>e.pubkey===n)),s=r?.policy??{send:!0,recv:!0};i.push({policy:s,pubkey:n,status:"offline",updated:t})}return i}(this);const i=[...(s=this.peers,s.map((e=>e.pubkey))),this.pubkey];var s;this._client=new ny(n,t.seckey,{filter:{authors:i}}),this._client.on("closed",(()=>{this._is_ready=!1,this.emit("closed",this)})),this._client.on("ready",(()=>{this._is_ready=!0,this.emit("ready",this)})),this._client.on("message",(e=>{if(this.emit("message",e),this._filter(e))try{switch(e.tag){case"/ping/req":uc(this,e);break;case"/ecdh/req":oc(this,qa(e));break;case"/sign/req":{const t=function(e){try{const t=ja.sign.session,n=JSON.parse(e.data),r=t.parse(n);return{...e,data:r}}catch{throw new Error("session message failed validation")}}(e);Ic(this,t);break}}}catch(t){this.emit("bounced",[ao(t),e])}}))}_filter(e){const{pubkey:t}=e.env;if("/echo/req"===e.tag)return!0;if(t===this.pubkey)return!1;if("/ping/req"===e.tag)return!0;return!!this.peers.filter((e=>e.policy.recv)).map((e=>e.pubkey)).includes(e.env.pubkey)||(this.emit("bounced",["unauthorized",e]),!1)}get cache(){return this._cache}get client(){return this._client}get config(){return this._config}get debug(){return this._config.debug}get group(){return this._signer.group}get is_ready(){return this._is_ready}get queue(){return this._queue}get peers(){return this._peers}get pubkey(){return Xa(this.signer.pubkey,"bip340")}get req(){return{ecdh:ac(this),echo:cc(this),ping:dc(this),queue:Bc(this),sign:Tc(this)}}get signer(){return this._signer}async connect(){this.client.connect()}async close(){this.client.close()}update_peer(e){const t=this.peers.findIndex((t=>t.pubkey===e.pubkey));-1!==t&&(this._peers[t]={...this._peers[t],...e})}},e.BifrostSigner=Pc,e.CONST=ic,e.Lib=Rc,e.Schema=ja,e}({});
//# sourceMappingURL=script.js.map
